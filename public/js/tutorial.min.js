"use strict";var loginURL={"zh-cmn-Hans":"https://www.emtailor.com/b2bviews/backend-sdk/cn/login.html",en:"https://www.emtailor.com/b2bviews/backend-sdk/en/login.html",ja:"https://www.emtailor.com/b2bviews/backend-sdk/jp/login.html"},measureURL={"zh-cmn-Hans":"https://www.emtailor.com/b2bviews/backend-sdk/cn/measure.html",en:"https://www.emtailor.com/b2bviews/backend-sdk/en/measure.html",ja:"https://www.emtailor.com/b2bviews/backend-sdk/jp/measure.html"},tutorialURL={"zh-cmn-Hans":"https://www.emtailor.com/b2bviews/backend-sdk/cn/tutorial.html",en:"https://www.emtailor.com/b2bviews/backend-sdk/en/tutorial.html",ja:"https://www.emtailor.com/b2bviews/backend-sdk/jp/tutorial.html"},accountURL={"zh-cmn-Hans":"https://www.emtailor.com/b2bviews/backend-sdk/cn/account.html",en:"https://www.emtailor.com/b2bviews/backend-sdk/en/account.html",ja:"https://www.emtailor.com/b2bviews/backend-sdk/jp/account.html"},forgetPwURL={"zh-cmn-Hans":"https://www.emtailor.com/b2bviews/backend-sdk/cn/forget-password.html",en:"https://www.emtailor.com/b2bviews/backend-sdk/en/forget-password.html",ja:"https://www.emtailor.com/b2bviews/backend-sdk/jp/forget-password.html"},measureMobileURL={"zh-cmn-Hans":"https://www.emtailor.com/b2bviews/backend-sdk/cn/measure-mobile.html",en:"https://www.emtailor.com/b2bviews/backend-sdk/en/measure-mobile.html",ja:"https://www.emtailor.com/b2bviews/backend-sdk/jp/measure-mobile.html"},userIdTable={"zh-cmn-Hans":"用户 ID",en:"User ID",ja:"名前"},adjustTable={"zh-cmn-Hans":"调整",en:"Adjust",ja:"調整"},viewTable={"zh-cmn-Hans":"展示",en:"View",ja:"表示"},genderTable={"zh-cmn-Hans":["女","男"],en:["Female","Male"],ja:["女性","男性"]},accountFirPwWarning={"zh-cmn-Hans":"密码长度6-16位，至少分别有一个特殊符号、大写字母、小写字母和数字",en:"Password must be 6-16 characters, and including at least one special character, capital letter, lowercase letter, and digit.",ja:"パスワードは6-16文字で、記号、大文字、小文字、数字を含んでいる必要があります"},accountSecPwWarning={"zh-cmn-Hans":"两个密码不一致",en:"Password is different from the first one.",ja:"パスワードが一致しません"},sendText={"zh-cmn-Hans":"Send",en:"Send",ja:"送る"},cApiWarnText={"zh-cmn-Hans":"这不是一个合法的域名",en:"It isn't an authorized domain!",ja:"It isn't an authorized domain!"},SDKAPI={signin:"https://www.emtailor.com/b2b/api/corp/signin",imgsMeasure:"https://www.emtailor.com/b2b/api/measure/imgs",imgsTutorial:"https://www.emtailor.com/b2b/api/tutorial/imgs",getlimit:"https://www.emtailor.com/b2b/api/corp/acsetting/getlimit",add:"https://www.emtailor.com/b2b/api/measure/add",resetpsw:"https://www.emtailor.com/b2b/api/corp/acsetting/resetpsw",sendemail:"https://www.emtailor.com/b2b/api/corp/forgetpsw/sendemail",acSendEmail:"https://www.emtailor.com/b2b/api/corp/acsetting/sendemail",vericode:"https://www.emtailor.com/b2b/api/corp/forgetpsw/vericode",newemail:"https://www.emtailor.com/b2b/api/corp/acsetting/newemail",newpsw:"https://www.emtailor.com/b2b/api/corp/forgetpsw/newpsw",modelling:"https://www.emtailor.com/b2b/api/measure/modelling",listMeasure:"https://www.emtailor.com/b2b/api/measure/list",listTutorial:"https://www.emtailor.com/b2b/api/tutorial/list",updatecorpapi:"https://www.emtailor.com/b2b/api/corp/acsetting/updatecorpapi"};(toz_ajax=function(i){this.settings={}}).prototype={post:function(i){var t=this,e="tozA_"+this.genID(2);if(this.settings[e]=$.extend({url:"",data:"",timeout:12e4,dataType:"JSON",async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",headers:{Authorization:""},crossDomain:!1,beforeSend:new Function("return"),success:new Function("return"),fail:new Function("return"),complete:new Function("return"),closeLoading:!1},i),""===this.settings[e].url&&toz_Toast.init({title:"Wrong",content:"Url can't be empty.",duration:-1,mask:!1,icon:"failure"}),!this.settings[e].closeLoading)var r=toz_Toast.init({title:"Loading",content:"",duration:-1,mask:!0,icon:"loading"});this.settings[e].beforeSend(this.settings[e]);var n=$.ajax({type:"post",url:t.settings[e].url,data:t.settings[e].data,timeout:t.settings[e].timeout,dataType:t.settings[e].dataType,async:t.settings[e].async,crossDomain:t.settings[e].crossDomain,headers:{Authorization:t.settings[e].headers.Authorization},success:function(i){t.settings[e].closeLoading||toz_Toast.hideToast(r),setTimeout(function(){t.settings[e].success(i),delete t.settings[e]},550)},fail:function(i){t.settings[e].closeLoading||toz_Toast.hideToast(r),toz_Toast.init({title:"Wrong",content:i,duration:-1,mask:!1,icon:"failure"}),t.settings[e].fail(i),delete t.settings[e]},complete:function(i,a){"timeout"==a?n.abort():200!=i.status&&(t.settings[e].closeLoading||toz_Toast.hideToast(r),toz_Toast.init({title:"Wrong",content:"Sorry, network connection failed. Please try again.(ErrorCode:"+i.status+")",duration:-1,mask:!1,icon:"failure"}),t.settings[e].complete({XMLHttpRequest:i,status:a}),delete t.settings[e])}})},get:function(){},genID:function(i){return Number(Math.random().toString().substr(3,i)+Date.now()).toString(36)}};var toz_ajax=new toz_ajax;function setCookie(i,a,t){var e=new Date;e.setDate(e.getDate()+t),document.cookie=i+"="+a+";expires="+e+";path=/"}function getCookie(i){var a=RegExp(i+"=([^;]+)"),t=document.cookie.match(a);return t?t[1]:""}function delCookie(i){setCookie(i,null,-1)}var cloneObj=function(i){var a,t=i.constructor===Array?[]:{};if("object"==typeof i){if(window.JSON)a=JSON.stringify(i),t=JSON.parse(a);else for(var e in i)t[e]="object"==typeof i[e]?cloneObj(i[e]):i[e];return t}};function isPc(){var i={},a=navigator.platform;return i.win=0==a.indexOf("Win"),i.mac=0==a.indexOf("Mac"),i.x11="X11"==a||0==a.indexOf("Linux"),!!(i.win||i.mac||i.xll)}var view=angular.module("adjustment",[]);view.factory("dataSrv",["$rootScope",function(){return{imgCont:{},retrButton:{},mRatio:.05,closeRatio:.95,radiusRatio:.015,lineWidth:2,enLargePLCirRadius:2,mobileTouchRatio:1,enLargeMRadius:2,minDownIndex:100,maxUpIndex:250,minMPDownIndex:50,maxMPUpIndex:250,bottomNum:1.5,staticCirCol:"#000FFF",moveCirCol:"rgb(255,0,0)",setOutTime:100,cusCirCol:"rgb(50,205,50)",MaxRetrNum:20,promptCol:"rgb(220,220,220)",lineCap:"round",globalAlpha:.4,pageLimit:20,defImgSrc:"../public/assets/imgs/def_icon.png",targetImgSrc:"../public/assets/imgs/target_icon.png",imgDir:["f","s","b"],LineType:["free","L","R"],sign:["sys","cus"],MPIcon:["deflection","target"],MIN_SCALE:1,MAX_SCALE:5,zoomIntensity:.2,drawDir:[0,1,2],drawDirIndex:{f:{L:0,R:1},s:{L:1,R:0},b:{L:0,R:1}},isDraggingCir:[!1,!0],Flag:[!1,!0],APIFlag:!1,draggingCanvas:[!1,!0],isTutorial:[!1,!0],overMaxRetrNum:[!1,!0],adjustImgStatus:{},zoomCauseDrag:[!1,!0],hoverOnPoint:[!1,!0],showPrompt:[!1,!0],outsideCir:[!1,!0],MAXNUM:99999,testNum:/^[0-9]*$/,warngCol:"rgb(255,0,0)",perfCol:"rgb(255,255,0)"}}]),view.factory("drawSrv",["dataSrv",function(C){return{newPar:function(i,a,t){return{imgDir:i,drawCanvasJqueryId:$("#"+a),canvasDraw:document.getElementById(a),ctxDraw:document.getElementById(a).getContext("2d"),canvasImg:document.getElementById(t),ctxImg:document.getElementById(t).getContext("2d"),infPar:{showPrompt:C.showPrompt[0],resizeTimer:null,eventFlag:!1,drawFlag:!1},contPar:{width:0,height:0,winScaling:1},imgPar:{img:new Image,imgx:0,imgy:0,imgh:0,imgw:0},retrPar:{retrButton:"",MaxRetrNum:C.MaxRetrNum,retrArray:new Array,overMaxRetrNum:!1},outlinePar:{lineWidth:C.lineWidth,circles:[],radius:10,originalCircles:[],distanceBound:100,PaintLines:new Array},clickEvePar:{previousSelectedCircle:[],isDraggingCir:C.isDraggingCir[0],clickX:0,clickY:0},mSelPointPar:{mSelectedCircleIndex:"",mSelectedPointDownIndex:0,mSelectedPointUpIndex:0,mSelectedPointIndex:0},zoomImg:{MIN_SCALE:C.MIN_SCALE,MAX_SCALE:C.MAX_SCALE,imgScaling:C.MIN_SCALE,zoom:1,bfScalingimgx:0,bfScalingimgy:0,zoomIntensity:C.zoomIntensity,offsetX:0,offsetY:0},dgImgPar:{zoomCauseDrag:C.zoomCauseDrag[0],draggingCanvas:C.draggingCanvas[0],preimgx:0,preimgy:0,preOffsetx:0,preOffsety:0,draggingCanvasScale:1},addDelMPPar:{hoverPointSign:"",delCirIndex:-1},APIPar:{hoverOnPoint:C.hoverOnPoint[0],firstColorArray:new Array,secondColorArray:new Array,PaintLines_target:new Array,iconArray:new Array,PaintLines_iconArray:new Array},mobilePar:{gestureScale:1,outsideCir:C.outsideCir[0]}}},pretreatment:function(i){C.adjustImgStatus[i.imgDir]=!1,i.imgPar.img.src=C.data.url[i.imgDir],i.retrPar.retrButton=C.retrButton[i.imgDir],i.mobilePar.gestureScale=1,i.retrPar.retrArray=new Array,i.infPar.resizeTimer=null,C.data.isTutorial===C.isTutorial[1]&&this.tutorialMode(i),this.middleTier(i)},tutorialMode:function(i){for(var a=this,t=C.data.pts[i.imgDir],e=C.originalData.ptsTarget[i.imgDir],r=$(C.imgCont[i.imgDir]).height(),n=0,o=0;o<t.length-1;o++){var g=Math.sqrt(Math.pow(t[o][n]-e[o][n],2)+Math.pow(t[o][n+1]-e[o][n+1],2)),s=Math.sqrt(Math.pow(t[o+1][n]-e[o+1][n],2)+Math.pow(t[o+1][n+1]-e[o+1][n+1],2));i.APIPar.firstColorArray.push({index:o,rgb:a.dist2Rgb(1-(g+s)/(2*r*C.mRatio))})}n=2;for(o=0;o<t.length-1;o++){g=Math.sqrt(Math.pow(t[o][n]-e[o][n],2)+Math.pow(t[o][n+1]-e[o][n+1],2)),s=Math.sqrt(Math.pow(t[o+1][n]-e[o+1][n],2)+Math.pow(t[o+1][n+1]-e[o+1][n+1],2));i.APIPar.secondColorArray.push({index:o,rgb:a.dist2Rgb(1-(g+s)/(2*r*C.mRatio))})}$(C.promptButton).click(function(){i.infPar.showPrompt===C.showPrompt[0]?i.infPar.showPrompt=C.showPrompt[1]:i.infPar.showPrompt=C.showPrompt[0],a.drawCirLine(i)})},middleTier:function(a){var t=this;$(a.retrPar.retrButton).click(function(){t.doRetroversion(a)}),a.canvasDraw.onselectstart=function(){return!1},a.canvasDraw.ondblclick=function(i){t.addDelMP(i,a)},$(window).bind("resize",function(){a.infPar.resizeTimer&&clearTimeout(a.infPar.resizeTimer),a.infPar.resizeTimer=setTimeout(function(){a.infPar.eventFlag===C.Flag[0]&&a.infPar.drawFlag===C.Flag[0]&&C.APIFlag==C.Flag[0]&&(t.resizeInit(a),t.draw(a))},150)}),t.isPc()?(a.canvasDraw.onmousedown=function(i){t.canvasClick(i,a)},a.canvasDraw.onmousemove=function(i){t.dragging(i,a)},a.canvasDraw.onmouseup=function(i){t.stopDragging(i,a)},a.canvasDraw.onmouseout=function(i){t.stopDragging(i,a)},a.canvasDraw.onmousewheel=function(i){t.scaleImg(i,a)},document.addEventListener&&a.canvasDraw.addEventListener("DOMMouseScroll",function(i){t.scaleImg(i,a)},!1)):t.setGesture(a)},init:function(n){if(n.infPar.eventFlag===C.Flag[0]&&n.infPar.drawFlag===C.Flag[0]&&C.APIFlag==C.Flag[0]){n.infPar.eventFlag=C.Flag[1];var i,a,o=this,t=C.data.MP[n.imgDir][0],e=C.data.MP[n.imgDir][1],r=C.data.pts[n.imgDir],g=C.data.imgSize[n.imgDir][0],s=C.data.imgSize[n.imgDir][1];i=C.data.isTutorial===C.isTutorial[1]?C.originalData.ptsTarget[n.imgDir]:C.originalData.pts[n.imgDir],n.ctxDraw.clearRect(0,0,n.canvasDraw.width,n.canvasDraw.height),n.ctxImg.clearRect(0,0,n.canvasImg.width,n.canvasImg.height),n.infPar={showPrompt:C.showPrompt[0],resizeTimer:null,eventFlag:C.Flag[1],drawFlag:!1},n.clickEvePar={previousSelectedCircle:[],isDraggingCir:C.isDraggingCir[0],clickX:0,clickY:0},n.mSelPointPar={mSelectedCircleIndex:"",mSelectedPointDownIndex:0,mSelectedPointUpIndex:0,mSelectedPointIndex:0},n.zoomImg={MIN_SCALE:C.MIN_SCALE,MAX_SCALE:C.MAX_SCALE,imgScaling:C.MIN_SCALE,zoom:1,bfScalingimgx:0,bfScalingimgy:0,zoomIntensity:C.zoomIntensity,offsetX:0,offsetY:0},n.addDelMPPar={hoverPointSign:"",delCirIndex:-1},n.contPar={width:$(C.imgCont[n.imgDir]).width(),height:$(C.imgCont[n.imgDir]).height(),winScaling:$(C.imgCont[n.imgDir]).height()/s},n.canvasDraw.width=n.contPar.width,n.canvasDraw.height=n.contPar.height,n.canvasImg.width=n.contPar.width,n.canvasImg.height=n.contPar.height,n.imgPar.imgh=n.contPar.height,n.imgPar.imgw=g*n.contPar.height/s,n.imgPar.imgx=(n.contPar.width-n.imgPar.imgw)/2,n.imgPar.imgy=0,n.dgImgPar={zoomCauseDrag:C.zoomCauseDrag[0],draggingCanvas:C.draggingCanvas[0],preimgx:n.imgPar.imgx,preimgy:n.imgPar.imgy,preOffsetx:0,preOffsety:0,draggingCanvasScale:C.MIN_SCALE},n.outlinePar={lineWidth:C.lineWidth,circles:[],radius:n.contPar.height*C.radiusRatio,originalCircles:[],distanceBound:n.contPar.height*C.mRatio,PaintLines:new Array},n.APIPar={hoverOnPoint:C.hoverOnPoint[0],firstColorArray:new Array,secondColorArray:new Array,PaintLines_target:new Array,iconArray:new Array,PaintLines_iconArray:new Array};for(var l=0;l<t.length;l++){var c=t[l].index;a=t[l].sign===C.sign[0]?C.sign[0]:C.sign[1];var m=o.createcircle(r[c][0]*n.contPar.winScaling+n.imgPar.imgx,r[c][1]*n.contPar.winScaling,a),P=o.createcircle(i[c][0]*n.contPar.winScaling+n.imgPar.imgx,i[c][1]*n.contPar.winScaling,a);n.outlinePar.circles.push(m),n.outlinePar.originalCircles.push(P)}for(l=0;l<e.length;l++){c=e[l].index;a=e[l].sign===C.sign[0]?C.sign[0]:C.sign[1];m=o.createcircle(r[c][2]*n.contPar.winScaling+n.imgPar.imgx,r[c][3]*n.contPar.winScaling,a),P=o.createcircle(i[c][2]*n.contPar.winScaling+n.imgPar.imgx,i[c][3]*n.contPar.winScaling,a);n.outlinePar.circles.push(m),n.outlinePar.originalCircles.push(P)}angular.forEach(C.data.PaintLines,function(i){if(i.ImgDir===n.imgDir)if(i.LineType!=C.LineType[0]){var a=C.drawDirIndex[n.imgDir][i.LineType];if(i.LineType===C.LineType[1])var t=o.findPointOnOutline(i.StartPt.Y*n.contPar.winScaling,a,n),e=o.createcircle(t+n.imgPar.imgx,i.StartPt.Y*n.contPar.winScaling,C.sign[0]),r=o.createcircle(n.imgPar.imgx,i.EndPt.Y*n.contPar.winScaling,C.sign[0]);else if(i.LineType===C.LineType[2])t=o.findPointOnOutline(i.StartPt.Y*n.contPar.winScaling,a,n),e=o.createcircle(t+n.imgPar.imgx,i.StartPt.Y*n.contPar.winScaling,C.sign[0]),r=o.createcircle(g*n.contPar.winScaling+n.imgPar.imgx,i.EndPt.Y*n.contPar.winScaling,C.sign[0]);n.outlinePar.PaintLines.push({StartPt:e,EndPt:r,ImgDir:i.ImgDir,LineName:i.LineName,LineType:i.LineType})}else if(i.LineType===C.LineType[0]){e=o.createcircle(i.StartPt.X*n.contPar.winScaling+n.imgPar.imgx,i.StartPt.Y*n.contPar.winScaling,C.sign[0]),r=o.createcircle(i.EndPt.X*n.contPar.winScaling+n.imgPar.imgx,i.EndPt.Y*n.contPar.winScaling,C.sign[0]);n.outlinePar.PaintLines.push({StartPt:e,EndPt:r,ImgDir:i.ImgDir,LineName:i.LineName,LineType:i.LineType})}});for(l=0;l<C.data.pts[n.imgDir].length;l++)C.data.pts[n.imgDir][l][0]+=n.imgPar.imgx/n.contPar.winScaling,C.data.pts[n.imgDir][l][2]+=n.imgPar.imgx/n.contPar.winScaling;C.data.isTutorial===C.isTutorial[1]&&(angular.forEach(C.data.PaintLines_target,function(i){if(i.ImgDir===n.imgDir){if(i.LineType===C.LineType[0])var a=o.createcircle(i.StartPt.X,i.StartPt.Y,C.sign[0]),t=o.createcircle(i.EndPt.X,i.EndPt.Y,C.sign[0]);else a=o.createcircle(g,i.EndPt.Y,C.sign[0]),t=o.createcircle(g,i.EndPt.Y,C.sign[0]);n.APIPar.PaintLines_target.push({StartPt:a,EndPt:t,ImgDir:i.ImgDir,LineName:i.LineName,LineType:i.LineType,rgb:C.warngCol})}}),angular.forEach(n.outlinePar.PaintLines,function(e,i){angular.forEach(n.APIPar.PaintLines_target,function(i,a){if(e.LineName===i.LineName){var t={dir:C.drawDir[2],index:e.LineName,x:e.EndPt.x,y:e.EndPt.y};o.setRgb(t,n.APIPar.PaintLines_target[a],n)}})})),n.infPar.eventFlag=C.Flag[0]}},resizeInit:function(r){if(r.infPar.eventFlag===C.Flag[0]&&r.infPar.drawFlag===C.Flag[0]&&C.APIFlag==C.Flag[0]){r.infPar.eventFlag=C.Flag[1];for(var n=r.contPar.winScaling*r.zoomImg.imgScaling,i=C.data.pts[r.imgDir],a=0;a<i.length;a++)i[a][0]=(i[a][0]*r.contPar.winScaling-r.imgPar.imgx)/n,i[a][1]=(i[a][1]*r.contPar.winScaling-r.imgPar.imgy)/n,i[a][2]=(i[a][2]*r.contPar.winScaling-r.imgPar.imgx)/n,i[a][3]=(i[a][3]*r.contPar.winScaling-r.imgPar.imgy)/n;angular.forEach(C.data.PaintLines,function(t,e){t.ImgDir===r.imgDir&&angular.forEach(r.outlinePar.PaintLines,function(i,a){t.LineName===i.LineName&&(C.data.PaintLines[e].StartPt.X=(i.StartPt.x-r.imgPar.imgx)/n,C.data.PaintLines[e].StartPt.Y=(i.StartPt.y-r.imgPar.imgy)/n,C.data.PaintLines[e].EndPt.X=(i.EndPt.x-r.imgPar.imgx)/n,C.data.PaintLines[e].EndPt.Y=(i.EndPt.y-r.imgPar.imgy)/n)})}),r.infPar.eventFlag=C.Flag[0],this.init(r)}},draw:function(i){this.drawImage(i),this.drawCirLine(i)},drawImage:function(i){var a=C.data.imgSize[i.imgDir][0],t=C.data.imgSize[i.imgDir][1];setTimeout(function(){i.ctxImg.drawImage(i.imgPar.img,0,0,a,t,i.imgPar.imgx,i.imgPar.imgy,i.imgPar.imgw,i.imgPar.imgh)},C.setOutTime)},drawCirLine:function(i,a){if(i.infPar.drawFlag===C.Flag[0]){i.infPar.drawFlag=C.Flag[1];this.drawLines(i,a),this.drawCircles(i),i.infPar.drawFlag=C.Flag[0]}},drawCircles:function(r){if(r.ctxDraw.strokeStyle=C.staticCirCol,r.ctxDraw.fillStyle=C.staticCirCol,r.ctxDraw.globalAlpha=C.globalAlpha,r.clickEvePar.isDraggingCir===C.isDraggingCir[1])r.ctxDraw.fillStyle=C.moveCirCol,C.testNum.test(r.mSelPointPar.mSelectedCircleIndex)?(r.ctxDraw.beginPath(),r.ctxDraw.arc(r.outlinePar.circles[r.mSelPointPar.mSelectedCircleIndex].x,r.outlinePar.circles[r.mSelPointPar.mSelectedCircleIndex].y,r.outlinePar.radius,0,2*Math.PI),r.ctxDraw.fill()):angular.forEach(r.outlinePar.PaintLines,function(i){var a=r.mSelPointPar.mSelectedCircleIndex.split("-");a[0]===i.LineName&&(i.LineType!=C.LineType[0]?(r.ctxDraw.beginPath(),r.ctxDraw.arc(i.EndPt.x,i.EndPt.y,r.outlinePar.radius*C.enLargePLCirRadius,0,2*Math.PI),r.ctxDraw.fill()):"S"===a[1]?(r.ctxDraw.beginPath(),r.ctxDraw.arc(i.StartPt.x,i.StartPt.y,r.outlinePar.radius,0,2*Math.PI),r.ctxDraw.fill()):"E"===a[1]&&(r.ctxDraw.beginPath(),r.ctxDraw.arc(i.EndPt.x,i.EndPt.y,r.outlinePar.radius,0,2*Math.PI),r.ctxDraw.fill()))}),r.ctxDraw.fillStyle=C.staticCirCol;else if(C.data.isTutorial===C.isTutorial[1]){this.setMPIcon(r),r.ctxDraw.globalAlpha=C.globalAlpha,angular.forEach(r.outlinePar.PaintLines,function(e){e.LineType!=C.LineType[0]?angular.forEach(r.APIPar.PaintLines_iconArray,function(i){if(i.LineName.split("-")[0]===e.LineName){var a=r.outlinePar.radius*C.enLargePLCirRadius;i.icon===C.MPIcon[0]?r.ctxDraw.drawImage(C.defImg,0,0,C.defImg.width,C.defImg.height,e.EndPt.x-a,e.EndPt.y-a,2*a,2*a):r.ctxDraw.drawImage(C.targetImg,0,0,C.targetImg.width,C.targetImg.height,e.EndPt.x-a,e.EndPt.y-a,2*a,2*a)}}):e.LineType===C.LineType[0]&&angular.forEach(r.APIPar.PaintLines_iconArray,function(i){var a=i.LineName.split("-");if(a[0]===e.LineName){var t=r.outlinePar.radius;"S"===a[1]?i.icon===C.MPIcon[0]?r.ctxDraw.drawImage(C.defImg,0,0,C.defImg.width,C.defImg.height,e.StartPt.x-t,e.StartPt.y-t,2*t,2*t):r.ctxDraw.drawImage(C.targetImg,0,0,C.targetImg.width,C.targetImg.height,e.StartPt.x-t,e.StartPt.y-t,2*t,2*t):"E"===a[1]&&(i.icon===C.MPIcon[0]?r.ctxDraw.drawImage(C.defImg,0,0,C.defImg.width,C.defImg.height,e.EndPt.x-t,e.EndPt.y-t,2*t,2*t):r.ctxDraw.drawImage(C.targetImg,0,0,C.targetImg.width,C.targetImg.height,e.EndPt.x-t,e.EndPt.y-t,2*t,2*t))}})});for(var i=0;i<r.outlinePar.circles.length;i++){var a=r.outlinePar.circles[i];r.APIPar.iconArray[i]===C.MPIcon[0]?r.ctxDraw.drawImage(C.defImg,0,0,C.defImg.width,C.defImg.height,a.x-r.outlinePar.radius,a.y-r.outlinePar.radius,2*r.outlinePar.radius,2*r.outlinePar.radius):r.ctxDraw.drawImage(C.targetImg,0,0,C.targetImg.width,C.targetImg.height,a.x-r.outlinePar.radius,a.y-r.outlinePar.radius,2*r.outlinePar.radius,2*r.outlinePar.radius)}}else{angular.forEach(r.outlinePar.PaintLines,function(i){i.LineType!=C.LineType[0]?(r.ctxDraw.beginPath(),r.ctxDraw.arc(i.EndPt.x,i.EndPt.y,r.outlinePar.radius*C.enLargePLCirRadius,0,2*Math.PI),r.ctxDraw.fill()):i.LineType===C.LineType[0]&&(r.ctxDraw.beginPath(),r.ctxDraw.arc(i.StartPt.x,i.StartPt.y,r.outlinePar.radius,0,2*Math.PI),r.ctxDraw.fill(),r.ctxDraw.beginPath(),r.ctxDraw.arc(i.EndPt.x,i.EndPt.y,r.outlinePar.radius,0,2*Math.PI),r.ctxDraw.fill())});for(i=0;i<r.outlinePar.circles.length;i++){(a=r.outlinePar.circles[i]).sign===C.sign[0]?r.ctxDraw.fillStyle=C.staticCirCol:r.ctxDraw.fillStyle=C.cusCirCol,r.ctxDraw.beginPath(),r.ctxDraw.arc(a.x,a.y,r.outlinePar.radius,0,2*Math.PI),r.ctxDraw.fill()}}if(C.data.isTutorial===C.isTutorial[1]&&r.infPar.showPrompt===C.showPrompt[1]){var t=C.data.MP[r.imgDir][0],e=C.data.MP[r.imgDir][1],n=C.data.ptsTarget[r.imgDir],o=r.contPar.winScaling*r.zoomImg.imgScaling;r.ctxDraw.fillStyle=C.promptCol,angular.forEach(r.APIPar.PaintLines_target,function(i){i.LineType!=C.LineType[0]?(r.ctxDraw.beginPath(),i.LineType===C.LineType[1]?r.ctxDraw.arc(r.imgPar.imgx,i.EndPt.y*o+r.imgPar.imgy,r.outlinePar.radius*C.enLargePLCirRadius,0,2*Math.PI):i.LineType===C.LineType[2]&&r.ctxDraw.arc(r.imgPar.imgx+r.imgPar.imgw*r.zoomImg.imgScaling,i.EndPt.y*o+r.imgPar.imgy,r.outlinePar.radius*C.enLargePLCirRadius,0,2*Math.PI),r.ctxDraw.fill()):i.LineType===C.LineType[0]&&(r.ctxDraw.beginPath(),r.ctxDraw.arc(i.StartPt.x*o+r.imgPar.imgx,i.StartPt.y*o+r.imgPar.imgy,r.outlinePar.radius,0,2*Math.PI),r.ctxDraw.fill(),r.ctxDraw.beginPath(),r.ctxDraw.arc(i.EndPt.x*o+r.imgPar.imgx,i.EndPt.y*o+r.imgPar.imgy,r.outlinePar.radius,0,2*Math.PI),r.ctxDraw.fill())});for(i=0;i<t.length;i++){var g=t[i].index;r.ctxDraw.beginPath(),r.ctxDraw.arc(n[g][0]*o+r.imgPar.imgx,n[g][1]*o+r.imgPar.imgy,r.outlinePar.radius,0,2*Math.PI),r.ctxDraw.fill()}for(i=0;i<e.length;i++){g=e[i].index;r.ctxDraw.beginPath(),r.ctxDraw.arc(n[g][2]*o+r.imgPar.imgx,n[g][3]*o+r.imgPar.imgy,r.outlinePar.radius,0,2*Math.PI),r.ctxDraw.fill()}r.ctxDraw.fillStyle=C.staticCirCol}},drawLines:function(t,e){var r=this;if(t.ctxDraw.clearRect(0,0,t.canvasDraw.width,t.canvasDraw.height),t.ctxDraw.strokeStyle=C.perfCol,t.ctxDraw.lineWidth=t.outlinePar.lineWidth,t.ctxDraw.globalAlpha=1,C.data.isTutorial===C.isTutorial[0]||""==e||null==e||null==e)r.drawLine(C.LineType[1],t),r.drawLine(C.LineType[2],t);else if(0===e.dir)r.setRgb(e,t.APIPar.firstColorArray,t),r.drawLine(C.LineType[1],t),r.drawLine(C.LineType[2],t);else if(1===e.dir)r.setRgb(e,t.APIPar.secondColorArray,t),r.drawLine(C.LineType[1],t),r.drawLine(C.LineType[2],t);else{r.drawLine(C.LineType[1],t),r.drawLine(C.LineType[2],t);var n=e.index.split("-");angular.forEach(t.APIPar.PaintLines_target,function(i,a){i.LineName===n[0]&&r.setRgb(e,t.APIPar.PaintLines_target[a],t)})}t.ctxDraw.strokeStyle=C.perfCol,t.ctxDraw.lineCap=C.lineCap,angular.forEach(t.outlinePar.PaintLines,function(a){C.data.isTutorial===C.isTutorial[0]?(t.ctxDraw.beginPath(),t.ctxDraw.moveTo(a.StartPt.x,a.StartPt.y),t.ctxDraw.lineTo(a.EndPt.x,a.EndPt.y),t.ctxDraw.lineWidth=t.outlinePar.lineWidth,t.ctxDraw.stroke(),t.ctxDraw.closePath()):C.data.isTutorial===C.isTutorial[1]&&angular.forEach(t.APIPar.PaintLines_target,function(i){a.LineName===i.LineName&&""!=i.rgb&&(t.ctxDraw.strokeStyle=i.rgb,t.ctxDraw.beginPath(),t.ctxDraw.moveTo(a.StartPt.x,a.StartPt.y),t.ctxDraw.lineTo(a.EndPt.x,a.EndPt.y),t.ctxDraw.lineWidth=t.outlinePar.lineWidth,t.ctxDraw.stroke(),t.ctxDraw.closePath())})})},drawLine:function(i,a){var t=C.drawDirIndex[a.imgDir][i]===C.drawDir[0]?0:2,e=C.drawDirIndex[a.imgDir][i]===C.drawDir[0]?C.data.COLOR[a.imgDir][0]:C.data.COLOR[a.imgDir][1],r=C.data.pts[a.imgDir];if(a.ctxDraw.beginPath(),a.ctxDraw.moveTo(r[0][t]*a.contPar.winScaling,r[0][t+1]*a.contPar.winScaling),C.data.isTutorial===C.isTutorial[1]){if(i===C.LineType[1])var n=a.APIPar.firstColorArray;else if(i===C.LineType[2])n=a.APIPar.secondColorArray;for(var o=1;o<r.length;o++){for(var g=0;g<n.length;g++)(o===n[g].index||1===o&&n[g].index===o-1)&&(a.ctxDraw.stroke(),a.ctxDraw.strokeStyle=n[g].rgb,a.ctxDraw.beginPath(),a.ctxDraw.moveTo(r[o-1][t]*a.contPar.winScaling,r[o-1][t+1]*a.contPar.winScaling));a.ctxDraw.lineTo(r[o][t]*a.contPar.winScaling,r[o][t+1]*a.contPar.winScaling)}}else for(o=1;o<r.length;o++){for(g=0;g<e.length;g++)o===e[g][0]&&a.ctxDraw.strokeStyle!=C.warngCol||1===o&&e[g][0]===o-1?(a.ctxDraw.stroke(),a.ctxDraw.strokeStyle=C.warngCol,a.ctxDraw.beginPath(),a.ctxDraw.moveTo(r[o-1][t]*a.contPar.winScaling,r[o-1][t+1]*a.contPar.winScaling)):o===e[g][1]&&a.ctxDraw.strokeStyle!=C.perfCol&&(a.ctxDraw.stroke(),a.ctxDraw.strokeStyle=C.perfCol,a.ctxDraw.beginPath(),a.ctxDraw.moveTo(r[o-1][t]*a.contPar.winScaling,r[o-1][t+1]*a.contPar.winScaling));a.ctxDraw.lineTo(r[o][t]*a.contPar.winScaling,r[o][t+1]*a.contPar.winScaling)}a.ctxDraw.stroke()},canvasClick:function(i,t){var e=this,a=C.data.MP[t.imgDir][0].length,r="img"+t.imgDir;if($("body").trigger(r+"_Click2Suspension_out"),t.infPar.eventFlag===C.Flag[0]&&t.infPar.drawFlag===C.Flag[0]&&C.APIFlag==C.Flag[0]){t.infPar.eventFlag=C.Flag[1],t.clickEvePar.clickX=i.offsetX?i.offsetX:i.touches[0].pageX-t.drawCanvasJqueryId.offset().left,t.clickEvePar.clickY=i.offsetY?i.offsetY:i.touches[0].pageY-t.drawCanvasJqueryId.offset().top,t.dgImgPar.preOffsetx=t.clickEvePar.clickX,t.dgImgPar.preOffsety=t.clickEvePar.clickY,t.dgImgPar.preimgx=t.imgPar.imgx,t.dgImgPar.preimgy=t.imgPar.imgy,angular.forEach(t.outlinePar.PaintLines,function(i,a){if(i.LineType!=C.LineType[0]){if(Math.sqrt(Math.pow(i.EndPt.x-t.clickEvePar.clickX,2)+Math.pow(i.EndPt.y-t.clickEvePar.clickY,2))<t.outlinePar.radius*C.enLargePLCirRadius*C.mobileTouchRatio)return null!=t.clickEvePar.previousSelectedCircle&&(t.clickEvePar.previousSelectedCircle.isSelected=!1),t.clickEvePar.previousSelectedCircle=t.outlinePar.PaintLines[a].EndPt,t.outlinePar.PaintLines[a].isSelected=!0,t.mSelPointPar.mSelectedCircleIndex=t.outlinePar.PaintLines[a].LineName,$("body").trigger(r+"_Click2Suspension_in",[{dir:2,index:t.mSelPointPar.mSelectedCircleIndex,x:i.EndPt.x,y:i.EndPt.y}]),e.pushRetroversion(t),void(t.clickEvePar.isDraggingCir=C.isDraggingCir[1])}else{if(Math.sqrt(Math.pow(i.StartPt.x-t.clickEvePar.clickX,2)+Math.pow(i.StartPt.y-t.clickEvePar.clickY,2))<t.outlinePar.radius*C.mobileTouchRatio)return null!=t.clickEvePar.previousSelectedCircle&&(t.clickEvePar.previousSelectedCircle.isSelected=!1),t.clickEvePar.previousSelectedCircle=t.outlinePar.PaintLines[a].StartPt,t.outlinePar.PaintLines[a].isSelected=!0,t.mSelPointPar.mSelectedCircleIndex=t.outlinePar.PaintLines[a].LineName+"-S",$("body").trigger(r+"_Click2Suspension_in",[{dir:2,index:t.mSelPointPar.mSelectedCircleIndex,x:i.StartPt.x,y:i.StartPt.y}]),e.pushRetroversion(t),void(t.clickEvePar.isDraggingCir=C.isDraggingCir[1]);if(Math.sqrt(Math.pow(i.EndPt.x-t.clickEvePar.clickX,2)+Math.pow(i.EndPt.y-t.clickEvePar.clickY,2))<t.outlinePar.radius*C.mobileTouchRatio)return null!=t.clickEvePar.previousSelectedCircle&&(t.clickEvePar.previousSelectedCircle.isSelected=!1),t.clickEvePar.previousSelectedCircle=t.outlinePar.PaintLines[a].EndPt,t.outlinePar.PaintLines[a].isSelected=!0,t.mSelPointPar.mSelectedCircleIndex=t.outlinePar.PaintLines[a].LineName+"-E",$("body").trigger(r+"_Click2Suspension_in",[{dir:2,index:t.mSelPointPar.mSelectedCircleIndex,x:i.EndPt.x,y:i.EndPt.y}]),e.pushRetroversion(t),void(t.clickEvePar.isDraggingCir=C.isDraggingCir[1])}});for(var n=0;n<t.outlinePar.circles.length;n++){var o=t.outlinePar.circles[n];if(Math.sqrt(Math.pow(o.x-t.clickEvePar.clickX,2)+Math.pow(o.y-t.clickEvePar.clickY,2))<=t.outlinePar.radius*C.mobileTouchRatio){null!=t.clickEvePar.previousSelectedCircle&&(t.clickEvePar.previousSelectedCircle.isSelected=!1),(t.clickEvePar.previousSelectedCircle=o).isSelected=!0;var g=0;if((t.mSelPointPar.mSelectedCircleIndex=n)<a){for(var s=0;s<n;s++)t.outlinePar.circles[s].sign===C.sign[1]&&g++;$("body").trigger(r+"_Click2Suspension_in",[{dir:0,index:t.mSelPointPar.mSelectedCircleIndex-g,x:o.x,y:o.y}])}else{for(s=a;s<n;s++)t.outlinePar.circles[s].sign===C.sign[1]&&g++;$("body").trigger(r+"_Click2Suspension_in",[{dir:1,index:t.mSelPointPar.mSelectedCircleIndex-a-g,x:o.x,y:o.y}])}return e.pushRetroversion(t),void(t.clickEvePar.isDraggingCir=C.isDraggingCir[1])}}t.dgImgPar.draggingCanvas=C.draggingCanvas[1]}},dragging:function(i,t){var e=this,a=C.data.pts[t.imgDir],r=C.data.imgSize[t.imgDir][0],n=C.data.imgSize[t.imgDir][1],o=C.data.MP[t.imgDir][0],g=C.data.MP[t.imgDir][1];if(e.judgeOnPoint(i,t),t.clickEvePar.isDraggingCir===C.isDraggingCir[1]){if(null!=t.clickEvePar.previousSelectedCircle){var s=i.offsetX?i.offsetX:i.touches[0].pageX-t.drawCanvasJqueryId.offset().left,l=i.offsetY?i.offsetY:i.touches[0].pageY-t.drawCanvasJqueryId.offset().top,c=t.mSelPointPar.mSelectedCircleIndex;if(C.testNum.test(c)){var m=s-t.outlinePar.originalCircles[c].x,P=l-t.outlinePar.originalCircles[c].y;if(Math.pow(m,2)+Math.pow(P,2)<Math.pow(t.outlinePar.distanceBound,2)){var d=s-t.outlinePar.circles[c].x,u=l-t.outlinePar.circles[c].y;t.clickEvePar.previousSelectedCircle.x=s,t.clickEvePar.previousSelectedCircle.y=l,t.outlinePar.circles[c]=t.clickEvePar.previousSelectedCircle,e.mSelectedPoint(d,u,c,t)}else{var f=t.outlinePar.circles[c].x,w=t.outlinePar.circles[c].y,h=Math.sqrt(Math.pow(m,2)+Math.pow(P,2));t.clickEvePar.previousSelectedCircle.x=t.outlinePar.originalCircles[c].x+m/h*t.outlinePar.distanceBound,t.clickEvePar.previousSelectedCircle.y=t.outlinePar.originalCircles[c].y+P/h*t.outlinePar.distanceBound;d=t.clickEvePar.previousSelectedCircle.x-f,u=t.clickEvePar.previousSelectedCircle.y-w;t.outlinePar.circles[c]=t.clickEvePar.previousSelectedCircle,e.mSelectedPoint(d,u,c,t)}if(c<o.length)o[c].index>=C.minMPDownIndex&&o[c].index<=C.maxMPUpIndex&&angular.forEach(t.outlinePar.PaintLines,function(i,a){C.drawDirIndex[t.imgDir][i.LineType]===C.drawDir[0]&&(t.outlinePar.PaintLines[a].StartPt.x=e.findPointOnOutline(t.outlinePar.PaintLines[a].StartPt.y,C.drawDirIndex[t.imgDir][i.LineType],t))});else{var p=c-o.length;g[p].index>=C.minMPDownIndex&&g[p].index<=C.maxMPUpIndex&&angular.forEach(t.outlinePar.PaintLines,function(i,a){C.drawDirIndex[t.imgDir][i.LineType]===C.drawDir[1]&&(t.outlinePar.PaintLines[a].StartPt.x=e.findPointOnOutline(t.outlinePar.PaintLines[a].StartPt.y,C.drawDirIndex[t.imgDir][i.LineType],t))})}}else for(var S=0;S<t.outlinePar.PaintLines.length;S++){var x=t.outlinePar.PaintLines[S],y=c.split("-");if(x.LineName===y[0])if(x.LineType!=C.LineType[0]){var v=C.drawDirIndex[t.imgDir][x.LineType]===C.drawDir[0]?0:2;l>=a[C.minDownIndex][v+1]*t.contPar.winScaling?(x.EndPt.y=a[C.minDownIndex][v+1]*t.contPar.winScaling,x.StartPt.y=x.EndPt.y,x.StartPt.x=a[C.minDownIndex][v]*t.contPar.winScaling):l<=a[C.maxUpIndex][v+1]*t.contPar.winScaling?(x.EndPt.y=a[C.maxUpIndex][v+1]*t.contPar.winScaling,x.StartPt.y=x.EndPt.y,x.StartPt.x=a[C.maxUpIndex][v]*t.contPar.winScaling):(x.EndPt.y=l,x.StartPt.y=l,x.StartPt.x=e.findPointOnOutline(l,C.drawDirIndex[t.imgDir][x.LineType],t))}else x.LineType===C.LineType[0]&&("S"===y[1]?(t.clickEvePar.previousSelectedCircle.x=s,t.clickEvePar.previousSelectedCircle.y=l,t.outlinePar.PaintLines[S].StartPt.x=s,t.outlinePar.PaintLines[S].StartPt.y=l):"E"===y[1]&&(t.clickEvePar.previousSelectedCircle.x=s,t.clickEvePar.previousSelectedCircle.y=l,t.outlinePar.PaintLines[S].EndPt.x=s,t.outlinePar.PaintLines[S].EndPt.y=l))}e.drawCirLine(t)}}else if(t.dgImgPar.draggingCanvas===C.draggingCanvas[1]&&t.zoomImg.imgScaling!=t.zoomImg.MIN_SCALE){t.ctxDraw.clearRect(0,0,t.canvasDraw.width,t.canvasDraw.height),t.ctxImg.clearRect(0,0,t.canvasImg.width,t.canvasImg.height);s=i.offsetX?i.offsetX:i.touches[0].pageX-t.drawCanvasJqueryId.offset().left,l=i.offsetY?i.offsetY:i.touches[0].pageY-t.drawCanvasJqueryId.offset().top;var I=s-t.dgImgPar.preOffsetx,b=l-t.dgImgPar.preOffsety;t.dgImgPar.draggingCanvasScale=t.zoomImg.imgScaling,t.imgPar.imgx+=I,t.imgPar.imgy+=b,t.imgPar.imgx>=.5*t.canvasImg.width-t.imgPar.imgw*t.zoomImg.imgScaling&&Math.abs(t.imgPar.imgy)<=t.canvasImg.height*(t.zoomImg.imgScaling-1)&&t.imgPar.imgx<=.5*t.canvasImg.width&&t.imgPar.imgy<=0?(t.ctxImg.drawImage(t.imgPar.img,0,0,r,n,t.imgPar.imgx,t.imgPar.imgy,t.imgPar.imgw*t.zoomImg.imgScaling,t.imgPar.imgh*t.zoomImg.imgScaling),t.dgImgPar.preOffsetx=s,t.dgImgPar.preOffsety=l,t.dgImgPar.zoomCauseDrag===C.zoomCauseDrag[1]&&(t.dgImgPar.zoomCauseDrag=C.zoomCauseDrag[0])):t.dgImgPar.zoomCauseDrag===C.zoomCauseDrag[1]&&Math.abs(t.imgPar.imgy)<=t.canvasImg.height*(t.zoomImg.imgScaling-1)&&t.imgPar.imgy<=0?(t.ctxImg.drawImage(t.imgPar.img,0,0,r,n,t.imgPar.imgx,t.imgPar.imgy,t.imgPar.imgw*t.zoomImg.imgScaling,t.imgPar.imgh*t.zoomImg.imgScaling),t.dgImgPar.preOffsetx=s,t.dgImgPar.preOffsety=l):(t.imgPar.imgx-=I,t.imgPar.imgy-=b,t.ctxImg.drawImage(t.imgPar.img,0,0,r,n,t.imgPar.imgx,t.imgPar.imgy,t.imgPar.imgw*t.zoomImg.imgScaling,t.imgPar.imgh*t.zoomImg.imgScaling))}},stopDragging:function(i,t){var a=C.data.pts[t.imgDir],e="img"+t.imgDir,r=C.data.MP[t.imgDir][0].length;if(t.dgImgPar.draggingCanvas===C.draggingCanvas[1]){for(var n=t.imgPar.imgx-t.dgImgPar.preimgx,o=t.imgPar.imgy-t.dgImgPar.preimgy,g=0;g<t.outlinePar.circles.length;g++)t.outlinePar.circles[g].x+=n,t.outlinePar.circles[g].y+=o,t.outlinePar.originalCircles[g].x+=n,t.outlinePar.originalCircles[g].y+=o;for(g=0;g<a.length;g++)a[g][0]+=n/t.contPar.winScaling,a[g][1]+=o/t.contPar.winScaling,a[g][2]+=n/t.contPar.winScaling,a[g][3]+=o/t.contPar.winScaling;angular.forEach(t.outlinePar.PaintLines,function(i,a){t.outlinePar.PaintLines[a].StartPt.x+=n,t.outlinePar.PaintLines[a].StartPt.y+=o,t.outlinePar.PaintLines[a].EndPt.x+=n,t.outlinePar.PaintLines[a].EndPt.y+=o}),t.dgImgPar.draggingCanvas=C.draggingCanvas[0],this.drawCirLine(t),t.infPar.eventFlag=C.Flag[0]}if(t.clickEvePar.isDraggingCir===C.isDraggingCir[1]){var s;if(0!=t.retrPar.retrArray.length)if(i.offsetX===t.clickEvePar.clickX&&i.offsetY===t.clickEvePar.clickY)t.retrPar.retrArray.pop();else{var l=this.uploadRetrPoint(t.retrPar.retrArray.pop(),t);t.retrPar.retrArray.push(l);var c=C.testNum,m=t.mSelPointPar.mSelectedCircleIndex;if(c.test(m)){var P=t.contPar.winScaling*t.zoomImg.imgScaling,d=(t.outlinePar.circles[m].x-t.imgPar.imgx)/P,u=(t.outlinePar.circles[m].y-t.imgPar.imgy)/P;s=m<r?{dir:0,index:m,x:d,y:u}:{dir:1,index:m-r,x:d,y:u},$("body").trigger(e+"_Mouseup2ChgColor",[s])}else{var f=m.split("-");angular.forEach(t.outlinePar.PaintLines,function(i){f[0]===i.LineName&&(s={dir:2,index:m,x:(i.EndPt.x-t.imgPar.imgx)/(t.contPar.winScaling*t.zoomImg.imgScaling),y:(i.EndPt.y-t.imgPar.imgy)/(t.contPar.winScaling*t.zoomImg.imgScaling)},$("body").trigger(e+"_Mouseup2ChgColor",[s]))})}}t.clickEvePar.isDraggingCir=C.isDraggingCir[0],C.data.isTutorial===C.isTutorial[1]?this.drawCirLine(t,s):this.drawCirLine(t),t.infPar.eventFlag=C.Flag[0]}},scaleImg:function(i,t){if(t.infPar.eventFlag===C.Flag[0]&&t.infPar.drawFlag===C.Flag[0]&&C.APIFlag==C.Flag[0]){t.infPar.eventFlag=C.Flag[1];var a=C.data.pts[t.imgDir],e=C.data.imgSize[t.imgDir][0],r=C.data.imgSize[t.imgDir][1];1===t.zoomImg.imgScaling&&(t.zoomImg.offsetX=i.offsetX,t.zoomImg.offsetY=i.offsetY,t.dgImgPar.draggingCanvasScale=1);var n=0;if(i||(i=window.event),i.wheelDelta?(n=i.wheelDelta/120,window.opera&&(n=-n)):i.detail&&(n=-i.detail/3),t.zoomImg.zoom=Math.exp(n*t.zoomImg.zoomIntensity),t.zoomImg.imgScaling*t.zoomImg.zoom<t.zoomImg.MIN_SCALE&&0!=t.imgPar.imgy){if(t.zoomImg.zoom=1/t.zoomImg.imgScaling,t.outlinePar.distanceBound*=t.zoomImg.zoom,t.ctxImg.clearRect(0,0,t.canvasDraw.width,t.canvasDraw.height),t.zoomImg.zoom<=1){t.zoomImg.bfScalingimgx=t.imgPar.imgx,t.zoomImg.bfScalingimgy=t.imgPar.imgy,t.imgPar.imgx=(t.contPar.width-t.imgPar.imgw)/2;for(var o=t.imgPar.imgy=0;o<t.outlinePar.circles.length;o++)t.outlinePar.circles[o].x=t.imgPar.imgx+(t.outlinePar.circles[o].x-t.zoomImg.bfScalingimgx)*t.zoomImg.zoom,t.outlinePar.circles[o].y=t.imgPar.imgy+(t.outlinePar.circles[o].y-t.zoomImg.bfScalingimgy)*t.zoomImg.zoom,t.outlinePar.originalCircles[o].x=t.imgPar.imgx+(t.outlinePar.originalCircles[o].x-t.zoomImg.bfScalingimgx)*t.zoomImg.zoom,t.outlinePar.originalCircles[o].y=t.imgPar.imgy+(t.outlinePar.originalCircles[o].y-t.zoomImg.bfScalingimgy)*t.zoomImg.zoom;for(o=0;o<a.length;o++)a[o][0]=(t.imgPar.imgx+(a[o][0]*t.contPar.winScaling-t.zoomImg.bfScalingimgx)*t.zoomImg.zoom)/t.contPar.winScaling,a[o][1]=(t.imgPar.imgy+(a[o][1]*t.contPar.winScaling-t.zoomImg.bfScalingimgy)*t.zoomImg.zoom)/t.contPar.winScaling,a[o][2]=(t.imgPar.imgx+(a[o][2]*t.contPar.winScaling-t.zoomImg.bfScalingimgx)*t.zoomImg.zoom)/t.contPar.winScaling,a[o][3]=(t.imgPar.imgy+(a[o][3]*t.contPar.winScaling-t.zoomImg.bfScalingimgy)*t.zoomImg.zoom)/t.contPar.winScaling;angular.forEach(t.outlinePar.PaintLines,function(i,a){t.outlinePar.PaintLines[a].StartPt.x=t.imgPar.imgx+(t.outlinePar.PaintLines[a].StartPt.x-t.zoomImg.bfScalingimgx)*t.zoomImg.zoom,t.outlinePar.PaintLines[a].StartPt.y=t.imgPar.imgy+(t.outlinePar.PaintLines[a].StartPt.y-t.zoomImg.bfScalingimgy)*t.zoomImg.zoom,t.outlinePar.PaintLines[a].EndPt.x=t.imgPar.imgx+(t.outlinePar.PaintLines[a].EndPt.x-t.zoomImg.bfScalingimgx)*t.zoomImg.zoom,t.outlinePar.PaintLines[a].EndPt.y=t.imgPar.imgy+(t.outlinePar.PaintLines[a].EndPt.y-t.zoomImg.bfScalingimgy)*t.zoomImg.zoom})}t.ctxImg.drawImage(t.imgPar.img,0,0,e,r,t.imgPar.imgx,t.imgPar.imgy,t.imgPar.imgw,t.imgPar.imgh),t.zoomImg.imgScaling=t.zoomImg.MIN_SCALE,this.drawCirLine(t)}else if(t.zoomImg.imgScaling*t.zoomImg.zoom>=t.zoomImg.MIN_SCALE&&t.zoomImg.imgScaling*t.zoomImg.zoom<=t.zoomImg.MAX_SCALE){if(t.outlinePar.distanceBound*=t.zoomImg.zoom,t.ctxImg.clearRect(0,0,t.canvasDraw.width,t.canvasDraw.height),t.zoomImg.zoom<1){var g=(t.zoomImg.imgScaling-t.zoomImg.imgScaling*t.zoomImg.zoom)/(t.zoomImg.imgScaling-1);t.zoomImg.bfScalingimgx=t.imgPar.imgx,t.zoomImg.bfScalingimgy=t.imgPar.imgy,t.imgPar.imgx+=((t.canvasDraw.width-t.imgPar.imgw)/2-t.imgPar.imgx)*g,t.imgPar.imgy+=-t.imgPar.imgy*g;for(o=0;o<t.outlinePar.circles.length;o++)t.outlinePar.circles[o].x=t.imgPar.imgx+(t.outlinePar.circles[o].x-t.zoomImg.bfScalingimgx)*t.zoomImg.zoom,t.outlinePar.circles[o].y=t.imgPar.imgy+(t.outlinePar.circles[o].y-t.zoomImg.bfScalingimgy)*t.zoomImg.zoom,t.outlinePar.originalCircles[o].x=t.imgPar.imgx+(t.outlinePar.originalCircles[o].x-t.zoomImg.bfScalingimgx)*t.zoomImg.zoom,t.outlinePar.originalCircles[o].y=t.imgPar.imgy+(t.outlinePar.originalCircles[o].y-t.zoomImg.bfScalingimgy)*t.zoomImg.zoom;for(o=0;o<a.length;o++)a[o][0]=(t.imgPar.imgx+(a[o][0]*t.contPar.winScaling-t.zoomImg.bfScalingimgx)*t.zoomImg.zoom)/t.contPar.winScaling,a[o][1]=(t.imgPar.imgy+(a[o][1]*t.contPar.winScaling-t.zoomImg.bfScalingimgy)*t.zoomImg.zoom)/t.contPar.winScaling,a[o][2]=(t.imgPar.imgx+(a[o][2]*t.contPar.winScaling-t.zoomImg.bfScalingimgx)*t.zoomImg.zoom)/t.contPar.winScaling,a[o][3]=(t.imgPar.imgy+(a[o][3]*t.contPar.winScaling-t.zoomImg.bfScalingimgy)*t.zoomImg.zoom)/t.contPar.winScaling;angular.forEach(t.outlinePar.PaintLines,function(i,a){t.outlinePar.PaintLines[a].StartPt.x=t.imgPar.imgx+(t.outlinePar.PaintLines[a].StartPt.x-t.zoomImg.bfScalingimgx)*t.zoomImg.zoom,t.outlinePar.PaintLines[a].StartPt.y=t.imgPar.imgy+(t.outlinePar.PaintLines[a].StartPt.y-t.zoomImg.bfScalingimgy)*t.zoomImg.zoom,t.outlinePar.PaintLines[a].EndPt.x=t.imgPar.imgx+(t.outlinePar.PaintLines[a].EndPt.x-t.zoomImg.bfScalingimgx)*t.zoomImg.zoom,t.outlinePar.PaintLines[a].EndPt.y=t.imgPar.imgy+(t.outlinePar.PaintLines[a].EndPt.y-t.zoomImg.bfScalingimgy)*t.zoomImg.zoom})}else{t.imgPar.imgx-=(t.zoomImg.offsetX-t.imgPar.imgx)*(t.zoomImg.zoom-1),t.imgPar.imgy-=(t.zoomImg.offsetY-t.imgPar.imgy)*(t.zoomImg.zoom-1);for(o=0;o<t.outlinePar.circles.length;o++)t.outlinePar.circles[o].x-=(t.zoomImg.offsetX-t.outlinePar.circles[o].x)*(t.zoomImg.zoom-1),t.outlinePar.circles[o].y-=(t.zoomImg.offsetY-t.outlinePar.circles[o].y)*(t.zoomImg.zoom-1),t.outlinePar.originalCircles[o].x-=(t.zoomImg.offsetX-t.outlinePar.originalCircles[o].x)*(t.zoomImg.zoom-1),t.outlinePar.originalCircles[o].y-=(t.zoomImg.offsetY-t.outlinePar.originalCircles[o].y)*(t.zoomImg.zoom-1);for(o=0;o<a.length;o++)a[o][0]-=(t.zoomImg.offsetX-a[o][0]*t.contPar.winScaling)*(t.zoomImg.zoom-1)/t.contPar.winScaling,a[o][1]-=(t.zoomImg.offsetY-a[o][1]*t.contPar.winScaling)*(t.zoomImg.zoom-1)/t.contPar.winScaling,a[o][2]-=(t.zoomImg.offsetX-a[o][2]*t.contPar.winScaling)*(t.zoomImg.zoom-1)/t.contPar.winScaling,a[o][3]-=(t.zoomImg.offsetY-a[o][3]*t.contPar.winScaling)*(t.zoomImg.zoom-1)/t.contPar.winScaling;angular.forEach(t.outlinePar.PaintLines,function(i,a){t.outlinePar.PaintLines[a].StartPt.x-=(t.zoomImg.offsetX-t.outlinePar.PaintLines[a].StartPt.x)*(t.zoomImg.zoom-1),t.outlinePar.PaintLines[a].StartPt.y-=(t.zoomImg.offsetY-t.outlinePar.PaintLines[a].StartPt.y)*(t.zoomImg.zoom-1),t.outlinePar.PaintLines[a].EndPt.x-=(t.zoomImg.offsetX-t.outlinePar.PaintLines[a].EndPt.x)*(t.zoomImg.zoom-1),t.outlinePar.PaintLines[a].EndPt.y-=(t.zoomImg.offsetY-t.outlinePar.PaintLines[a].EndPt.y)*(t.zoomImg.zoom-1)}),t.imgPar.imgx>=.5*t.canvasImg.width-t.imgPar.imgw*t.zoomImg.imgScaling&&t.imgPar.imgx<=.5*t.canvasImg.width||(t.dgImgPar.zoomCauseDrag=C.zoomCauseDrag[1])}t.ctxImg.drawImage(t.imgPar.img,0,0,e,r,t.imgPar.imgx,t.imgPar.imgy,t.imgPar.imgw*t.zoomImg.imgScaling*t.zoomImg.zoom,t.imgPar.imgh*t.zoomImg.imgScaling*t.zoomImg.zoom),t.zoomImg.imgScaling*=t.zoomImg.zoom,this.drawCirLine(t)}t.infPar.eventFlag=C.Flag[0]}},addDelMP:function(i,a){if(a.infPar.eventFlag===C.Flag[0]&&a.infPar.drawFlag===C.Flag[0]&&C.APIFlag==C.Flag[0]){a.infPar.eventFlag=C.Flag[1];var t=this,e=C.data.MP[a.imgDir][0],r=C.data.MP[a.imgDir][1],n=C.data.pts[a.imgDir],o=C.originalData.pts[a.imgDir];if(t.judgeOnPoint(i,a),a.addDelMPPar.hoverPointSign===C.sign[1]){t.pushRetroversion(a);var g=t.uploadRetrPoint(a.retrPar.retrArray.pop(),a);return a.retrPar.retrArray.push(g),a.outlinePar.circles.splice(a.addDelMPPar.delCirIndex,1),a.outlinePar.originalCircles.splice(a.addDelMPPar.delCirIndex,1),a.addDelMPPar.delCirIndex<e.length?e.splice(a.addDelMPPar.delCirIndex,1):r.splice(a.addDelMPPar.delCirIndex-e.length,1),t.drawCirLine(a),void(a.infPar.eventFlag=C.Flag[0])}if(a.APIPar.hoverOnPoint===C.hoverOnPoint[0]){var s=i.offsetX?i.offsetX:i.touches[0].pageX-a.drawCanvasJqueryId.offset().left,l=i.offsetY?i.offsetY:i.touches[0].pageY-a.drawCanvasJqueryId.offset().top,c=t.findClosestPoint(a,s,l);if(Math.pow(c.dVx,2)+Math.pow(c.dVy,2)<=Math.pow(a.outlinePar.radius,2)){t.pushRetroversion(a);g=t.uploadRetrPoint(a.retrPar.retrArray.pop(),a);a.retrPar.retrArray.push(g),c.drawDir===C.drawDir[0]?(e.push({index:c.index,sign:C.sign[1]}),e.sort(t.compare)):c.drawDir===C.drawDir[1]&&(r.push({index:c.index,sign:C.sign[1]}),r.sort(t.compare)),a.outlinePar.circles=new Array,a.outlinePar.originalCircles=new Array;for(var m=0;m<e.length;m++){var P=e[m].index,d=t.createcircle(n[P][0]*a.contPar.winScaling,n[P][1]*a.contPar.winScaling,e[m].sign),u=t.createcircle(o[P][0]*a.contPar.winScaling*a.zoomImg.imgScaling+a.imgPar.imgx,o[P][1]*a.contPar.winScaling*a.zoomImg.imgScaling+a.imgPar.imgy,e[m].sign);a.outlinePar.circles.push(d),a.outlinePar.originalCircles.push(u)}for(m=0;m<r.length;m++){P=r[m].index,d=t.createcircle(n[P][2]*a.contPar.winScaling,n[P][3]*a.contPar.winScaling,r[m].sign),u=t.createcircle(o[P][2]*a.contPar.winScaling*a.zoomImg.imgScaling+a.imgPar.imgx,o[P][3]*a.contPar.winScaling*a.zoomImg.imgScaling+a.imgPar.imgy,r[m].sign);a.outlinePar.circles.push(d),a.outlinePar.originalCircles.push(u)}t.drawCirLine(a)}}a.infPar.eventFlag=C.Flag[0]}},pushRetroversion:function(i){if(i.clickEvePar.isDraggingCir===C.isDraggingCir[0]){var a=this.keepRetrPoint(i,this);i.retrPar.retrArray.length!=i.retrPar.MaxRetrNum?i.retrPar.retrArray.push(a):(i.retrPar.retrArray.shift(),i.retrPar.retrArray.push(a),i.retrPar.overMaxRetrNum=C.overMaxRetrNum[1])}},keepRetrPoint:function(i){var a=this,t=a.cloneObj(C.data.MP[i.imgDir][0]),e=a.cloneObj(C.data.MP[i.imgDir][1]);return{pts:a.cloneObj(C.data.pts[i.imgDir]),firMP:t,secMP:e,circles:a.cloneObj(i.outlinePar.circles),originalCircles:a.cloneObj(i.outlinePar.originalCircles),PaintLines:a.cloneObj(i.outlinePar.PaintLines),firstColorArray:a.cloneObj(i.APIPar.firstColorArray),secondColorArray:a.cloneObj(i.APIPar.secondColorArray),PaintLines_target:a.cloneObj(i.APIPar.PaintLines_target)}},uploadRetrPoint:function(i,a){C.adjustImgStatus[a.imgDir]=!0;var t=this;$(a.retrPar.retrButton).removeAttr("disabled");for(var e=a.contPar.winScaling*a.zoomImg.imgScaling,r=t.cloneObj(i.firMP),n=t.cloneObj(i.secMP),o=t.cloneObj(i.circles),g=0;g<o.length;g++)o[g].x=(o[g].x-a.imgPar.imgx)/e,o[g].y=(o[g].y-a.imgPar.imgy)/e;var s=t.cloneObj(i.originalCircles);for(g=0;g<o.length;g++)s[g].x=(s[g].x-a.imgPar.imgx)/e,s[g].y=(s[g].y-a.imgPar.imgy)/e;var l=new Array;for(g=0;g<i.pts.length;g++)l[g]=new Array(4),l[g][0]=(i.pts[g][0]*a.contPar.winScaling-a.imgPar.imgx)/e,l[g][1]=(i.pts[g][1]*a.contPar.winScaling-a.imgPar.imgy)/e,l[g][2]=(i.pts[g][2]*a.contPar.winScaling-a.imgPar.imgx)/e,l[g][3]=(i.pts[g][3]*a.contPar.winScaling-a.imgPar.imgy)/e;var c=t.cloneObj(i.PaintLines);for(g=0;g<c.length;g++)c[g].StartPt.x=(c[g].StartPt.x-a.imgPar.imgx)/e,c[g].StartPt.y=(c[g].StartPt.y-a.imgPar.imgy)/e,c[g].EndPt.x=(c[g].EndPt.x-a.imgPar.imgx)/e,c[g].EndPt.y=(c[g].EndPt.y-a.imgPar.imgy)/e;return{firMP:r,secMP:n,circles:o,originalCircles:s,pts:l,PaintLines:c,firstColorArray:t.cloneObj(i.firstColorArray),secondColorArray:t.cloneObj(i.secondColorArray),PaintLines_target:t.cloneObj(i.PaintLines_target)}},doRetroversion:function(i){var a=this;if(0!==i.retrPar.retrArray.length){var t=C.data.pts[i.imgDir];if(i.infPar.eventFlag===C.Flag[0]&&i.infPar.drawFlag===C.Flag[0]&&C.APIFlag==C.Flag[0]){i.infPar.eventFlag=C.Flag[1];var e=i.retrPar.retrArray.pop(),r=i.contPar.winScaling*i.zoomImg.imgScaling;C.data.MP[i.imgDir][0]=a.cloneObj(e.firMP),C.data.MP[i.imgDir][1]=a.cloneObj(e.secMP),i.outlinePar.circles=a.cloneObj(e.circles);for(var n=0;n<i.outlinePar.circles.length;n++)i.outlinePar.circles[n].x=i.outlinePar.circles[n].x*r+i.imgPar.imgx,i.outlinePar.circles[n].y=i.outlinePar.circles[n].y*r+i.imgPar.imgy;i.outlinePar.originalCircles=a.cloneObj(e.originalCircles);for(n=0;n<i.outlinePar.circles.length;n++)i.outlinePar.originalCircles[n].x=i.outlinePar.originalCircles[n].x*r+i.imgPar.imgx,i.outlinePar.originalCircles[n].y=i.outlinePar.originalCircles[n].y*r+i.imgPar.imgy;for(n=0;n<t.length;n++)t[n][0]=e.pts[n][0]*i.zoomImg.imgScaling+i.imgPar.imgx/i.contPar.winScaling,t[n][1]=e.pts[n][1]*i.zoomImg.imgScaling+i.imgPar.imgy/i.contPar.winScaling,t[n][2]=e.pts[n][2]*i.zoomImg.imgScaling+i.imgPar.imgx/i.contPar.winScaling,t[n][3]=e.pts[n][3]*i.zoomImg.imgScaling+i.imgPar.imgy/i.contPar.winScaling;i.outlinePar.PaintLines=a.cloneObj(e.PaintLines);for(n=0;n<i.outlinePar.PaintLines.length;n++)i.outlinePar.PaintLines[n].StartPt.x=i.outlinePar.PaintLines[n].StartPt.x*r+i.imgPar.imgx,i.outlinePar.PaintLines[n].StartPt.y=i.outlinePar.PaintLines[n].StartPt.y*r+i.imgPar.imgy,i.outlinePar.PaintLines[n].EndPt.x=i.outlinePar.PaintLines[n].EndPt.x*r+i.imgPar.imgx,i.outlinePar.PaintLines[n].EndPt.y=i.outlinePar.PaintLines[n].EndPt.y*r+i.imgPar.imgy;i.APIPar.firstColorArray=a.cloneObj(e.firstColorArray),i.APIPar.secondColorArray=a.cloneObj(e.secondColorArray),i.APIPar.PaintLines_target=a.cloneObj(e.PaintLines_target),0===i.retrPar.retrArray.length&&(i.retrPar.overMaxRetrNum===C.overMaxRetrNum[0]?C.adjustImgStatus[i.imgDir]=!1:C.adjustImgStatus[i.imgDir]=!0,$(i.retrPar.retrButton).attr("disabled","true")),i.infPar.eventFlag=C.Flag[0]}a.drawCirLine(i)}},createcircle:function(i,a,t){return{x:i,y:a,isSelected:!1,sign:t}},mSelectedPoint:function(i,a,t,e){var r,n,o,g,s=C.data.pts[e.imgDir],l=C.data.MP[e.imgDir][0],c=C.data.MP[e.imgDir][1];if(t<l.length)n=(r=0)<t?l[t-1].index:0,o=t<l.length-1?l[t+1].index:s.length,g=l[t].index;else{r=2;var m=t-l.length;n=0<m?c[m-1].index:0,o=m<c.length-1?c[m+1].index:s.length,g=c[m].index}for(var P=parseInt(n);P<parseInt(o);P++)if(P<g){var d=i/((g-n)/2)*((g-n)/2-(g-P)/2)/e.contPar.winScaling,u=a/((g-n)/2)*((g-n)/2-(g-P)/2)/e.contPar.winScaling;s[P][r]=parseFloat(s[P][r])+parseFloat(d),s[P][r+1]=parseFloat(s[P][r+1])+parseFloat(u)}else if(P===g)s[P][r]=parseFloat(s[P][r])+parseFloat(i)/e.contPar.winScaling,s[P][r+1]=parseFloat(s[P][r+1])+parseFloat(a)/e.contPar.winScaling;else{d=i/((o-g)/2)*((o-g)/2-(P-g)/2)/e.contPar.winScaling,u=a/((o-g)/2)*((o-g)/2-(P-g)/2)/e.contPar.winScaling;s[P][r]=parseFloat(s[P][r])+parseFloat(d),s[P][r+1]=parseFloat(s[P][r+1])+parseFloat(u)}},judgeOnPoint:function(i,a){for(var t="img"+a.imgDir,e=C.data.MP[a.imgDir][0].length,r=!1,n=!1,o=i.offsetX?i.offsetX:i.touches[0].pageX-a.drawCanvasJqueryId.offset().left,g=i.offsetY?i.offsetY:i.touches[0].pageY-a.drawCanvasJqueryId.offset().top,s=0;s<a.outlinePar.PaintLines.length;s++){var l=a.outlinePar.PaintLines[s];if(l.LineType!=C.LineType[0]){if(Math.sqrt(Math.pow(l.EndPt.x-o,2)+Math.pow(l.EndPt.y-g,2))<a.outlinePar.radius*C.enLargePLCirRadius&&(r=!0,a.APIPar.hoverOnPoint===C.hoverOnPoint[0]))return a.APIPar.hoverOnPoint=C.hoverOnPoint[1],a.addDelMPPar.hoverPointSign=C.sign[0],void $("body").trigger(t+"_Hover2Suspension_in",[{dir:2,index:l.LineName,x:l.EndPt.x,y:l.EndPt.y}])}else if(l.LineType===C.LineType[0]){if(Math.sqrt(Math.pow(l.StartPt.x-o,2)+Math.pow(l.StartPt.y-g,2))<a.outlinePar.radius&&(r=!0,a.APIPar.hoverOnPoint===C.hoverOnPoint[0]))return a.APIPar.hoverOnPoint=C.hoverOnPoint[1],a.addDelMPPar.hoverPointSign=C.sign[0],void $("body").trigger(t+"_Hover2Suspension_in",[{dir:2,index:l.LineName+"-S",x:l.StartPt.x,y:l.StartPt.y}]);if(Math.sqrt(Math.pow(l.EndPt.x-o,2)+Math.pow(l.EndPt.y-g,2))<a.outlinePar.radius&&(r=!0,a.APIPar.hoverOnPoint===C.hoverOnPoint[0]))return a.APIPar.hoverOnPoint=C.hoverOnPoint[1],a.addDelMPPar.hoverPointSign=C.sign[0],void $("body").trigger(t+"_Hover2Suspension_in",[{dir:2,index:l.LineName+"-E",x:l.EndPt.x,y:l.EndPt.y}])}}for(s=0;s<a.outlinePar.circles.length;s++){var c=a.outlinePar.circles[s];if(Math.sqrt(Math.pow(c.x-o,2)+Math.pow(c.y-g,2))<=a.outlinePar.radius&&(n=!0,a.APIPar.hoverOnPoint===C.hoverOnPoint[0])){if(a.APIPar.hoverOnPoint=C.hoverOnPoint[1],c.sign===C.sign[0]?a.addDelMPPar.hoverPointSign=C.sign[0]:a.addDelMPPar={hoverPointSign:C.sign[1],delCirIndex:s},c.sign===C.sign[0]){var m=0;if(s<e){for(var P=0;P<s;P++)a.outlinePar.circles[P].sign===C.sign[1]&&m++;$("body").trigger(t+"_Hover2Suspension_in",[{dir:0,index:s-m,x:c.x,y:c.y}])}else{for(P=e;P<s;P++)a.outlinePar.circles[P].sign===C.sign[1]&&m++;$("body").trigger(t+"_Hover2Suspension_in",[{dir:1,index:s-e-m,x:c.x,y:c.y}])}}return}}!1===r&&!1===n&&(a.APIPar.hoverOnPoint===C.hoverOnPoint[1]&&$("body").trigger(t+"_Hover2Suspension_out"),a.APIPar.hoverOnPoint=C.hoverOnPoint[0],a.addDelMPPar.hoverPointSign=C.sign[0])},findPointOnOutline:function(i,a,t){for(var e=C.MAXNUM,r=-1,n=0,o=C.data.pts[t.imgDir],g=a===C.drawDir[0]?0:2,s=C.minDownIndex;s<C.maxUpIndex;s++)(n=Math.abs(i-parseFloat(o[s][g+1]*t.contPar.winScaling)))<10&&n<e&&(e=n,r=parseFloat(o[s][g]*t.contPar.winScaling));return r},findClosestPoint:function(i,a,t){for(var e=C.data.pts[i.imgDir],r=[],n=[],o=0;o<e.length;o++)r.push(Math.abs(e[o][1]*i.contPar.winScaling-t)),n.push(Math.abs(e[o][3]*i.contPar.winScaling-t));var g=r.indexOf(Math.min.apply(null,r)),s=n.indexOf(Math.min.apply(null,n)),l=Math.abs(e[g][0]*i.contPar.winScaling-a),c=Math.abs(e[s][2]*i.contPar.winScaling-a);if(l<c)var m={drawDir:C.drawDir[0],index:g,dVx:l,dVy:r[g]};else m={drawDir:C.drawDir[1],index:s,dVx:c,dVy:n[s]};return m},cloneObj:function(i){var a,t=i.constructor===Array?[]:{};if("object"==typeof i){if(window.JSON)a=JSON.stringify(i),t=JSON.parse(a);else for(var e in i)t[e]="object"==typeof i[e]?this.cloneObj(i[e]):i[e];return t}},compare:function(i,a){return i.index<a.index?-1:i.index>a.index?1:0},setRgb:function(i,a,t){for(var e=this,r=e.cloneObj(C.data.pts[t.imgDir]),n=C.originalData.ptsTarget[t.imgDir],o=t.contPar.winScaling*t.zoomImg.imgScaling,g=0;g<r.length;g++)r[g][0]=(r[g][0]*t.contPar.winScaling-t.imgPar.imgx)/o,r[g][1]=(r[g][1]*t.contPar.winScaling-t.imgPar.imgy)/o,r[g][2]=(r[g][2]*t.contPar.winScaling-t.imgPar.imgx)/o,r[g][3]=(r[g][3]*t.contPar.winScaling-t.imgPar.imgy)/o;if(i.dir!=C.drawDir[2]){if(i.dir===C.drawDir[0]){t.APIPar.firstColorArray=new Array;for(g=0;g<r.length-1;g++){var s=Math.sqrt(Math.pow(r[g][0]-n[g][0],2)+Math.pow(r[g][1]-n[g][1],2)),l=Math.sqrt(Math.pow(r[g+1][0]-n[g+1][0],2)+Math.pow(r[g+1][1]-n[g+1][1],2));t.APIPar.firstColorArray.push({index:g,rgb:e.dist2Rgb(1-(s+l)/(2*t.outlinePar.distanceBound))})}}else if(i.dir===C.drawDir[1]){t.APIPar.secondColorArray=new Array;for(g=0;g<r.length-1;g++){s=Math.sqrt(Math.pow(r[g][2]-n[g][2],2)+Math.pow(r[g][3]-n[g][3],2)),l=Math.sqrt(Math.pow(r[g+1][2]-n[g+1][2],2)+Math.pow(r[g+1][3]-n[g+1][3],2));t.APIPar.secondColorArray.push({index:g,rgb:e.dist2Rgb(1-(s+l)/(2*t.outlinePar.distanceBound))})}}}else if(a.LineType!=C.LineType[0]){var c=Math.abs(a.EndPt.y-i.y);c=c*t.contPar.winScaling*t.zoomImg.imgScaling,a.rgb=e.dist2Rgb(1-c/t.outlinePar.distanceBound)}else{var m,P,d,u;for(o=t.contPar.winScaling*t.zoomImg.imgScaling,g=0;g<t.outlinePar.PaintLines.length;g++)t.outlinePar.PaintLines[g].LineName===a.LineName&&(m=(t.outlinePar.PaintLines[g].StartPt.x-t.imgPar.imgx)/o,P=(t.outlinePar.PaintLines[g].StartPt.y-t.imgPar.imgy)/o,d=(t.outlinePar.PaintLines[g].EndPt.x-t.imgPar.imgx)/o,u=(t.outlinePar.PaintLines[g].EndPt.y-t.imgPar.imgy)/o);var f=(Math.sqrt(Math.pow(a.StartPt.x-m,2)+Math.pow(a.StartPt.y-P,2))+Math.sqrt(Math.pow(a.EndPt.x-d,2)+Math.pow(a.EndPt.y-u,2)))*t.contPar.winScaling*t.zoomImg.imgScaling*.5;a.rgb=e.dist2Rgb(1-f/t.outlinePar.distanceBound)}},dist2Rgb:function(i){if(i<=0)var a=0;else if(i>C.closeRatio)a=255;else a=parseInt(255*this.colMathFun(i));return"rgb(255,"+a+",0)"},colMathFun:function(i){return Math.pow(C.bottomNum,i)-1},setMPIcon:function(l){var i=C.data.MP[l.imgDir][0],a=C.data.MP[l.imgDir][1],t=C.data.pts[l.imgDir],e=C.originalData.ptsTarget[l.imgDir],r=l.contPar.winScaling*l.zoomImg.imgScaling;l.APIPar.iconArray=new Array;for(var n=0;n<i.length;n++){var o=(t[s=i[n].index][0]*l.contPar.winScaling-l.imgPar.imgx)/r,g=(t[s][1]*l.contPar.winScaling-l.imgPar.imgy)/r;1-Math.sqrt(Math.pow(o-e[s][0],2)+Math.pow(g-e[s][1],2))/(l.contPar.height*C.mRatio)>C.closeRatio?l.APIPar.iconArray.push(C.MPIcon[1]):l.APIPar.iconArray.push(C.MPIcon[0])}for(n=0;n<a.length;n++){var s;o=(t[s=a[n].index][2]*l.contPar.winScaling-l.imgPar.imgx)/r,g=(t[s][3]*l.contPar.winScaling-l.imgPar.imgy)/r;1-Math.sqrt(Math.pow(o-e[s][2],2)+Math.pow(g-e[s][3],2))/(l.contPar.height*C.mRatio)>C.closeRatio?l.APIPar.iconArray.push(C.MPIcon[1]):l.APIPar.iconArray.push(C.MPIcon[0])}l.APIPar.PaintLines_iconArray=new Array,angular.forEach(l.outlinePar.PaintLines,function(e){if(e.LineType!=C.LineType[0])angular.forEach(l.APIPar.PaintLines_target,function(i){if(e.LineName===i.LineName){var a=l.contPar.winScaling*l.zoomImg.imgScaling,t=(e.EndPt.y-l.imgPar.imgy)/a;1-Math.abs(t-i.EndPt.y)/(l.contPar.height*C.mRatio)>C.closeRatio?l.APIPar.PaintLines_iconArray.push({LineName:e.LineName,icon:C.MPIcon[1]}):l.APIPar.PaintLines_iconArray.push({LineName:e.LineName,icon:C.MPIcon[0]})}});else{var r,n,o,g,s=l.contPar.winScaling*l.zoomImg.imgScaling;angular.forEach(l.APIPar.PaintLines_target,function(i){if(e.LineName===i.LineName){r=(e.StartPt.x-l.imgPar.imgx)/s,n=(e.StartPt.y-l.imgPar.imgy)/s,o=(e.EndPt.x-l.imgPar.imgx)/s,g=(e.EndPt.y-l.imgPar.imgy)/s;var a=Math.sqrt(Math.pow(i.StartPt.x-r,2)+Math.pow(i.StartPt.y-n,2)),t=Math.sqrt(Math.pow(i.EndPt.x-o,2)+Math.pow(i.EndPt.y-g,2));1-a/(l.contPar.height*C.mRatio)>C.closeRatio?l.APIPar.PaintLines_iconArray.push({LineName:e.LineName+"-S",icon:C.MPIcon[1]}):l.APIPar.PaintLines_iconArray.push({LineName:e.LineName+"-S",icon:C.MPIcon[0]}),1-t/(l.contPar.height*C.mRatio)>C.closeRatio?l.APIPar.PaintLines_iconArray.push({LineName:e.LineName+"-E",icon:C.MPIcon[1]}):l.APIPar.PaintLines_iconArray.push({LineName:e.LineName+"-E",icon:C.MPIcon[0]})}})}})},setGesture:function(e){C.mobileTouchRatio=2;var r,n=this,o=!1;e.drawCanvasJqueryId.unbind(),e.drawCanvasJqueryId.bind("touchstart",function(i){2<=i.touches.length?(o=!0,r=i.touches):1===i.touches.length&&n.canvasClick(i,e)}).bind("touchmove",function(i){if(2<=i.touches.length&&o){if(e.clickEvePar.isDraggingCir===C.isDraggingCir[0]){n.stopDragging(event,e),e.infPar.eventFlag=C.Flag[1];var a=i.touches,t=n.getDistance(a[0],a[1])/n.getDistance(r[0],r[1]);i.offsetX=(r[0].pageX+r[1].pageX)/2-e.drawCanvasJqueryId.offset().left,i.offsetY=(r[0].pageY+r[1].pageY)/2-e.drawCanvasJqueryId.offset().top,i.zoom=t/e.mobilePar.gestureScale,1<i.zoom?i.wheelDelta=120:i.zoom<1?i.wheelDelta=-120:i.wheelDelta=0,e.infPar.eventFlag=C.Flag[0],n.scaleImg(i,e),e.mobilePar.gestureScale=t}}else 1===i.touches.length&&n.mobileDragging(i,e)}).bind("touchend",function(i){o&&(o=!1),e.mobilePar.outsideCir=C.outsideCir[0],n.stopDragging(event,e)})},getDistance:function(i,a){var t=a.pageX-i.pageX,e=a.pageY-i.pageY;return Math.sqrt(t*t+e*e)},mobileDragging:function(i,a){if(a.clickEvePar.isDraggingCir===C.isDraggingCir[1]){if(null!=a.clickEvePar.previousSelectedCircle)if(C.testNum.test(a.mSelPointPar.mSelectedCircleIndex)){var t=i.offsetX?i.offsetX:i.touches[0].pageX-a.drawCanvasJqueryId.offset().left,e=i.offsetY?i.offsetY:i.touches[0].pageY-a.drawCanvasJqueryId.offset().top,r=a.contPar.height*C.mRatio*C.enLargeMRadius,n=t-a.outlinePar.originalCircles[a.mSelPointPar.mSelectedCircleIndex].x,o=e-a.outlinePar.originalCircles[a.mSelPointPar.mSelectedCircleIndex].y;r<Math.sqrt(Math.pow(n,2)+Math.pow(o,2))&&(a.mobilePar.outsideCir=C.outsideCir[1]),a.mobilePar.outsideCir===C.outsideCir[1]&&(i.offsetX=t-r,i.offsetY=e,this.dragging(i,a))}else this.dragging(i,a)}else this.dragging(i,a)},isPc:function(){var i={},a=navigator.platform;return i.win=0==a.indexOf("Win"),i.mac=0==a.indexOf("Mac"),i.x11="X11"==a||0==a.indexOf("Linux"),!!(i.win||i.mac||i.xll)}}}]),view.controller("SwitchViewCtrl",["$scope","dataSrv",function(t,g){function s(i,a,t){if(!i.pts[t]||""===i.pts[t])return"";for(var e=a.contPar.winScaling*a.zoomImg.imgScaling,r=new Array,n=i.pts[t],o=0;o<n.length;o++)r[o]=new Array(4),r[o][0]=(n[o][0]*a.contPar.winScaling-a.imgPar.imgx)/e,r[o][1]=(n[o][1]*a.contPar.winScaling-a.imgPar.imgy)/e,r[o][2]=(n[o][2]*a.contPar.winScaling-a.imgPar.imgx)/e,r[o][3]=(n[o][3]*a.contPar.winScaling-a.imgPar.imgy)/e;var g=[];for(o=0;o<n.length;o++)g.push(r[o][0]+":"+r[o][1]+":"+r[o][2]+":"+r[o][3]);return g.join(",")}function l(i,a){if(!a.outlinePar.PaintLines||""===a.outlinePar.PaintLines)return"";for(var t=a.contPar.winScaling*a.zoomImg.imgScaling,e=0;e<a.outlinePar.PaintLines.length;e++){var r=a.outlinePar.PaintLines[e],n=parseFloat((r.StartPt.x-a.imgPar.imgx)/t),o=parseFloat((r.StartPt.y-a.imgPar.imgy)/t),g=parseFloat((r.EndPt.x-a.imgPar.imgx)/t),s=parseFloat((r.EndPt.y-a.imgPar.imgy)/t);i.push({LineName:r.LineName,ImgDir:r.ImgDir,EndPt:{Y:s,X:g},LineType:r.LineType,StartPt:{Y:o,X:n}})}}t.getData=function(i){if(g.APIFlag=g.Flag[1],g.currentId=i.id,g.data=r(i),function(i){for(var a=0;a<i.dir.length;a++){for(var t=i.dir[a],e=0;e<i.MP[t][0].length;e++)i.MP[t][0][e]={index:i.MP[t][0][e],sign:g.sign[0]};for(var e=0;e<i.MP[t][1].length;e++)i.MP[t][1][e]={index:i.MP[t][1][e],sign:g.sign[0]}}}(g.data),g.originalData=r(g.data),i.isTutorial===g.isTutorial[1]&&(g.defImg=new Image,g.defImg.src=g.defImgSrc,g.targetImg=new Image,g.targetImg.src=g.targetImgSrc,g.promptButton=i.promptButton,$(g.promptButton).unbind()),g.retrButton&&""!=g.retrButton)for(var a in g.retrButton)$(g.retrButton[a]).unbind();$(window).unbind("resize"),setTimeout(function(){g.APIFlag=g.Flag[0],t.$broadcast("get_data","success")},g.setOutTime)},t.postAdjustRes=function(){g.APIFlag=g.Flag[1];var i=4;for(var a in g.adjustImgStatus)!0===g.adjustImgStatus[a]&&(i=3);var t=s(g.data,g.imgf_par,"f"),e=s(g.data,g.imgs_par,"s"),r=s(g.data,g.imgb_par,"b"),n=[];if(l(n,g.imgs_par),l(n,g.imgf_par),""!=r){l(n,g.imgb_par);var o={id:Number(g.currentId),pts_f:t,pts_s:e,pts_b:r,paintLines:JSON.stringify(n),ptsStatus:i}}else o={id:Number(g.currentId),pts_f:t,pts_s:e,paintLines:JSON.stringify(n),ptsStatus:i};return g.APIFlag=g.Flag[0],o},t.bindFun=function(i,a,t){if(""!==i&&null!=i){var e=i.split("_");"Hover2Suspension"===e[1]?($("body").bind(i+"_in",a),$("body").bind(i+"_out",t)):"Click2Suspension"===e[1]?($("body").bind(i+"_in",a),$("body").bind(i+"_out",t)):$("body").bind(i,a)}},t.unbindFun=function(i){if(""!==i&&null!=i){var a=i.split("_");"Hover2Suspension"===a[1]?($("body").unbind(i+"_in"),$("body").unbind(i+"_out")):"Click2Suspension"===a[1]?($("body").unbind(i+"_in"),$("body").unbind(i+"_out")):$("body").unbind(i)}};var r=function(i){var a,t=i.constructor===Array?[]:{};if("object"==typeof i){if(window.JSON)a=JSON.stringify(i),t=JSON.parse(a);else for(var e in i)t[e]="object"==typeof i[e]?r(i[e]):i[e];return t}}}]),view.directive("tozDrawImgf",["dataSrv","drawSrv",function(e,r){return{restrict:"A",replace:!0,scope:{},template:' <div><canvas id="imgfDrawCanvas" style="display:block; position:absolute; z-index: 1"></canvas> <canvas id="imgfImgCanvas" style="display:block; position: absolute;z-index: 0"></canvas></div>',controller:["$scope","$element","$attrs",function(i,a,t){i.imgf_par=r.newPar(e.imgDir[0],"imgfDrawCanvas","imgfImgCanvas"),e.imgCont[i.imgf_par.imgDir]="#"+a.attr("id"),e.retrButton[i.imgf_par.imgDir]=a.attr("retract"),e.imgf_par=i.imgf_par}],link:function(t){t.$on("get_data",function(i,a){r.pretreatment(t.imgf_par),r.init(t.imgf_par),r.draw(t.imgf_par)})}}}]),view.directive("tozDrawImgs",["dataSrv","drawSrv",function(e,r){return{restrict:"A",replace:!0,scope:{},template:' <div><canvas id="imgsDrawCanvas" style="display:block; position:absolute; z-index: 1"></canvas> <canvas id="imgsImgCanvas" style="display:block; position: absolute;z-index: 0"></canvas></div>',controller:["$scope","$element","$attrs",function(i,a,t){i.imgs_par=r.newPar(e.imgDir[1],"imgsDrawCanvas","imgsImgCanvas"),e.imgCont[i.imgs_par.imgDir]="#"+a.attr("id"),e.retrButton[i.imgs_par.imgDir]=a.attr("retract"),e.imgs_par=i.imgs_par}],link:function(t){t.$on("get_data",function(i,a){r.pretreatment(t.imgs_par),r.init(t.imgs_par),r.draw(t.imgs_par)})}}}]),view.directive("tozDrawImgb",["dataSrv","drawSrv",function(e,r){return{restrict:"A",replace:!0,scope:{},template:' <div><canvas id="imgbDrawCanvas" style="display:block; position:absolute; z-index: 1"></canvas> <canvas id="imgbImgCanvas" style="display:block; position: absolute;z-index: 0"></canvas></div>',controller:["$scope","$element","$attrs",function(i,a,t){i.imgb_par=r.newPar(e.imgDir[2],"imgbDrawCanvas","imgbImgCanvas"),e.imgCont[i.imgb_par.imgDir]="#"+a.attr("id"),e.retrButton[i.imgb_par.imgDir]=a.attr("retract"),e.imgb_par=i.imgb_par}],link:function(t){t.$on("get_data",function(i,a){""!=e.data.url[t.imgb_par.imgDir]&&(r.pretreatment(t.imgb_par),r.init(t.imgb_par),r.draw(t.imgb_par))})}}}]);var stressBoxId,theLanguage=$("html").attr("lang"),ctrl=document.querySelector("[ng-controller=SwitchViewCtrl]"),showTips=!1,imgCount=2,imgViewStatue=["f","s","b"],curImgViewStatue=imgViewStatue[0],fl_kpName_fir=["fl_toe","fl_knee","fl_crotch_cen","fl_crotch_out","fl_waist","fl_hip","fl_armsye","fl_biceps","fl_shoulder","fl_neck","fr_face","fl_headtop"],fl_kpName_sec=["fl_toe","fl_calf","fl_knee","fl_crotch_cen","fl_crotch_out","fl_waist","fl_hip","fl_armsye","fl_biceps","fl_shoulder","fl_neck","fr_face","fl_headtop"],fr_kpName=["fr_toe","fr_knee","fr_waist","fr_hip","fr_armsye","fr_biceps","fr_shoulder","fl_neck","fr_face","fr_headtop"],sf_kpName=["sf_knee","sf_knee","sf_knee","sf_knee","sf_belly","sf_belly","sf_belly","sf_bust","sf_jaw","sf_headtop"],sb_kpName=["sb_toe","sb_foot","sb_foot","sb_foot","sb_foot","sb_crotch","sb_hip","sb_bkwaist","sb_hump","sb_neck","sb_headtop"],exception_kpName={f:["fr_thigh"],s:["sf_jaw"]},showTips_BindName=["imgf_Hover2Suspension","imgs_Hover2Suspension"],hideGetMeasure=!1;function appendCorpName(){var i="<span>"+getCookie("tozSDK_corpName")+"</span>";$("#Account").append(i)}function showGuide(){var i=angular.element(ctrl).scope();i.unbindFun("imgf_Hover2Suspension"),i.unbindFun("imgs_Hover2Suspension"),showTips=!0,i.bindFun("imgf_Hover2Suspension",function(i,a){var t,e,r=$("#canvasContainer").offset(),n=$("#imgfContainer").offset(),o=a.x+n.left-r.left,g=.0556*$("#canvasContainer").height(),s=500+g,l=-s;0===a.dir?0<o+-300?(t=o+-300,0<a.y+l?e=a.y+l:a.y+s<=$("#canvasContainer").height()&&(e=a.y+g)):o+300<$("#canvasContainer").width()&&(t=o+50,0<a.y+l?e=a.y+l:a.y+s<=$("#canvasContainer").height()&&(e=a.y+g)):1===a.dir||2===a.dir?o+300<$("#canvasContainer").width()&&(t=o+50,0<a.y+l?e=a.y+l:a.y+s<=$("#canvasContainer").height()&&(e=a.y+g)):0<o+-300&&(t=o+-300,0<a.y+l?e=a.y+l:a.y+s<=$("#canvasContainer").height()&&(e=a.y+g));var c="";null===measureData.PaintKeyPts||""===measureData.PaintKeyPts?0===a.dir?c=13===measureData.FL_MP.length?fl_kpName_sec[a.index]:fl_kpName_fir[a.index]:1===a.dir?c=fr_kpName[a.index]:"FT_Waist_Line"===a.index&&(c+="f_side_waistline_point"):0===a.dir?c=measureData.PaintKeyPts[a.index].PtName:1===a.dir?c=measureData.PaintKeyPts[a.index+measureData.MP.f[0].length].PtName:"FT_Waist_Line"===a.index&&(c+="f_side_waistline_point");for(var m=0;m<exception_kpName.f.length;m++)if(c===exception_kpName.f[m])return;$("#canvasContainer").append("<div class='toz-poptip'><img class='tipimg' src='assets/imgs/Guide/"+c+".png'></div>"),$(".toz-poptip").css({top:e+"px",left:t+"px"}),$(".toz-poptip").show()},function(){$(".toz-poptip").remove()}),i.bindFun("imgs_Hover2Suspension",function(i,a){var t,e,r=$("#canvasContainer").offset(),n=$("#imgsContainer").offset(),o=a.x+n.left-r.left,g=.0556*$("#canvasContainer").height(),s=500+g,l=-s;1===a.dir?0<o+-300?(t=o+-300,0<a.y+l?e=a.y+l:a.y+s<=$("#canvasContainer").height()&&(e=a.y+g)):o+300<$("#canvasContainer").width()&&(t=o+50,0<a.y+l?e=a.y+l:a.y+s<=$("#canvasContainer").height()&&(e=a.y+g)):0!==a.dir&&2!==a.dir||(o+300<$("#canvasContainer").width()?(t=o+50,0<a.y+l?e=a.y+l:a.y+s<=$("#canvasContainer").height()&&(e=a.y+g)):0<o+-300&&(t=o+-300,0<a.y+l?e=a.y+l:a.y+s<=$("#canvasContainer").height()&&(e=a.y+g)));var c="";""===measureData.PaintKeyPts||null===measureData.PaintKeyPts?0===a.dir?c=sf_kpName[a.index]:1===a.dir?c=sb_kpName[a.index]:"Sd_FT_Waist_Line"===a.index?c+="s_front_waistline_point":"Sd_BK_Waist_Line"===a.index?c+="s_back_waistline_point":"Sd_Arm-S"===a.index?c+="s_arm_line_top_point":"Sd_Arm-E"===a.index&&(c+="s_sleeve_length_end_point"):0===a.dir?c=measureData.PaintKeyPts[a.index+measureData.MP.f[0].length+measureData.MP.f[1].length].PtName:1===a.dir?c=measureData.PaintKeyPts[a.index+measureData.MP.f[0].length+measureData.MP.f[1].length+measureData.MP.s[0].length].PtName:"Sd_FT_Waist_Line"===a.index?c+="s_front_waistline_point":"Sd_BK_Waist_Line"===a.index?c+="s_back_waistline_point":"Sd_Arm-S"===a.index?c+="s_arm_line_top_point":"Sd_Arm-E"===a.index&&(c+="s_sleeve_length_end_point");for(var m=0;m<exception_kpName.s.length;m++)if(c===exception_kpName.s[m])return;$("#canvasContainer").append("<div class='toz-poptip'><img class='tipimg' src='assets/imgs/Guide/"+c+".png'></div>"),$(".toz-poptip").css({top:e+"px",left:t+"px"}),$(".toz-poptip").show()},function(){$(".toz-poptip").remove()})}function select2highlightBox(i){var a=$(i).attr("id").split("_");$(".text-item").removeClass("select-box"),$("#"+a[0]+"_data").addClass("select-box"),stressBoxId="#"+a[0]+"_data"}function maintainHighlightedBox(){$(".text-item").removeClass("select-box"),$(stressBoxId).addClass("select-box")}function addScrollbar(i){-1<navigator.userAgent.indexOf("Firefox")&&($(".cover-layer").show(),$(i).css({"overflow-y":"hidden","-ms-overflow-y":"hidden"}),$(i).addClass("mCustomScrollbar"),$(i).addClass("fluid"),$(".cover-layer").hide())}function showOrHideButton(){$(window).width()<=768?($(".img-container").css("width","100%"),curImgViewStatue===imgViewStatue[0]?($(".adjust-button-group button").hide(),$(".front-img-button").show(),$("#imgfContainer").css("z-index",9),$("#imgsContainer").css("z-index",-9),$("#imgbContainer").css("z-index",-9)):curImgViewStatue===imgViewStatue[1]?($(".adjust-button-group button").hide(),$(".side-img-button").show(),$("#imgfContainer").css("z-index",-9),$("#imgbContainer").css("z-index",-9),$("#imgsContainer").css("z-index",9),2===imgCount?($("#showBackImg").hide(),$("#getMeasurements").show()):3===imgCount&&($("#showBackImg").show(),$("#getMeasurements").hide())):curImgViewStatue===imgViewStatue[2]&&($(".adjust-button-group button").hide(),$(".back-img-button").show(),$("#getMeasurements").show(),$("#imgfContainer").css("z-index",-9),$("#imgsContainer").css("z-index",-9),$("#imgbContainer").css("z-index",9))):($(".img-container").css("width",90/imgCount+"%"),$(".adjust-button-group button").hide(),$("#getMeasurements").show(),$("#retractFront").show(),$("#retractSide").show(),2===imgCount?$("#retractBack").hide():3===imgCount&&$("#retractBack").show(),$("#imgfContainer").css("z-index",9),$("#imgsContainer").css("z-index",9),$("#imgbContainer").css("z-index",9)),$("#showTarget").show(),$("#showTips").show()}appendCorpName(),addScrollbar(".cus-list"),showOrHideButton(),$(window).resize(function(){showOrHideButton()}),$(document).bind("click",function(i){for(var a=(i=i||window.event).target||i.srcElement;a;){if(a.id&&"accountContainer"==a.id)return;a=a.parentNode}$(".toz-header-drop-down-content").css("display","none")}),$("#Account").click(function(){window.location.href=accountURL[theLanguage]}),$("#Measure").click(function(){window.location.href=measureURL[theLanguage]}),$("#Tutorial").click(function(){window.location.href=tutorialURL[theLanguage]}),$("#Logout").click(function(){delCookie("tozSDK_corpName"),delCookie("tozSDK_token"),window.location.href=loginURL[theLanguage]}),$("#showTips").click(function(){var i=angular.element(ctrl).scope();!0===showTips?(showTips=!1,$(".toz-poptip").remove(),i.unbindFun(showTips_BindName[0]),i.unbindFun(showTips_BindName[1])):showGuide(i)}),$("#showSideImg").click(function(){curImgViewStatue=imgViewStatue[1],showOrHideButton()}),$("#showFrontImg").click(function(){curImgViewStatue=imgViewStatue[0],showOrHideButton()}),$("#showBackImg").click(function(){curImgViewStatue=imgViewStatue[2],showOrHideButton()}),$("#back2SideImg").click(function(){curImgViewStatue=imgViewStatue[1],showOrHideButton()}),$(".toz-header-drop-down").click(function(){"none"===$(this).find(".toz-header-drop-down-content").css("display")?$(this).find(".toz-header-drop-down-content").css({display:"block"}):$(this).find(".toz-header-drop-down-content").css({display:"none"})}),setTimeout(function(){$("#Logout").click()},36e5*Number(getCookie("tozSDK_keepTime")));var token=getCookie("token"),measureData=(theLanguage=$("html").attr("lang"),ctrl=document.querySelector("[ng-controller=SwitchViewCtrl]"),{}),pageLimit=5;function uploadList(i){var f=void 0===i?1:i,a={accessToken:token,userId:"",limit:pageLimit,offset:(f-1)*pageLimit};toz_ajax.post({url:SDKAPI.listTutorial,data:a,success:function(i){var a=(f-1)*pageLimit+1;if($(".cus-list").empty(),void 0!==i.data.data.data){for(var t=0;t<i.data.data.data.length;t++){var e=i.data.data.data[t],r=genderTable[theLanguage][Number(e.userGender)],n=new Date(e.createdTime),o=n.getFullYear()+"-";o+=(n.getMonth()+1<10?"0"+(n.getMonth()+1):n.getMonth()+1)+"-",o+=(n.getDate()<10?"0"+n.getDate():n.getDate())+" ",o+=(n.getHours()<10?"0"+n.getHours():n.getHours())+":",o+=(n.getMinutes()<10?"0"+n.getMinutes():n.getMinutes())+":",o+=n.getSeconds()<10?"0"+n.getSeconds():n.getSeconds();void 0!==e.measureInfo&&null!==e.measureInfo&&e.measureInfo!==[]&&0!==e.measureInfo.length&&null!=typeof e.measureInfo.measures&&null!=e.measureInfo.measures&&!0;var g=a,s=o,l=e.id,c=r,m=e.userHeight,P=e.userId,d=e.userWeight,u='<li class="cus-item" ><div class="cus-content"><div class="cus-data"><div id="'+l+'_data" class="text-item"><span id="listNum" title="listNum" >'+g+'</span></br><div class="cus-data-content"><span title="id" >'+userIdTable[theLanguage]+": "+P+'</span></br><span title="sex">'+c+'</span><span title="height">'+m+'CM</span><span title="weight">'+d+'KG</span> </br><span title="createdTime" >'+s+'</span></div></div><div class="list-button"><div class="button-item"><button id="'+l+'" onclick="getData(this);select2highlightBox(this)">'+adjustTable[theLanguage]+"</button></div></div></div></div></li>";$(".cus-list").append(u),a++}maintainHighlightedBox()}else toz_Toast.init({title:"Wrong",content:"The data is null!",duration:-1,mask:!1,icon:"failure"})}})}function getNewPts(i,a){if(void 0===i[a]||!i[a])return null;for(var t,e=i[a].split(","),r=[],n=0;n<e.length;n++){r[n]=new Array,t=e[n].split(":");for(var o=0;o<t.length;o++)r[n].push(Number(t[o]))}return r}function getNewColor(i,a){if(void 0===i[a]||!i[a])return[];for(var t=i[a].split(","),e=[],r=0;r<t.length-1;r++){var n=t[r].split(":");e[r]=new Array;for(var o=0;o<n.length;o++)e[r].push(Number(n[o]))}return e}function getImgSize(i,a){if(!i[a])return["",""];var t=i[a].split(":");return[Number(t[0]),Number(t[1])]}function getMPFromPK(i,a){for(var t=new Array,e=0;e<i.length;e++)i[e].PtDir===a&&t.push(Number(i[e].PtIndex));return t}function getMPFromStr(i,a){if(!i[a])return"";for(var t=new Array,e=i[a].split(";")[0].split(","),r=0;r<e.length;r++)t.push(Number(e[r]));return t}function getData(i){$(".show-view").hide(),$(".right-view").show();var a={accessToken:getCookie("token"),id:Number($(i).attr("id"))};toz_ajax.post({url:SDKAPI.imgsTutorial,data:a,success:function(i){if("200"==i.data.code&&0!=i.data.data.length){var a=JSON.parse(i.data.data.ptsInfo);a=a[a.length-1];var t=JSON.parse(i.data.data.basicInfo),e=JSON.parse(i.data.data.targetPtsInfo);e=e[e.length-1];var r=getNewPts(a,"pts_f"),n=getNewPts(a,"pts_s"),o=getNewPts(a,"pts_b"),g=getNewPts(a,"pts_f"),s=getNewPts(a,"pts_s"),l=getNewPts(a,"pts_b"),c=getNewColor(t,"FLCOLOR"),m=getNewColor(t,"FRCOLOR"),P=getNewColor(t,"SFCOLOR"),d=getNewColor(t,"SBCOLOR"),u=getNewColor(t,"BLCOLOR"),f=getNewColor(t,"BRCOLOR"),w=getImgSize(t,t.img_f_size?"img_f_size":"Img_f_size"),h=getImgSize(t,t.img_s_size?"img_s_size":"Img_s_size"),p=getImgSize(t,t.img_b_size?"img_b_size":"Img_b_size"),S="";if(void 0!==t.PaintKeyPts)var x=getMPFromPK(S=t.PaintKeyPts,"fl"),y=getMPFromPK(S,"fr"),v=getMPFromPK(S,"sf"),I=getMPFromPK(S,"sb"),b=getMPFromPK(S,"bl"),C=getMPFromPK(S,"br");else x=getMPFromStr(t,"FL_MP"),y=getMPFromStr(t,"FR_MP"),v=getMPFromStr(t,"SF_MP"),I=getMPFromStr(t,"SB_MP"),b=getMPFromStr(t,"BL_MP"),C=getMPFromStr(t,"BR_MP");var D=JSON.parse(a.paintLines);""!=(measureData={id:i.data.data.id,userId:i.data.data.userId,userGender:i.data.data.userGender,userHeight:i.data.data.userHeight,userWeight:i.data.data.userWeight,createdTime:i.data.data.createdTime,dir:["f","s","b"],pts:{f:r,s:n,b:o},url:{f:"data:image/png;base64,"+i.data.data.userImgBasedF,s:"data:image/png;base64,"+i.data.data.userImgBasedS,b:i.data.data.userImgBasedB?"data:image/png;base64,"+i.data.data.userImgBasedB:""},MP:{f:[x,y],s:[v,I],b:[b,C]},COLOR:{f:[c,m],s:[P,d],b:[u,f]},imgSize:{f:w,s:h,b:p},PaintLines:D,PaintKeyPts:S,isTutorial:!0,ptsTarget:{f:g,s:s,b:l},PaintLines_target:JSON.parse(e.paintLines),promptButton:"#showTarget"}).url.b?(imgCount=3,$("#imgbContainer").show(),$(".img-container").css("width","30%")):(imgCount=2,$("#imgbContainer").hide(),$(".img-container").css("width","45%")),$("#adjustShowView").show(),$("#adjustView").show(),$(".retract-button").attr("disabled","true"),curImgViewStatue=imgViewStatue[0],showOrHideButton();var L=angular.element(ctrl).scope();L.getData(measureData),!0===showTips&&showGuide(L)}else toz_Toast.init({title:"Wrong",content:"Sorry, network connection failed. Please try again.(Code:"+i.data.code+")",duration:-1,mask:!1,icon:"failure"})}})}uploadList(1),$("#cnTutorialUrl").click(function(){window.location.href=tutorialURL["zh-cmn-Hans"]}),$("#enTutorialUrl").click(function(){window.location.href=tutorialURL.en}),$("#jpTutorialUrl").click(function(){window.location.href=tutorialURL.ja}),$(".header-nav-bar-content li a").hover(function(){$("#headerTutorial").removeClass("nav-bar-select")},function(){$("#headerTutorial").addClass("nav-bar-select")});