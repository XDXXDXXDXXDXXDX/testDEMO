"use strict";var loginURL={"zh-cmn-Hans":"https://www.emtailor.com/b2bviews/backend-sdk/cn/login.html",en:"https://www.emtailor.com/b2bviews/backend-sdk/en/login.html",ja:"https://www.emtailor.com/b2bviews/backend-sdk/jp/login.html"},measureURL={"zh-cmn-Hans":"https://www.emtailor.com/b2bviews/backend-sdk/cn/measure.html",en:"https://www.emtailor.com/b2bviews/backend-sdk/en/measure.html",ja:"https://www.emtailor.com/b2bviews/backend-sdk/jp/measure.html"},tutorialURL={"zh-cmn-Hans":"https://www.emtailor.com/b2bviews/backend-sdk/cn/tutorial.html",en:"https://www.emtailor.com/b2bviews/backend-sdk/en/tutorial.html",ja:"https://www.emtailor.com/b2bviews/backend-sdk/jp/tutorial.html"},accountURL={"zh-cmn-Hans":"https://www.emtailor.com/b2bviews/backend-sdk/cn/account.html",en:"https://www.emtailor.com/b2bviews/backend-sdk/en/account.html",ja:"https://www.emtailor.com/b2bviews/backend-sdk/jp/account.html"},forgetPwURL={"zh-cmn-Hans":"https://www.emtailor.com/b2bviews/backend-sdk/cn/forget-password.html",en:"https://www.emtailor.com/b2bviews/backend-sdk/en/forget-password.html",ja:"https://www.emtailor.com/b2bviews/backend-sdk/jp/forget-password.html"},measureMobileURL={"zh-cmn-Hans":"https://www.emtailor.com/b2bviews/backend-sdk/cn/measure-mobile.html",en:"https://www.emtailor.com/b2bviews/backend-sdk/en/measure-mobile.html",ja:"https://www.emtailor.com/b2bviews/backend-sdk/jp/measure-mobile.html"},userIdTable={"zh-cmn-Hans":"用户 ID",en:"User ID",ja:"名前"},adjustTable={"zh-cmn-Hans":"调整",en:"Adjust",ja:"調整"},viewTable={"zh-cmn-Hans":"展示",en:"View",ja:"表示"},genderTable={"zh-cmn-Hans":["女","男"],en:["Female","Male"],ja:["女性","男性"]},accountFirPwWarning={"zh-cmn-Hans":"密码长度6-16位，至少分别有一个特殊符号、大写字母、小写字母和数字",en:"Password must be 6-16 characters, and including at least one special character, capital letter, lowercase letter, and digit.",ja:"パスワードは6-16文字で、記号、大文字、小文字、数字を含んでいる必要があります"},accountSecPwWarning={"zh-cmn-Hans":"两个密码不一致",en:"Password is different from the first one.",ja:"パスワードが一致しません"},sendText={"zh-cmn-Hans":"Send",en:"Send",ja:"送る"},cApiWarnText={"zh-cmn-Hans":"这不是一个合法的域名",en:"It isn't an authorized domain!",ja:"It isn't an authorized domain!"},SDKAPI={signin:"https://www.emtailor.com/b2b/api/corp/signin",imgsMeasure:"https://www.emtailor.com/b2b/api/measure/imgs",imgsTutorial:"https://www.emtailor.com/b2b/api/tutorial/imgs",getlimit:"https://www.emtailor.com/b2b/api/corp/acsetting/getlimit",add:"https://www.emtailor.com/b2b/api/measure/add",resetpsw:"https://www.emtailor.com/b2b/api/corp/acsetting/resetpsw",sendemail:"https://www.emtailor.com/b2b/api/corp/forgetpsw/sendemail",acSendEmail:"https://www.emtailor.com/b2b/api/corp/acsetting/sendemail",vericode:"https://www.emtailor.com/b2b/api/corp/forgetpsw/vericode",newemail:"https://www.emtailor.com/b2b/api/corp/acsetting/newemail",newpsw:"https://www.emtailor.com/b2b/api/corp/forgetpsw/newpsw",modelling:"https://www.emtailor.com/b2b/api/measure/modelling",listMeasure:"https://www.emtailor.com/b2b/api/measure/list",listTutorial:"https://www.emtailor.com/b2b/api/tutorial/list",updatecorpapi:"https://www.emtailor.com/b2b/api/corp/acsetting/updatecorpapi"};(toz_ajax=function(i){this.settings={}}).prototype={post:function(i){var a=this,e="tozA_"+this.genID(2);if(this.settings[e]=$.extend({url:"",data:"",timeout:12e4,dataType:"JSON",async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",headers:{Authorization:""},crossDomain:!1,beforeSend:new Function("return"),success:new Function("return"),fail:new Function("return"),complete:new Function("return"),closeLoading:!1},i),""===this.settings[e].url&&toz_Toast.init({title:"Wrong",content:"Url can't be empty.",duration:-1,mask:!1,icon:"failure"}),!this.settings[e].closeLoading)var n=toz_Toast.init({title:"Loading",content:"",duration:-1,mask:!0,icon:"loading"});var r=$.ajax({type:"post",url:a.settings[e].url,data:a.settings[e].data,timeout:a.settings[e].timeout,dataType:a.settings[e].dataType,async:a.settings[e].async,crossDomain:a.settings[e].crossDomain,headers:{Authorization:a.settings[e].headers.Authorization},success:function(i){a.settings[e].closeLoading||toz_Toast.hideToast(n),setTimeout(function(){a.settings[e].success(i),delete a.settings[e]},550)},fail:function(i){a.settings[e].closeLoading||toz_Toast.hideToast(n),toz_Toast.init({title:"Wrong",content:i,duration:-1,mask:!1,icon:"failure"}),a.settings[e].fail(i),delete a.settings[e]},complete:function(i,t){"timeout"==t?r.abort():200!=i.status&&(a.settings[e].closeLoading||toz_Toast.hideToast(n),toz_Toast.init({title:"Wrong",content:"Sorry, network connection failed. Please try again.(ErrorCode:"+i.status+")",duration:-1,mask:!1,icon:"failure"}),a.settings[e].complete({XMLHttpRequest:i,status:t}),delete a.settings[e])}})},get:function(){},genID:function(i){return Number(Math.random().toString().substr(3,i)+Date.now()).toString(36)}};var toz_ajax=new toz_ajax;function setCookie(i,t,a){var e=new Date;e.setDate(e.getDate()+a),document.cookie=i+"="+t+";expires="+e+";path=/"}function getCookie(i){var t=RegExp(i+"=([^;]+)"),a=document.cookie.match(t);return a?a[1]:""}function delCookie(i){setCookie(i,null,-1)}var cloneObj=function(i){var t,a=i.constructor===Array?[]:{};if("object"==typeof i){if(window.JSON)t=JSON.stringify(i),a=JSON.parse(t);else for(var e in i)a[e]="object"==typeof i[e]?cloneObj(i[e]):i[e];return a}};function isPc(){var i={},t=navigator.platform;return i.win=0==t.indexOf("Win"),i.mac=0==t.indexOf("Mac"),i.x11="X11"==t||0==t.indexOf("Linux"),!!(i.win||i.mac||i.xll)}var view=angular.module("adjustment",[]);view.factory("dataSrv",["$rootScope",function(){return{mRatio:.05,closeRatio:.95,radiusRatio:.015,lineWidth:2,enLargePLCirRadius:2,mobileTouchRatio:1,enLargeMRadius:2,minDownIndex:100,maxUpIndex:250,minMPDownIndex:50,maxMPUpIndex:250,bottomNum:1.5,staticCirCol:"#000FFF",moveCirCol:"rgb(255,0,0)",setOutTime:100,cusCirCol:"rgb(50,205,50)",MaxRetrNum:20,promptCol:"rgb(220,220,220)",lineCap:"round",globalAlpha:.4,pageLimit:20,defImgSrc:"../public/assets/imgs/def_icon.png",targetImgSrc:"../public/assets/imgs/target_icon.png",imgDir:["f","s"],LineType:["free","L","R"],sign:["sys","cus"],MPIcon:["deflection","target"],MIN_SCALE:1,MAX_SCALE:5,zoomIntensity:.2,drawDir:[0,1,2],isDraggingCir:[!1,!0],Flag:[!1,!0],APIFlag:!1,draggingCanvas:[!1,!0],isTutorial:[!1,!0],overMaxRetrNum:[!1,!0],adjustImgStatus:[!1,!0],zoomCauseDrag:[!1,!0],hoverOnPoint:[!1,!0],showPrompt:[!1,!0],outsideCir:[!1,!0],MAXNUM:99999,testNum:/^[0-9]*$/,warngCol:"rgb(255,0,0)",perfCol:"rgb(255,255,0)"}}]),view.factory("drawSrv",["dataSrv",function(L){return{pretreatment:function(i){i.imgDir===L.imgDir[0]?(L.adjustImgfStatus=!1,i.imgPar.img.src=L.data.url_f,i.retrPar.retrButton=L.retrButton[0]):(L.adjustImgsStatus=!1,i.imgPar.img.src=L.data.url_s,i.retrPar.retrButton=L.retrButton[1]),i.gestureScale=1,i.retrPar.retrArray=new Array,i.infPar.resizeTimer=null,L.data.isTutorial===L.isTutorial[1]&&this.tutorialMode(i),this.middleTier(i)},tutorialMode:function(i){var t,a,e,n=this;if(i.imgDir===L.imgDir[0]?(t=L.data.pts_f,a=L.originalData.pts_f_target):(t=L.data.pts_s,a=L.originalData.pts_s_target),i.imgDir===L.imgDir[0])var r=$(L.imgCont[0]).height();else r=$(L.imgCont[1]).height();for(var o=e=0;o<t.length-1;o++){var s=Math.sqrt(Math.pow(t[o][e]-a[o][e],2)+Math.pow(t[o][e+1]-a[o][e+1],2)),g=Math.sqrt(Math.pow(t[o+1][e]-a[o+1][e],2)+Math.pow(t[o+1][e+1]-a[o+1][e+1],2));i.APIPar.firstColorArray.push({index:o,rgb:this.dist2Rgb(1-(s+g)/(2*r*L.mRatio))})}e=2;for(o=0;o<t.length-1;o++){s=Math.sqrt(Math.pow(t[o][e]-a[o][e],2)+Math.pow(t[o][e+1]-a[o][e+1],2)),g=Math.sqrt(Math.pow(t[o+1][e]-a[o+1][e],2)+Math.pow(t[o+1][e+1]-a[o+1][e+1],2));i.APIPar.secondColorArray.push({index:o,rgb:this.dist2Rgb(1-(s+g)/(2*r*L.mRatio))})}$(L.promptButton).click(function(){i.infPar.showPrompt===L.showPrompt[0]?i.infPar.showPrompt=L.showPrompt[1]:i.infPar.showPrompt=L.showPrompt[0],n.drawCirLine(i)})},middleTier:function(t){var a=this;t.canvasDraw.onselectstart=function(){return!1},t.canvasDraw.ondblclick=function(i){a.addDelMP(i,t)},a.isPc()?(t.canvasDraw.onmousedown=function(i){a.canvasClick(i,t)},t.canvasDraw.onmouseup=function(i){a.stopDragging(i,t)},t.canvasDraw.onmouseout=function(i){a.stopDragging(i,t)},t.canvasDraw.onmousemove=function(i){a.dragging(i,t)},t.canvasDraw.onmousewheel=function(i){a.scaleImg(i,t)},document.addEventListener&&t.canvasDraw.addEventListener("DOMMouseScroll",function(i){a.scaleImg(i,t)},!1)):t.imgDir===L.imgDir[0]?a.setGesture("#imgfDrawCanvas",t):t.imgDir===L.imgDir[1]&&a.setGesture("#imgsDrawCanvas",t)},init:function(r){if(r.infPar.eventFlag===L.Flag[0]&&r.infPar.drawFlag===L.Flag[0]&&L.APIFlag==L.Flag[0]){r.infPar.eventFlag=L.Flag[1];var i,t,a,e,o,n,s,g=this;r.imgDir===L.imgDir[0]?(o=L.data.img_f_width,n=L.data.img_f_height,i=L.data.FL_MP,t=L.data.FR_MP,a=L.data.pts_f,e=L.data.isTutorial===L.isTutorial[1]?L.originalData.pts_f_target:L.originalData.pts_f):(o=L.data.img_s_width,n=L.data.img_s_height,i=L.data.SF_MP,t=L.data.SB_MP,a=L.data.pts_s,e=L.data.isTutorial===L.isTutorial[1]?L.originalData.pts_s_target:L.originalData.pts_s),r.ctxDraw.clearRect(0,0,r.canvasDraw.width,r.canvasDraw.height),r.ctxImg.clearRect(0,0,r.canvasImg.width,r.canvasImg.height),r.infPar={showPrompt:L.showPrompt[0],resizeTimer:null,eventFlag:L.Flag[0],drawFlag:!1},r.clickEvePar={previousSelectedCircle:[],isDraggingCir:L.isDraggingCir[0],clickX:0,clickY:0},r.mSelPointPar={mSelectedCircleIndex:"",mSelectedPointDownIndex:0,mSelectedPointUpIndex:0,mSelectedPointIndex:0},r.zoomImg={MIN_SCALE:L.MIN_SCALE,MAX_SCALE:L.MAX_SCALE,imgScaling:L.MIN_SCALE,zoom:1,bfScalingimgx:0,bfScalingimgy:0,zoomIntensity:L.zoomIntensity,offsetX:0,offsetY:0},r.imgDir===L.imgDir[0]?(r.contPar.width=$(L.imgCont[0]).width(),r.contPar.height=$(L.imgCont[0]).height()):(r.contPar.width=$(L.imgCont[1]).width(),r.contPar.height=$(L.imgCont[1]).height()),r.contPar.winScaling=r.contPar.height/n,L.imgf_winScaling=r.contPar.winScaling,r.canvasDraw.width=r.contPar.width,r.canvasDraw.height=r.contPar.height,r.canvasImg.width=r.contPar.width,r.canvasImg.height=r.contPar.height,r.imgPar.imgh=r.contPar.height,r.imgPar.imgw=o*r.contPar.height/n,r.imgPar.imgx=(r.contPar.width-r.imgPar.imgw)/2,r.imgPar.imgy=0,r.imgDir===L.imgDir[0]?(L.imgf_imgx=r.imgPar.imgx,L.imgf_imgy=r.imgPar.imgy):(L.imgs_imgx=r.imgPar.imgx,L.imgs_imgy=r.imgPar.imgy),r.dgImgPar={zoomCauseDrag:L.zoomCauseDrag[0],draggingCanvas:L.draggingCanvas[0],preimgx:r.imgPar.imgx,preimgy:r.imgPar.imgy,preOffsetx:0,preOffsety:0,draggingCanvasScale:L.MIN_SCALE},r.outlinePar={lineWidth:L.lineWidth,circles:[],radius:r.contPar.height*L.radiusRatio,originalCircles:[],distanceBound:r.contPar.height*L.mRatio,PaintLines:new Array,originalPaintLines:new Array},r.APIPar.hoverOnPoint=L.hoverOnPoint[0],r.addDelMPPar={hoverPointSign:"",delCirIndex:-1};for(var l=0;l<i.length;l++){var c=i[l].index;s=i[l].sign===L.sign[0]?L.sign[0]:L.sign[1];var m=new this.createcircle(a[c][0]*r.contPar.winScaling+r.imgPar.imgx,a[c][1]*r.contPar.winScaling,s),d=new this.createcircle(e[c][0]*r.contPar.winScaling+r.imgPar.imgx,e[c][1]*r.contPar.winScaling,s);r.outlinePar.circles.push(m),r.outlinePar.originalCircles.push(d)}for(l=0;l<t.length;l++){c=t[l].index;s=t[l].sign===L.sign[0]?L.sign[0]:L.sign[1];m=new this.createcircle(a[c][2]*r.contPar.winScaling+r.imgPar.imgx,a[c][3]*r.contPar.winScaling,s),d=new this.createcircle(e[c][2]*r.contPar.winScaling+r.imgPar.imgx,e[c][3]*r.contPar.winScaling,s);r.outlinePar.circles.push(m),r.outlinePar.originalCircles.push(d)}if(angular.forEach(L.data.PaintLines,function(i){if(i.ImgDir===r.imgDir)if(i.LineType!=L.LineType[0]){if(r.imgDir===L.imgDir[0])if(i.LineType===L.LineType[1])var t=0;else t=1;else if(i.LineType===L.LineType[1])t=1;else t=0;if(i.LineType===L.LineType[1])var a=g.findPointOnOutline(i.StartPt.Y*r.contPar.winScaling,t,r),e=new g.createcircle(a+r.imgPar.imgx,i.StartPt.Y*r.contPar.winScaling,L.sign[0]),n=new g.createcircle(r.imgPar.imgx,i.EndPt.Y*r.contPar.winScaling,L.sign[0]);else if(i.LineType===L.LineType[2])a=g.findPointOnOutline(i.StartPt.Y*r.contPar.winScaling,t,r),e=new g.createcircle(a+r.imgPar.imgx,i.StartPt.Y*r.contPar.winScaling,L.sign[0]),n=new g.createcircle(o*r.contPar.winScaling+r.imgPar.imgx,i.EndPt.Y*r.contPar.winScaling,L.sign[0]);r.outlinePar.PaintLines.push({StartPt:e,EndPt:n,ImgDir:i.ImgDir,LineName:i.LineName,LineType:i.LineType})}else if(i.LineType===L.LineType[0]){e=new g.createcircle(i.StartPt.X*r.contPar.winScaling+r.imgPar.imgx,i.StartPt.Y*r.contPar.winScaling,L.sign[0]),n=new g.createcircle(i.EndPt.X*r.contPar.winScaling+r.imgPar.imgx,i.EndPt.Y*r.contPar.winScaling,L.sign[0]);r.outlinePar.PaintLines.push({StartPt:e,EndPt:n,ImgDir:i.ImgDir,LineName:i.LineName,LineType:i.LineType})}}),r.outlinePar.originalPaintLines=this.cloneObj(r.outlinePar.PaintLines),r.imgDir===L.imgDir[0])for(l=0;l<L.data.pts_f.length;l++)L.data.pts_f[l][0]+=r.imgPar.imgx/r.contPar.winScaling,L.data.pts_f[l][2]+=r.imgPar.imgx/r.contPar.winScaling;else for(l=0;l<L.data.pts_s.length;l++)L.data.pts_s[l][0]+=r.imgPar.imgx/r.contPar.winScaling,L.data.pts_s[l][2]+=r.imgPar.imgx/r.contPar.winScaling;L.data.isTutorial===L.isTutorial[1]&&(angular.forEach(L.data.PaintLines_target,function(i){if(i.ImgDir===r.imgDir){if(i.LineType===L.LineType[0])var t=new g.createcircle(i.StartPt.X,i.StartPt.Y,L.sign[0]),a=new g.createcircle(i.EndPt.X,i.EndPt.Y,L.sign[0]);else t=new g.createcircle(o,i.EndPt.Y,L.sign[0]),a=new g.createcircle(o,i.EndPt.Y,L.sign[0]);r.APIPar.PaintLines_target.push({StartPt:t,EndPt:a,ImgDir:i.ImgDir,LineName:i.LineName,LineType:i.LineType,rgb:L.warngCol})}}),angular.forEach(r.outlinePar.PaintLines,function(e,i){angular.forEach(r.APIPar.PaintLines_target,function(i,t){if(e.LineName===i.LineName){var a={dir:L.drawDir[2],index:e.LineName,x:e.EndPt.x,y:e.EndPt.y};g.setRgb(a,r.APIPar.PaintLines_target[t],r)}})})),r.infPar.eventFlag=L.Flag[0]}},resizeInit:function(n){if(n.infPar.eventFlag===L.Flag[0]&&n.infPar.drawFlag===L.Flag[0]&&L.APIFlag==L.Flag[0]){n.infPar.eventFlag=L.Flag[1];for(var r=n.contPar.winScaling*n.zoomImg.imgScaling,i=n.imgDir===L.imgDir[0]?L.data.pts_f:L.data.pts_s,t=0;t<i.length;t++)i[t][0]=(i[t][0]*n.contPar.winScaling-n.imgPar.imgx)/r,i[t][1]=(i[t][1]*n.contPar.winScaling-n.imgPar.imgy)/r,i[t][2]=(i[t][2]*n.contPar.winScaling-n.imgPar.imgx)/r,i[t][3]=(i[t][3]*n.contPar.winScaling-n.imgPar.imgy)/r;angular.forEach(L.data.PaintLines,function(a,e){a.ImgDir===n.imgDir&&angular.forEach(n.outlinePar.PaintLines,function(i,t){a.LineName===i.LineName&&(L.data.PaintLines[e].StartPt.X=(i.StartPt.x-n.imgPar.imgx)/r,L.data.PaintLines[e].StartPt.Y=(i.StartPt.y-n.imgPar.imgy)/r,L.data.PaintLines[e].EndPt.X=(i.EndPt.x-n.imgPar.imgx)/r,L.data.PaintLines[e].EndPt.Y=(i.EndPt.y-n.imgPar.imgy)/r,L.data.originalPaintLines[e].StartPt.X=(n.outlinePar.originalPaintLines[t].StartPt.x-n.imgPar.imgx)/r,L.data.originalPaintLines[e].StartPt.Y=(n.outlinePar.originalPaintLines[t].StartPt.y-n.imgPar.imgy)/r,L.data.originalPaintLines[e].EndPt.X=(n.outlinePar.originalPaintLines[t].EndPt.x-n.imgPar.imgx)/r,L.data.originalPaintLines[e].EndPt.Y=(n.outlinePar.originalPaintLines[t].EndPt.y-n.imgPar.imgy)/r)})}),n.infPar.eventFlag=L.Flag[0],this.init(n)}},draw:function(i){this.drawImage(i),this.drawCirLine(i)},drawImage:function(i){var t=i.imgDir===L.imgDir[0]?L.data.img_f_width:L.data.img_s_width,a=i.imgDir===L.imgDir[0]?L.data.img_f_height:L.data.img_s_height;setTimeout(function(){i.ctxImg.drawImage(i.imgPar.img,0,0,t,a,i.imgPar.imgx,i.imgPar.imgy,i.imgPar.imgw,i.imgPar.imgh)},L.setOutTime)},drawCirLine:function(a,e){if(a.infPar.drawFlag!==L.Flag[1]){a.infPar.drawFlag=L.Flag[1];var n=this;if(a.ctxDraw.clearRect(0,0,a.canvasDraw.width,a.canvasDraw.height),a.ctxDraw.strokeStyle=L.perfCol,a.ctxDraw.lineWidth=a.outlinePar.lineWidth,a.ctxDraw.globalAlpha=1,L.data.isTutorial===L.isTutorial[0]||""==e||null==e||null==e)this.drawLine(L.drawDir[0],a),this.drawLine(L.drawDir[1],a);else if(0===e.dir)this.setRgb(e,a.APIPar.firstColorArray,a),this.drawLine(L.drawDir[0],a),this.drawLine(L.drawDir[1],a);else if(1===e.dir)this.setRgb(e,a.APIPar.secondColorArray,a),this.drawLine(L.drawDir[0],a),this.drawLine(L.drawDir[1],a);else{this.drawLine(L.drawDir[0],a),this.drawLine(L.drawDir[1],a);var r=e.index.split("-");angular.forEach(a.APIPar.PaintLines_target,function(i,t){i.LineName===r[0]&&n.setRgb(e,a.APIPar.PaintLines_target[t],a)})}a.ctxDraw.strokeStyle=L.perfCol,a.ctxDraw.lineCap=L.lineCap,angular.forEach(a.outlinePar.PaintLines,function(t){L.data.isTutorial===L.isTutorial[0]?(a.ctxDraw.beginPath(),a.ctxDraw.moveTo(t.StartPt.x,t.StartPt.y),a.ctxDraw.lineTo(t.EndPt.x,t.EndPt.y),a.ctxDraw.lineWidth=a.outlinePar.lineWidth,a.ctxDraw.stroke(),a.ctxDraw.closePath()):L.data.isTutorial===L.isTutorial[1]&&angular.forEach(a.APIPar.PaintLines_target,function(i){t.LineName===i.LineName&&""!=i.rgb&&(a.ctxDraw.strokeStyle=i.rgb,a.ctxDraw.beginPath(),a.ctxDraw.moveTo(t.StartPt.x,t.StartPt.y),a.ctxDraw.lineTo(t.EndPt.x,t.EndPt.y),a.ctxDraw.lineWidth=a.outlinePar.lineWidth,a.ctxDraw.stroke(),a.ctxDraw.closePath())})}),this.drawCircles(a),a.infPar.drawFlag=L.Flag[0]}},drawCircles:function(n){if(n.ctxDraw.strokeStyle=L.staticCirCol,n.ctxDraw.fillStyle=L.staticCirCol,n.ctxDraw.globalAlpha=L.globalAlpha,n.clickEvePar.isDraggingCir===L.isDraggingCir[1])n.ctxDraw.fillStyle=L.moveCirCol,L.testNum.test(n.mSelPointPar.mSelectedCircleIndex)?(n.ctxDraw.beginPath(),n.ctxDraw.arc(n.outlinePar.circles[n.mSelPointPar.mSelectedCircleIndex].x,n.outlinePar.circles[n.mSelPointPar.mSelectedCircleIndex].y,n.outlinePar.radius,0,2*Math.PI),n.ctxDraw.fill()):angular.forEach(n.outlinePar.PaintLines,function(i){var t=n.mSelPointPar.mSelectedCircleIndex.split("-");t[0]===i.LineName&&(i.LineType!=L.LineType[0]?(n.ctxDraw.beginPath(),n.ctxDraw.arc(i.EndPt.x,i.EndPt.y,n.outlinePar.radius*L.enLargePLCirRadius,0,2*Math.PI),n.ctxDraw.fill()):"S"===t[1]?(n.ctxDraw.beginPath(),n.ctxDraw.arc(i.StartPt.x,i.StartPt.y,n.outlinePar.radius,0,2*Math.PI),n.ctxDraw.fill()):"E"===t[1]&&(n.ctxDraw.beginPath(),n.ctxDraw.arc(i.EndPt.x,i.EndPt.y,n.outlinePar.radius,0,2*Math.PI),n.ctxDraw.fill()))}),n.ctxDraw.fillStyle=L.staticCirCol;else if(L.data.isTutorial===L.isTutorial[1]){this.setMPIcon(n),n.ctxDraw.globalAlpha=L.globalAlpha,angular.forEach(n.outlinePar.PaintLines,function(e){e.LineType!=L.LineType[0]?angular.forEach(n.APIPar.PaintLines_iconArray,function(i){if(i.LineName.split("-")[0]===e.LineName){var t=n.outlinePar.radius*L.enLargePLCirRadius;i.icon===L.MPIcon[0]?n.ctxDraw.drawImage(L.defImg,0,0,L.defImg.width,L.defImg.height,e.EndPt.x-t,e.EndPt.y-t,2*t,2*t):n.ctxDraw.drawImage(L.targetImg,0,0,L.targetImg.width,L.targetImg.height,e.EndPt.x-t,e.EndPt.y-t,2*t,2*t)}}):e.LineType===L.LineType[0]&&angular.forEach(n.APIPar.PaintLines_iconArray,function(i){var t=i.LineName.split("-");if(t[0]===e.LineName){var a=n.outlinePar.radius;"S"===t[1]?i.icon===L.MPIcon[0]?n.ctxDraw.drawImage(L.defImg,0,0,L.defImg.width,L.defImg.height,e.StartPt.x-a,e.StartPt.y-a,2*a,2*a):n.ctxDraw.drawImage(L.targetImg,0,0,L.targetImg.width,L.targetImg.height,e.StartPt.x-a,e.StartPt.y-a,2*a,2*a):"E"===t[1]&&(i.icon===L.MPIcon[0]?n.ctxDraw.drawImage(L.defImg,0,0,L.defImg.width,L.defImg.height,e.EndPt.x-a,e.EndPt.y-a,2*a,2*a):n.ctxDraw.drawImage(L.targetImg,0,0,L.targetImg.width,L.targetImg.height,e.EndPt.x-a,e.EndPt.y-a,2*a,2*a))}})});for(var i=0;i<n.outlinePar.circles.length;i++){var t=n.outlinePar.circles[i];n.APIPar.iconArray[i]===L.MPIcon[0]?n.ctxDraw.drawImage(L.defImg,0,0,L.defImg.width,L.defImg.height,t.x-n.outlinePar.radius,t.y-n.outlinePar.radius,2*n.outlinePar.radius,2*n.outlinePar.radius):n.ctxDraw.drawImage(L.targetImg,0,0,L.targetImg.width,L.targetImg.height,t.x-n.outlinePar.radius,t.y-n.outlinePar.radius,2*n.outlinePar.radius,2*n.outlinePar.radius)}}else{angular.forEach(n.outlinePar.PaintLines,function(i){i.LineType!=L.LineType[0]?(n.ctxDraw.beginPath(),n.ctxDraw.arc(i.EndPt.x,i.EndPt.y,n.outlinePar.radius*L.enLargePLCirRadius,0,2*Math.PI),n.ctxDraw.fill()):i.LineType===L.LineType[0]&&(n.ctxDraw.beginPath(),n.ctxDraw.arc(i.StartPt.x,i.StartPt.y,n.outlinePar.radius,0,2*Math.PI),n.ctxDraw.fill(),n.ctxDraw.beginPath(),n.ctxDraw.arc(i.EndPt.x,i.EndPt.y,n.outlinePar.radius,0,2*Math.PI),n.ctxDraw.fill())});for(i=0;i<n.outlinePar.circles.length;i++){(t=n.outlinePar.circles[i]).sign===L.sign[0]?n.ctxDraw.fillStyle=L.staticCirCol:n.ctxDraw.fillStyle=L.cusCirCol,n.ctxDraw.beginPath(),n.ctxDraw.arc(t.x,t.y,n.outlinePar.radius,0,2*Math.PI),n.ctxDraw.fill()}}if(L.data.isTutorial===L.isTutorial[1]&&n.infPar.showPrompt===L.showPrompt[1]){var a,e,r,o=n.contPar.winScaling*n.zoomImg.imgScaling;n.imgDir===L.imgDir[0]?(a=L.data.FL_MP,e=L.data.FR_MP,r=L.data.pts_f_target):(a=L.data.SF_MP,e=L.data.SB_MP,r=L.data.pts_s_target),n.ctxDraw.fillStyle=L.promptCol,angular.forEach(n.APIPar.PaintLines_target,function(i){i.LineType!=L.LineType[0]?(n.ctxDraw.beginPath(),i.LineType===L.LineType[1]?n.ctxDraw.arc(n.imgPar.imgx,i.EndPt.y*o+n.imgPar.imgy,n.outlinePar.radius*L.enLargePLCirRadius,0,2*Math.PI):i.LineType===L.LineType[2]&&n.ctxDraw.arc(n.imgPar.imgx+n.imgPar.imgw*n.zoomImg.imgScaling,i.EndPt.y*o+n.imgPar.imgy,n.outlinePar.radius*L.enLargePLCirRadius,0,2*Math.PI),n.ctxDraw.fill()):i.LineType===L.LineType[0]&&(n.ctxDraw.beginPath(),n.ctxDraw.arc(i.StartPt.x*o+n.imgPar.imgx,i.StartPt.y*o+n.imgPar.imgy,n.outlinePar.radius,0,2*Math.PI),n.ctxDraw.fill(),n.ctxDraw.beginPath(),n.ctxDraw.arc(i.EndPt.x*o+n.imgPar.imgx,i.EndPt.y*o+n.imgPar.imgy,n.outlinePar.radius,0,2*Math.PI),n.ctxDraw.fill())});for(i=0;i<a.length;i++){var s=a[i].index;n.ctxDraw.beginPath(),n.ctxDraw.arc(r[s][0]*o+n.imgPar.imgx,r[s][1]*o+n.imgPar.imgy,n.outlinePar.radius,0,2*Math.PI),n.ctxDraw.fill()}for(i=0;i<e.length;i++){s=e[i].index;n.ctxDraw.beginPath(),n.ctxDraw.arc(r[s][2]*o+n.imgPar.imgx,r[s][3]*o+n.imgPar.imgy,n.outlinePar.radius,0,2*Math.PI),n.ctxDraw.fill()}n.ctxDraw.fillStyle=L.staticCirCol}},drawLine:function(i,t,a){var e,n,r;if(t.imgDir===L.imgDir[0]?(i===L.drawDir[0]?(e=0,n=L.data.FLCOLOR):(e=2,n=L.data.FRCOLOR),r=L.data.pts_f):(i===L.drawDir[0]?(e=0,n=L.data.SFCOLOR):(e=2,n=L.data.SBCOLOR),r=L.data.pts_s),t.ctxDraw.beginPath(),t.ctxDraw.moveTo(r[0][e]*t.contPar.winScaling,r[0][e+1]*t.contPar.winScaling),L.data.isTutorial===L.isTutorial[1]){if(i===L.drawDir[0])var o=t.APIPar.firstColorArray;else o=t.APIPar.secondColorArray;for(var s=1;s<r.length;s++){for(var g=0;g<o.length;g++)(s===o[g].index||1===s&&o[g].index===s-1)&&(t.ctxDraw.stroke(),t.ctxDraw.strokeStyle=o[g].rgb,t.ctxDraw.beginPath(),t.ctxDraw.moveTo(r[s-1][e]*t.contPar.winScaling,r[s-1][e+1]*t.contPar.winScaling));t.ctxDraw.lineTo(r[s][e]*t.contPar.winScaling,r[s][e+1]*t.contPar.winScaling)}}else for(s=1;s<r.length;s++){for(g=0;g<n.length;g++)s===n[g][0]&&t.ctxDraw.strokeStyle!=L.warngCol||1===s&&n[g][0]===s-1?(t.ctxDraw.stroke(),t.ctxDraw.strokeStyle=L.warngCol,t.ctxDraw.beginPath(),t.ctxDraw.moveTo(r[s-1][e]*t.contPar.winScaling,r[s-1][e+1]*t.contPar.winScaling)):s===n[g][1]&&t.ctxDraw.strokeStyle!=L.perfCol&&(t.ctxDraw.stroke(),t.ctxDraw.strokeStyle=L.perfCol,t.ctxDraw.beginPath(),t.ctxDraw.moveTo(r[s-1][e]*t.contPar.winScaling,r[s-1][e+1]*t.contPar.winScaling));t.ctxDraw.lineTo(r[s][e]*t.contPar.winScaling,r[s][e+1]*t.contPar.winScaling)}t.ctxDraw.stroke()},canvasClick:function(i,a){var t,e,n=this;if(a.imgDir===L.imgDir[0]?(t=L.data.FL_MP.length,e="imgf"):(t=L.data.SF_MP.length,e="imgs"),$("body").trigger(e+"_Click2Suspension_out"),a.infPar.eventFlag===L.Flag[0]&&a.infPar.drawFlag===L.Flag[0]&&L.APIFlag==L.Flag[0]){a.infPar.eventFlag=L.Flag[1],a.clickEvePar.clickX=i.offsetX?i.offsetX:i.touches[0].pageX-a.jqueryId.offset().left,a.clickEvePar.clickY=i.offsetY?i.offsetY:i.touches[0].pageY-a.jqueryId.offset().top,a.dgImgPar.preOffsetx=a.clickEvePar.clickX,a.dgImgPar.preOffsety=a.clickEvePar.clickY,a.dgImgPar.preimgx=a.imgPar.imgx,a.dgImgPar.preimgy=a.imgPar.imgy,angular.forEach(a.outlinePar.PaintLines,function(i,t){if(i.LineType!=L.LineType[0]){if(Math.sqrt(Math.pow(i.EndPt.x-a.clickEvePar.clickX,2)+Math.pow(i.EndPt.y-a.clickEvePar.clickY,2))<a.outlinePar.radius*L.enLargePLCirRadius*L.mobileTouchRatio)return null!=a.clickEvePar.previousSelectedCircle&&(a.clickEvePar.previousSelectedCircle.isSelected=!1),a.clickEvePar.previousSelectedCircle=a.outlinePar.PaintLines[t].EndPt,a.outlinePar.PaintLines[t].isSelected=!0,a.mSelPointPar.mSelectedCircleIndex=a.outlinePar.PaintLines[t].LineName,$("body").trigger(e+"_Click2Suspension_in",[{dir:2,index:a.mSelPointPar.mSelectedCircleIndex,x:i.EndPt.x,y:i.EndPt.y}]),n.pushRetroversion(a),void(a.clickEvePar.isDraggingCir=L.isDraggingCir[1])}else{if(Math.sqrt(Math.pow(i.StartPt.x-a.clickEvePar.clickX,2)+Math.pow(i.StartPt.y-a.clickEvePar.clickY,2))<a.outlinePar.radius*L.mobileTouchRatio)return null!=a.clickEvePar.previousSelectedCircle&&(a.clickEvePar.previousSelectedCircle.isSelected=!1),a.clickEvePar.previousSelectedCircle=a.outlinePar.PaintLines[t].StartPt,a.outlinePar.PaintLines[t].isSelected=!0,a.mSelPointPar.mSelectedCircleIndex=a.outlinePar.PaintLines[t].LineName+"-S",$("body").trigger(e+"_Click2Suspension_in",[{dir:2,index:a.mSelPointPar.mSelectedCircleIndex,x:i.StartPt.x,y:i.StartPt.y}]),n.pushRetroversion(a),void(a.clickEvePar.isDraggingCir=L.isDraggingCir[1]);if(Math.sqrt(Math.pow(i.EndPt.x-a.clickEvePar.clickX,2)+Math.pow(i.EndPt.y-a.clickEvePar.clickY,2))<a.outlinePar.radius*L.mobileTouchRatio)return null!=a.clickEvePar.previousSelectedCircle&&(a.clickEvePar.previousSelectedCircle.isSelected=!1),a.clickEvePar.previousSelectedCircle=a.outlinePar.PaintLines[t].EndPt,a.outlinePar.PaintLines[t].isSelected=!0,a.mSelPointPar.mSelectedCircleIndex=a.outlinePar.PaintLines[t].LineName+"-E",$("body").trigger(e+"_Click2Suspension_in",[{dir:2,index:a.mSelPointPar.mSelectedCircleIndex,x:i.EndPt.x,y:i.EndPt.y}]),n.pushRetroversion(a),void(a.clickEvePar.isDraggingCir=L.isDraggingCir[1])}});for(var r=a.outlinePar.circles.length-1;0<=r;r--){var o=a.outlinePar.circles[r];if(Math.sqrt(Math.pow(o.x-a.clickEvePar.clickX,2)+Math.pow(o.y-a.clickEvePar.clickY,2))<=a.outlinePar.radius*L.mobileTouchRatio){null!=a.clickEvePar.previousSelectedCircle&&(a.clickEvePar.previousSelectedCircle.isSelected=!1),(a.clickEvePar.previousSelectedCircle=o).isSelected=!0;var s=0;if((a.mSelPointPar.mSelectedCircleIndex=r)<t){for(var g=0;g<r;g++)a.outlinePar.circles[g].sign===L.sign[1]&&s++;$("body").trigger(e+"_Click2Suspension_in",[{dir:0,index:a.mSelPointPar.mSelectedCircleIndex-s,x:o.x,y:o.y}])}else{for(g=t;g<r;g++)a.outlinePar.circles[g].sign===L.sign[1]&&s++;$("body").trigger(e+"_Click2Suspension_in",[{dir:1,index:a.mSelPointPar.mSelectedCircleIndex-t-s,x:o.x,y:o.y}])}return n.pushRetroversion(a),void(a.clickEvePar.isDraggingCir=L.isDraggingCir[1])}}a.dgImgPar.draggingCanvas=L.draggingCanvas[1]}},dragging:function(i,a){var t,e,n,r,o,s,g=this;if(a.imgDir===L.imgDir[0]?(t=L.data.pts_f,n=L.data.img_f_width,r=L.data.img_f_height,o=L.data.FL_MP,s=L.data.FR_MP):(t=L.data.pts_s,n=L.data.img_s_width,r=L.data.img_s_height,o=L.data.SF_MP,s=L.data.SB_MP),this.judgeOnPoint(i,a),a.clickEvePar.isDraggingCir===L.isDraggingCir[1]){if(null!=a.clickEvePar.previousSelectedCircle){var l=i.offsetX?i.offsetX:i.touches[0].pageX-a.jqueryId.offset().left,c=i.offsetY?i.offsetY:i.touches[0].pageY-a.jqueryId.offset().top;if(L.testNum.test(a.mSelPointPar.mSelectedCircleIndex)){var m,d=l-a.outlinePar.originalCircles[a.mSelPointPar.mSelectedCircleIndex].x,P=c-a.outlinePar.originalCircles[a.mSelPointPar.mSelectedCircleIndex].y;if(Math.pow(d,2)+Math.pow(P,2)<Math.pow(a.outlinePar.distanceBound,2)){var u=l-a.outlinePar.circles[a.mSelPointPar.mSelectedCircleIndex].x,h=c-a.outlinePar.circles[a.mSelPointPar.mSelectedCircleIndex].y;a.clickEvePar.previousSelectedCircle.x=l,a.clickEvePar.previousSelectedCircle.y=c,a.outlinePar.circles[a.mSelPointPar.mSelectedCircleIndex]=a.clickEvePar.previousSelectedCircle,this.mSelectedPoint(u,h,a.mSelPointPar.mSelectedCircleIndex,a)}else{var f=a.outlinePar.circles[a.mSelPointPar.mSelectedCircleIndex].x,p=a.outlinePar.circles[a.mSelPointPar.mSelectedCircleIndex].y,w=Math.sqrt(Math.pow(d,2)+Math.pow(P,2));a.clickEvePar.previousSelectedCircle.x=a.outlinePar.originalCircles[a.mSelPointPar.mSelectedCircleIndex].x+d/w*a.outlinePar.distanceBound,a.clickEvePar.previousSelectedCircle.y=a.outlinePar.originalCircles[a.mSelPointPar.mSelectedCircleIndex].y+P/w*a.outlinePar.distanceBound;u=a.clickEvePar.previousSelectedCircle.x-f,h=a.clickEvePar.previousSelectedCircle.y-p;a.outlinePar.circles[a.mSelPointPar.mSelectedCircleIndex]=a.clickEvePar.previousSelectedCircle,this.mSelectedPoint(u,h,a.mSelPointPar.mSelectedCircleIndex,a)}if(a.imgDir===L.imgDir[0])if(a.mSelPointPar.mSelectedCircleIndex<o.length)o[m=a.mSelPointPar.mSelectedCircleIndex].index>=L.minMPDownIndex&&o[m].index<=L.maxMPUpIndex&&angular.forEach(a.outlinePar.PaintLines,function(i,t){i.LineType===L.LineType[1]&&(a.outlinePar.PaintLines[t].StartPt.x=g.findPointOnOutline(a.outlinePar.PaintLines[t].StartPt.y,L.drawDir[0],a))});else s[m=a.mSelPointPar.mSelectedCircleIndex-o.length].index>=L.minMPDownIndex&&s[m].index<=L.maxMPUpIndex&&angular.forEach(a.outlinePar.PaintLines,function(i,t){i.LineType===L.LineType[2]&&(a.outlinePar.PaintLines[t].StartPt.x=g.findPointOnOutline(a.outlinePar.PaintLines[t].StartPt.y,L.drawDir[1],a))});else if(a.mSelPointPar.mSelectedCircleIndex<o.length)o[m=a.mSelPointPar.mSelectedCircleIndex].index>=L.minMPDownIndex&&o[m].index<=L.maxMPUpIndex&&angular.forEach(a.outlinePar.PaintLines,function(i,t){i.LineType===L.LineType[2]&&(a.outlinePar.PaintLines[t].StartPt.x=g.findPointOnOutline(a.outlinePar.PaintLines[t].StartPt.y,L.drawDir[0],a))});else s[m=a.mSelPointPar.mSelectedCircleIndex-o.length].index>=L.minMPDownIndex&&s[m].index<=L.maxMPUpIndex&&angular.forEach(a.outlinePar.PaintLines,function(i,t){i.LineType===L.LineType[1]&&(a.outlinePar.PaintLines[t].StartPt.x=g.findPointOnOutline(a.outlinePar.PaintLines[t].StartPt.y,L.drawDir[1],a))})}else for(var S=0;S<a.outlinePar.PaintLines.length;S++){var v=a.outlinePar.PaintLines[S],x=a.mSelPointPar.mSelectedCircleIndex.split("-");if(v.LineName===x[0])if(v.LineType!=L.LineType[0]){if(a.imgDir===L.imgDir[0]){if(v.LineType===L.LineType[1])var y=0;else if(v.LineType===L.LineType[2])y=2}else if(v.LineType===L.LineType[1])y=2;else if(v.LineType===L.LineType[2])y=0;c>=parseFloat(t[L.minDownIndex][y+1]*a.contPar.winScaling)?(v.EndPt.y=parseFloat(t[L.minDownIndex][y+1]*a.contPar.winScaling),v.StartPt.y=v.EndPt.y,v.StartPt.x=parseFloat(t[L.minDownIndex][y]*a.contPar.winScaling)):c<=parseFloat(t[L.maxUpIndex][y+1]*a.contPar.winScaling)?(v.EndPt.y=parseFloat(t[L.maxUpIndex][y+1]*a.contPar.winScaling),v.StartPt.y=v.EndPt.y,v.StartPt.x=parseFloat(t[L.maxUpIndex][y]*a.contPar.winScaling)):(v.EndPt.y=c,v.StartPt.y=c,e=a.imgDir===L.imgDir[0]?v.LineType===L.LineType[1]?0:1:v.LineType===L.LineType[1]?1:0,v.StartPt.x=this.findPointOnOutline(c,e,a))}else v.LineType===L.LineType[0]&&("S"===x[1]?(a.clickEvePar.previousSelectedCircle.x=l,a.clickEvePar.previousSelectedCircle.y=c,a.outlinePar.PaintLines[S].StartPt.x=l,a.outlinePar.PaintLines[S].StartPt.y=c):"E"===x[1]&&(a.clickEvePar.previousSelectedCircle.x=l,a.clickEvePar.previousSelectedCircle.y=c,a.outlinePar.PaintLines[S].EndPt.x=l,a.outlinePar.PaintLines[S].EndPt.y=c))}this.drawCirLine(a)}}else if(a.dgImgPar.draggingCanvas===L.draggingCanvas[1]&&a.zoomImg.imgScaling!=a.zoomImg.MIN_SCALE){a.ctxDraw.clearRect(0,0,a.canvasDraw.width,a.canvasDraw.height),a.ctxImg.clearRect(0,0,a.canvasImg.width,a.canvasImg.height);l=i.offsetX?i.offsetX:i.touches[0].pageX-a.jqueryId.offset().left,c=i.offsetY?i.offsetY:i.touches[0].pageY-a.jqueryId.offset().top;var I=l-a.dgImgPar.preOffsetx,_=c-a.dgImgPar.preOffsety;a.dgImgPar.draggingCanvasScale=a.zoomImg.imgScaling,a.imgPar.imgx+=I,a.imgPar.imgy+=_,a.imgPar.imgx>=.5*a.canvasImg.width-a.imgPar.imgw*a.zoomImg.imgScaling&&Math.abs(a.imgPar.imgy)<=a.canvasImg.height*(a.zoomImg.imgScaling-1)&&a.imgPar.imgx<=.5*a.canvasImg.width&&a.imgPar.imgy<=0?(a.ctxImg.drawImage(a.imgPar.img,0,0,n,r,a.imgPar.imgx,a.imgPar.imgy,a.imgPar.imgw*a.zoomImg.imgScaling,a.imgPar.imgh*a.zoomImg.imgScaling),a.dgImgPar.preOffsetx=l,a.dgImgPar.preOffsety=c,a.dgImgPar.zoomCauseDrag===L.zoomCauseDrag[1]&&(a.dgImgPar.zoomCauseDrag=L.zoomCauseDrag[0])):a.dgImgPar.zoomCauseDrag===L.zoomCauseDrag[1]&&Math.abs(a.imgPar.imgy)<=a.canvasImg.height*(a.zoomImg.imgScaling-1)&&a.imgPar.imgy<=0?(a.ctxImg.drawImage(a.imgPar.img,0,0,n,r,a.imgPar.imgx,a.imgPar.imgy,a.imgPar.imgw*a.zoomImg.imgScaling,a.imgPar.imgh*a.zoomImg.imgScaling),a.dgImgPar.preOffsetx=l,a.dgImgPar.preOffsety=c):(a.imgPar.imgx-=I,a.imgPar.imgy-=_,a.ctxImg.drawImage(a.imgPar.img,0,0,n,r,a.imgPar.imgx,a.imgPar.imgy,a.imgPar.imgw*a.zoomImg.imgScaling,a.imgPar.imgh*a.zoomImg.imgScaling))}},stopDragging:function(i,a){var t,e,n;if(a.imgDir===L.imgDir[0]?(t=L.data.pts_f,e="imgf",n=L.data.FL_MP.length):(t=L.data.pts_s,e="imgs",n=L.data.SF_MP.length),a.dgImgPar.draggingCanvas===L.draggingCanvas[1]){for(var r=a.imgPar.imgx-a.dgImgPar.preimgx,o=a.imgPar.imgy-a.dgImgPar.preimgy,s=0;s<a.outlinePar.circles.length;s++)a.outlinePar.circles[s].x+=r,a.outlinePar.circles[s].y+=o,a.outlinePar.originalCircles[s].x+=r,a.outlinePar.originalCircles[s].y+=o;for(s=0;s<t.length;s++)t[s][0]+=r/a.contPar.winScaling,t[s][1]+=o/a.contPar.winScaling,t[s][2]+=r/a.contPar.winScaling,t[s][3]+=o/a.contPar.winScaling;angular.forEach(a.outlinePar.PaintLines,function(i,t){a.outlinePar.PaintLines[t].StartPt.x+=r,a.outlinePar.PaintLines[t].StartPt.y+=o,a.outlinePar.PaintLines[t].EndPt.x+=r,a.outlinePar.PaintLines[t].EndPt.y+=o,a.outlinePar.originalPaintLines[t].StartPt.x+=r,a.outlinePar.originalPaintLines[t].StartPt.y+=o,a.outlinePar.originalPaintLines[t].EndPt.x+=r,a.outlinePar.originalPaintLines[t].EndPt.y+=o}),a.dgImgPar.draggingCanvas=L.draggingCanvas[0],this.drawCirLine(a),a.infPar.eventFlag=L.Flag[0]}if(a.clickEvePar.isDraggingCir===L.isDraggingCir[1]){var g;if(0!=a.retrPar.retrArray.length)if(i.offsetX===a.clickEvePar.clickX&&i.offsetY===a.clickEvePar.clickY)a.retrPar.retrArray.pop();else{var l=new this.uploadRetrPoint(a.retrPar.retrArray.pop(),a,this);if(a.retrPar.retrArray.push(l),L.testNum.test(a.mSelPointPar.mSelectedCircleIndex)){var c=a.contPar.winScaling*a.zoomImg.imgScaling,m=(a.outlinePar.circles[a.mSelPointPar.mSelectedCircleIndex].x-a.imgPar.imgx)/c,d=(a.outlinePar.circles[a.mSelPointPar.mSelectedCircleIndex].y-a.imgPar.imgy)/c;g=a.mSelPointPar.mSelectedCircleIndex<n?{dir:0,index:a.mSelPointPar.mSelectedCircleIndex,x:m,y:d}:{dir:1,index:a.mSelPointPar.mSelectedCircleIndex-n,x:m,y:d},$("body").trigger(e+"_Mouseup2ChgColor",[g])}else{var P=a.mSelPointPar.mSelectedCircleIndex.split("-");angular.forEach(a.outlinePar.PaintLines,function(i){P[0]===i.LineName&&(g={dir:2,index:a.mSelPointPar.mSelectedCircleIndex,x:(i.EndPt.x-a.imgPar.imgx)/(a.contPar.winScaling*a.zoomImg.imgScaling),y:(i.EndPt.y-a.imgPar.imgy)/(a.contPar.winScaling*a.zoomImg.imgScaling)},$("body").trigger(e+"_Mouseup2ChgColor",[g]))})}}a.clickEvePar.isDraggingCir=L.isDraggingCir[0],L.data.isTutorial===L.isTutorial[1]?this.drawCirLine(a,g):this.drawCirLine(a),a.infPar.eventFlag=L.Flag[0]}},scaleImg:function(i,a){if(a.infPar.eventFlag===L.Flag[0]&&a.infPar.drawFlag===L.Flag[0]&&L.APIFlag==L.Flag[0]){var t,e,n;a.imgDir===L.imgDir[0]?(t=L.data.pts_f,e=L.data.img_f_width,n=L.data.img_f_height):(t=L.data.pts_s,e=L.data.img_s_width,n=L.data.img_s_height),a.infPar.eventFlag=L.Flag[1],1===a.zoomImg.imgScaling&&(a.zoomImg.offsetX=i.offsetX,a.zoomImg.offsetY=i.offsetY,a.dgImgPar.draggingCanvasScale=1);var r=0;if(i||(i=window.event),i.wheelDelta?(r=i.wheelDelta/120,window.opera&&(r=-r)):i.detail&&(r=-i.detail/3),a.zoomImg.zoom=Math.exp(r*a.zoomImg.zoomIntensity),a.zoomImg.imgScaling*a.zoomImg.zoom<a.zoomImg.MIN_SCALE&&0!=a.imgPar.imgy){if(a.zoomImg.zoom=1/a.zoomImg.imgScaling,a.outlinePar.distanceBound*=a.zoomImg.zoom,a.ctxImg.clearRect(0,0,a.canvasDraw.width,a.canvasDraw.height),a.zoomImg.zoom<=1){a.zoomImg.bfScalingimgx=a.imgPar.imgx,a.zoomImg.bfScalingimgy=a.imgPar.imgy,a.imgPar.imgx=(a.contPar.width-a.imgPar.imgw)/2;for(var o=a.imgPar.imgy=0;o<a.outlinePar.circles.length;o++)a.outlinePar.circles[o].x=a.imgPar.imgx+(a.outlinePar.circles[o].x-a.zoomImg.bfScalingimgx)*a.zoomImg.zoom,a.outlinePar.circles[o].y=a.imgPar.imgy+(a.outlinePar.circles[o].y-a.zoomImg.bfScalingimgy)*a.zoomImg.zoom,a.outlinePar.originalCircles[o].x=a.imgPar.imgx+(a.outlinePar.originalCircles[o].x-a.zoomImg.bfScalingimgx)*a.zoomImg.zoom,a.outlinePar.originalCircles[o].y=a.imgPar.imgy+(a.outlinePar.originalCircles[o].y-a.zoomImg.bfScalingimgy)*a.zoomImg.zoom;for(o=0;o<t.length;o++)t[o][0]=(a.imgPar.imgx+(t[o][0]*a.contPar.winScaling-a.zoomImg.bfScalingimgx)*a.zoomImg.zoom)/a.contPar.winScaling,t[o][1]=(a.imgPar.imgy+(t[o][1]*a.contPar.winScaling-a.zoomImg.bfScalingimgy)*a.zoomImg.zoom)/a.contPar.winScaling,t[o][2]=(a.imgPar.imgx+(t[o][2]*a.contPar.winScaling-a.zoomImg.bfScalingimgx)*a.zoomImg.zoom)/a.contPar.winScaling,t[o][3]=(a.imgPar.imgy+(t[o][3]*a.contPar.winScaling-a.zoomImg.bfScalingimgy)*a.zoomImg.zoom)/a.contPar.winScaling;angular.forEach(a.outlinePar.PaintLines,function(i,t){a.outlinePar.PaintLines[t].StartPt.x=a.imgPar.imgx+(a.outlinePar.PaintLines[t].StartPt.x-a.zoomImg.bfScalingimgx)*a.zoomImg.zoom,a.outlinePar.PaintLines[t].StartPt.y=a.imgPar.imgy+(a.outlinePar.PaintLines[t].StartPt.y-a.zoomImg.bfScalingimgy)*a.zoomImg.zoom,a.outlinePar.PaintLines[t].EndPt.x=a.imgPar.imgx+(a.outlinePar.PaintLines[t].EndPt.x-a.zoomImg.bfScalingimgx)*a.zoomImg.zoom,a.outlinePar.PaintLines[t].EndPt.y=a.imgPar.imgy+(a.outlinePar.PaintLines[t].EndPt.y-a.zoomImg.bfScalingimgy)*a.zoomImg.zoom,a.outlinePar.originalPaintLines[t].StartPt.x=a.imgPar.imgx+(a.outlinePar.originalPaintLines[t].StartPt.x-a.zoomImg.bfScalingimgx)*a.zoomImg.zoom,a.outlinePar.originalPaintLines[t].StartPt.y=a.imgPar.imgy+(a.outlinePar.originalPaintLines[t].StartPt.y-a.zoomImg.bfScalingimgy)*a.zoomImg.zoom,a.outlinePar.originalPaintLines[t].EndPt.x=a.imgPar.imgx+(a.outlinePar.originalPaintLines[t].EndPt.x-a.zoomImg.bfScalingimgx)*a.zoomImg.zoom,a.outlinePar.originalPaintLines[t].EndPt.y=a.imgPar.imgy+(a.outlinePar.originalPaintLines[t].EndPt.y-a.zoomImg.bfScalingimgy)*a.zoomImg.zoom})}a.ctxImg.drawImage(a.imgPar.img,0,0,e,n,a.imgPar.imgx,a.imgPar.imgy,a.imgPar.imgw,a.imgPar.imgh),a.zoomImg.imgScaling=a.zoomImg.MIN_SCALE,this.drawCirLine(a)}else if(a.zoomImg.imgScaling*a.zoomImg.zoom>=a.zoomImg.MIN_SCALE&&a.zoomImg.imgScaling*a.zoomImg.zoom<=a.zoomImg.MAX_SCALE){if(a.outlinePar.distanceBound*=a.zoomImg.zoom,a.ctxImg.clearRect(0,0,a.canvasDraw.width,a.canvasDraw.height),a.zoomImg.zoom<1){var s=(a.zoomImg.imgScaling-a.zoomImg.imgScaling*a.zoomImg.zoom)/(a.zoomImg.imgScaling-1);a.zoomImg.bfScalingimgx=a.imgPar.imgx,a.zoomImg.bfScalingimgy=a.imgPar.imgy,a.imgPar.imgx+=((a.canvasDraw.width-a.imgPar.imgw)/2-a.imgPar.imgx)*s,a.imgPar.imgy+=-a.imgPar.imgy*s;for(o=0;o<a.outlinePar.circles.length;o++)a.outlinePar.circles[o].x=a.imgPar.imgx+(a.outlinePar.circles[o].x-a.zoomImg.bfScalingimgx)*a.zoomImg.zoom,a.outlinePar.circles[o].y=a.imgPar.imgy+(a.outlinePar.circles[o].y-a.zoomImg.bfScalingimgy)*a.zoomImg.zoom,a.outlinePar.originalCircles[o].x=a.imgPar.imgx+(a.outlinePar.originalCircles[o].x-a.zoomImg.bfScalingimgx)*a.zoomImg.zoom,a.outlinePar.originalCircles[o].y=a.imgPar.imgy+(a.outlinePar.originalCircles[o].y-a.zoomImg.bfScalingimgy)*a.zoomImg.zoom;for(o=0;o<t.length;o++)t[o][0]=(a.imgPar.imgx+(t[o][0]*a.contPar.winScaling-a.zoomImg.bfScalingimgx)*a.zoomImg.zoom)/a.contPar.winScaling,t[o][1]=(a.imgPar.imgy+(t[o][1]*a.contPar.winScaling-a.zoomImg.bfScalingimgy)*a.zoomImg.zoom)/a.contPar.winScaling,t[o][2]=(a.imgPar.imgx+(t[o][2]*a.contPar.winScaling-a.zoomImg.bfScalingimgx)*a.zoomImg.zoom)/a.contPar.winScaling,t[o][3]=(a.imgPar.imgy+(t[o][3]*a.contPar.winScaling-a.zoomImg.bfScalingimgy)*a.zoomImg.zoom)/a.contPar.winScaling;angular.forEach(a.outlinePar.PaintLines,function(i,t){a.outlinePar.PaintLines[t].StartPt.x=a.imgPar.imgx+(a.outlinePar.PaintLines[t].StartPt.x-a.zoomImg.bfScalingimgx)*a.zoomImg.zoom,a.outlinePar.PaintLines[t].StartPt.y=a.imgPar.imgy+(a.outlinePar.PaintLines[t].StartPt.y-a.zoomImg.bfScalingimgy)*a.zoomImg.zoom,a.outlinePar.PaintLines[t].EndPt.x=a.imgPar.imgx+(a.outlinePar.PaintLines[t].EndPt.x-a.zoomImg.bfScalingimgx)*a.zoomImg.zoom,a.outlinePar.PaintLines[t].EndPt.y=a.imgPar.imgy+(a.outlinePar.PaintLines[t].EndPt.y-a.zoomImg.bfScalingimgy)*a.zoomImg.zoom,a.outlinePar.originalPaintLines[t].StartPt.x=a.imgPar.imgx+(a.outlinePar.originalPaintLines[t].StartPt.x-a.zoomImg.bfScalingimgx)*a.zoomImg.zoom,a.outlinePar.originalPaintLines[t].StartPt.y=a.imgPar.imgy+(a.outlinePar.originalPaintLines[t].StartPt.y-a.zoomImg.bfScalingimgy)*a.zoomImg.zoom,a.outlinePar.originalPaintLines[t].EndPt.x=a.imgPar.imgx+(a.outlinePar.originalPaintLines[t].EndPt.x-a.zoomImg.bfScalingimgx)*a.zoomImg.zoom,a.outlinePar.originalPaintLines[t].EndPt.y=a.imgPar.imgy+(a.outlinePar.originalPaintLines[t].EndPt.y-a.zoomImg.bfScalingimgy)*a.zoomImg.zoom})}else{a.imgPar.imgx-=(a.zoomImg.offsetX-a.imgPar.imgx)*(a.zoomImg.zoom-1),a.imgPar.imgy-=(a.zoomImg.offsetY-a.imgPar.imgy)*(a.zoomImg.zoom-1);for(o=0;o<a.outlinePar.circles.length;o++)a.outlinePar.circles[o].x-=(a.zoomImg.offsetX-a.outlinePar.circles[o].x)*(a.zoomImg.zoom-1),a.outlinePar.circles[o].y-=(a.zoomImg.offsetY-a.outlinePar.circles[o].y)*(a.zoomImg.zoom-1),a.outlinePar.originalCircles[o].x-=(a.zoomImg.offsetX-a.outlinePar.originalCircles[o].x)*(a.zoomImg.zoom-1),a.outlinePar.originalCircles[o].y-=(a.zoomImg.offsetY-a.outlinePar.originalCircles[o].y)*(a.zoomImg.zoom-1);for(o=0;o<t.length;o++)t[o][0]-=(a.zoomImg.offsetX-t[o][0]*a.contPar.winScaling)*(a.zoomImg.zoom-1)/a.contPar.winScaling,t[o][1]-=(a.zoomImg.offsetY-t[o][1]*a.contPar.winScaling)*(a.zoomImg.zoom-1)/a.contPar.winScaling,t[o][2]-=(a.zoomImg.offsetX-t[o][2]*a.contPar.winScaling)*(a.zoomImg.zoom-1)/a.contPar.winScaling,t[o][3]-=(a.zoomImg.offsetY-t[o][3]*a.contPar.winScaling)*(a.zoomImg.zoom-1)/a.contPar.winScaling;angular.forEach(a.outlinePar.PaintLines,function(i,t){a.outlinePar.PaintLines[t].StartPt.x-=(a.zoomImg.offsetX-a.outlinePar.PaintLines[t].StartPt.x)*(a.zoomImg.zoom-1),a.outlinePar.PaintLines[t].StartPt.y-=(a.zoomImg.offsetY-a.outlinePar.PaintLines[t].StartPt.y)*(a.zoomImg.zoom-1),a.outlinePar.PaintLines[t].EndPt.x-=(a.zoomImg.offsetX-a.outlinePar.PaintLines[t].EndPt.x)*(a.zoomImg.zoom-1),a.outlinePar.PaintLines[t].EndPt.y-=(a.zoomImg.offsetY-a.outlinePar.PaintLines[t].EndPt.y)*(a.zoomImg.zoom-1),a.outlinePar.originalPaintLines[t].StartPt.x-=(a.zoomImg.offsetX-a.outlinePar.originalPaintLines[t].StartPt.x)*(a.zoomImg.zoom-1),a.outlinePar.originalPaintLines[t].StartPt.y-=(a.zoomImg.offsetY-a.outlinePar.originalPaintLines[t].StartPt.y)*(a.zoomImg.zoom-1),a.outlinePar.originalPaintLines[t].EndPt.x-=(a.zoomImg.offsetX-a.outlinePar.originalPaintLines[t].EndPt.x)*(a.zoomImg.zoom-1),a.outlinePar.originalPaintLines[t].EndPt.y-=(a.zoomImg.offsetY-a.outlinePar.originalPaintLines[t].EndPt.y)*(a.zoomImg.zoom-1)}),a.imgPar.imgx>=.5*a.canvasImg.width-a.imgPar.imgw*a.zoomImg.imgScaling&&a.imgPar.imgx<=.5*a.canvasImg.width||(a.dgImgPar.zoomCauseDrag=L.zoomCauseDrag[1])}a.ctxImg.drawImage(a.imgPar.img,0,0,e,n,a.imgPar.imgx,a.imgPar.imgy,a.imgPar.imgw*a.zoomImg.imgScaling*a.zoomImg.zoom,a.imgPar.imgh*a.zoomImg.imgScaling*a.zoomImg.zoom),a.zoomImg.imgScaling*=a.zoomImg.zoom,this.drawCirLine(a)}a.infPar.eventFlag=L.Flag[0]}},addDelMP:function(i,t){if(t.infPar.eventFlag===L.Flag[0]&&t.infPar.drawFlag===L.Flag[0]&&L.APIFlag==L.Flag[0]){t.infPar.eventFlag=L.Flag[1];var a,e,n,r,o=this;if(t.imgDir===L.imgDir[0]?(a=L.data.FL_MP,e=L.data.FR_MP,n=L.data.pts_f,r=L.originalData.pts_f):(a=L.data.SF_MP,e=L.data.SB_MP,n=L.data.pts_s,r=L.originalData.pts_s),this.judgeOnPoint(i,t),t.addDelMPPar.hoverPointSign===L.sign[1]){o.pushRetroversion(t);var s=new this.uploadRetrPoint(t.retrPar.retrArray.pop(),t,o);return t.retrPar.retrArray.push(s),t.outlinePar.circles.splice(t.addDelMPPar.delCirIndex,1),t.outlinePar.originalCircles.splice(t.addDelMPPar.delCirIndex,1),t.addDelMPPar.delCirIndex<a.length?a.splice(t.addDelMPPar.delCirIndex,1):e.splice(t.addDelMPPar.delCirIndex-a.length,1),this.drawCirLine(t),void(t.infPar.eventFlag=L.Flag[0])}if(t.APIPar.hoverOnPoint===L.hoverOnPoint[0]){var g=i.offsetX?i.offsetX:i.touches[0].pageX-t.jqueryId.offset().left,l=i.offsetY?i.offsetY:i.touches[0].pageY-t.jqueryId.offset().top,c=new this.findClosestPoint(t,g,l);if(Math.pow(c.dVx,2)+Math.pow(c.dVy,2)<=Math.pow(t.outlinePar.radius,2)){o.pushRetroversion(t);s=new this.uploadRetrPoint(t.retrPar.retrArray.pop(),t,o);t.retrPar.retrArray.push(s),c.drawDir===L.drawDir[0]?(a.push({index:c.index,sign:L.sign[1]}),a.sort(o.compare)):c.drawDir===L.drawDir[1]&&(e.push({index:c.index,sign:L.sign[1]}),e.sort(o.compare)),t.outlinePar.circles=new Array,t.outlinePar.originalCircles=new Array;for(var m=0;m<a.length;m++){var d=a[m].index,P=new this.createcircle(n[d][0]*t.contPar.winScaling,n[d][1]*t.contPar.winScaling,a[m].sign),u=new this.createcircle(r[d][0]*t.contPar.winScaling*t.zoomImg.imgScaling+t.imgPar.imgx,r[d][1]*t.contPar.winScaling*t.zoomImg.imgScaling+t.imgPar.imgy,a[m].sign);t.outlinePar.circles.push(P),t.outlinePar.originalCircles.push(u)}for(m=0;m<e.length;m++){d=e[m].index,P=new this.createcircle(n[d][2]*t.contPar.winScaling,n[d][3]*t.contPar.winScaling,e[m].sign),u=new this.createcircle(r[d][2]*t.contPar.winScaling*t.zoomImg.imgScaling+t.imgPar.imgx,r[d][3]*t.contPar.winScaling*t.zoomImg.imgScaling+t.imgPar.imgy,e[m].sign);t.outlinePar.circles.push(P),t.outlinePar.originalCircles.push(u)}this.drawCirLine(t)}}t.infPar.eventFlag=L.Flag[0]}},winResize:function(i){var t=this;$(window).bind("resize",function(){i.infPar.resizeTimer&&clearTimeout(i.infPar.resizeTimer),i.infPar.resizeTimer=setTimeout(function(){i.infPar.eventFlag===L.Flag[0]&&i.infPar.drawFlag===L.Flag[0]&&L.APIFlag==L.Flag[0]&&(t.resizeInit(i),t.draw(i))},150)})},bindRetrEve:function(i){var t=this;$(i.retrPar.retrButton).click(function(){t.doRetroversion(i,t)})},pushRetroversion:function(i){if(i.clickEvePar.isDraggingCir===L.isDraggingCir[0]){var t=new this.keepRetrPoint(i,this);i.retrPar.retrArray.length!=i.retrPar.MaxRetrNum?i.retrPar.retrArray.push(t):(i.retrPar.retrArray.shift(),i.retrPar.retrArray.push(t),i.retrPar.overMaxRetrNum=L.overMaxRetrNum[1])}},keepRetrPoint:function(i,t){var a;i.imgDir===L.imgDir[0]?(a=L.data.pts_f,this.firMP=t.cloneObj(L.data.FL_MP),this.secMP=t.cloneObj(L.data.FR_MP)):(a=L.data.pts_s,this.firMP=t.cloneObj(L.data.SF_MP),this.secMP=t.cloneObj(L.data.SB_MP)),this.pts=t.cloneObj(a),this.circles=t.cloneObj(i.outlinePar.circles),this.originalCircles=t.cloneObj(i.outlinePar.originalCircles),this.PaintLines=t.cloneObj(i.outlinePar.PaintLines),this.firstColorArray=t.cloneObj(i.APIPar.firstColorArray),this.secondColorArray=t.cloneObj(i.APIPar.secondColorArray),this.PaintLines_target=t.cloneObj(i.APIPar.PaintLines_target)},uploadRetrPoint:function(i,t,a){L.adjustImgfStatus=!0,$(t.retrPar.retrButton).removeAttr("disabled");var e=t.contPar.winScaling*t.zoomImg.imgScaling;this.firMP=a.cloneObj(i.firMP),this.secMP=a.cloneObj(i.secMP),this.circles=a.cloneObj(i.circles);for(var n=0;n<this.circles.length;n++)this.circles[n].x=(this.circles[n].x-t.imgPar.imgx)/e,this.circles[n].y=(this.circles[n].y-t.imgPar.imgy)/e;this.originalCircles=a.cloneObj(i.originalCircles);for(n=0;n<this.circles.length;n++)this.originalCircles[n].x=(this.originalCircles[n].x-t.imgPar.imgx)/e,this.originalCircles[n].y=(this.originalCircles[n].y-t.imgPar.imgy)/e;this.pts=new Array;for(n=0;n<i.pts.length;n++)this.pts[n]=new Array(4),this.pts[n][0]=(i.pts[n][0]*t.contPar.winScaling-t.imgPar.imgx)/e,this.pts[n][1]=(i.pts[n][1]*t.contPar.winScaling-t.imgPar.imgy)/e,this.pts[n][2]=(i.pts[n][2]*t.contPar.winScaling-t.imgPar.imgx)/e,this.pts[n][3]=(i.pts[n][3]*t.contPar.winScaling-t.imgPar.imgy)/e;this.PaintLines=a.cloneObj(i.PaintLines);for(n=0;n<this.PaintLines.length;n++)this.PaintLines[n].StartPt.x=(this.PaintLines[n].StartPt.x-t.imgPar.imgx)/e,this.PaintLines[n].StartPt.y=(this.PaintLines[n].StartPt.y-t.imgPar.imgy)/e,this.PaintLines[n].EndPt.x=(this.PaintLines[n].EndPt.x-t.imgPar.imgx)/e,this.PaintLines[n].EndPt.y=(this.PaintLines[n].EndPt.y-t.imgPar.imgy)/e;this.firstColorArray=a.cloneObj(i.firstColorArray),this.secondColorArray=a.cloneObj(i.secondColorArray),this.PaintLines_target=a.cloneObj(i.PaintLines_target)},doRetroversion:function(i,t){if(0!==i.retrPar.retrArray.length){var a;if(a=i.imgDir===L.imgDir[0]?L.data.pts_f:L.data.pts_s,i.infPar.eventFlag===L.Flag[0]&&i.infPar.drawFlag===L.Flag[0]&&L.APIFlag==L.Flag[0]){i.infPar.eventFlag=L.Flag[1];var e=i.retrPar.retrArray.pop(),n=i.contPar.winScaling*i.zoomImg.imgScaling;i.imgDir===L.imgDir[0]?(L.data.FL_MP=t.cloneObj(e.firMP),L.data.FR_MP=t.cloneObj(e.secMP)):(L.data.SF_MP=t.cloneObj(e.firMP),L.data.SB_MP=t.cloneObj(e.secMP)),i.outlinePar.circles=t.cloneObj(e.circles);for(var r=0;r<i.outlinePar.circles.length;r++)i.outlinePar.circles[r].x=i.outlinePar.circles[r].x*n+i.imgPar.imgx,i.outlinePar.circles[r].y=i.outlinePar.circles[r].y*n+i.imgPar.imgy;i.outlinePar.originalCircles=t.cloneObj(e.originalCircles);for(r=0;r<i.outlinePar.circles.length;r++)i.outlinePar.originalCircles[r].x=i.outlinePar.originalCircles[r].x*n+i.imgPar.imgx,i.outlinePar.originalCircles[r].y=i.outlinePar.originalCircles[r].y*n+i.imgPar.imgy;for(r=0;r<a.length;r++)a[r][0]=e.pts[r][0]*i.zoomImg.imgScaling+i.imgPar.imgx/i.contPar.winScaling,a[r][1]=e.pts[r][1]*i.zoomImg.imgScaling+i.imgPar.imgy/i.contPar.winScaling,a[r][2]=e.pts[r][2]*i.zoomImg.imgScaling+i.imgPar.imgx/i.contPar.winScaling,a[r][3]=e.pts[r][3]*i.zoomImg.imgScaling+i.imgPar.imgy/i.contPar.winScaling;i.outlinePar.PaintLines=t.cloneObj(e.PaintLines);for(r=0;r<i.outlinePar.PaintLines.length;r++)i.outlinePar.PaintLines[r].StartPt.x=i.outlinePar.PaintLines[r].StartPt.x*n+i.imgPar.imgx,i.outlinePar.PaintLines[r].StartPt.y=i.outlinePar.PaintLines[r].StartPt.y*n+i.imgPar.imgy,i.outlinePar.PaintLines[r].EndPt.x=i.outlinePar.PaintLines[r].EndPt.x*n+i.imgPar.imgx,i.outlinePar.PaintLines[r].EndPt.y=i.outlinePar.PaintLines[r].EndPt.y*n+i.imgPar.imgy;i.APIPar.firstColorArray=t.cloneObj(e.firstColorArray),i.APIPar.secondColorArray=t.cloneObj(e.secondColorArray),i.APIPar.PaintLines_target=t.cloneObj(e.PaintLines_target),0===i.retrPar.retrArray.length&&(i.retrPar.overMaxRetrNum===L.overMaxRetrNum[0]?i.imgDir===L.imgDir[0]?L.adjustImgfStatus=L.adjustImgStatus[0]:L.adjustImgsStatus=L.adjustImgStatus[0]:i.imgDir===L.imgDir[0]?L.adjustImgfStatus=L.adjustImgStatus[1]:L.adjustImgsStatus=L.adjustImgStatus[1],$(i.retrPar.retrButton).attr("disabled","true")),i.infPar.eventFlag=L.Flag[0]}this.drawCirLine(i)}},createcircle:function(i,t,a){this.x=i,this.y=t,this.isSelected=!1,this.sign=a},mSelectedPoint:function(i,t,a,e){var n,r,o,s,g,l,c;if(e.imgDir===L.imgDir[0]?(n=L.data.pts_f,r=L.data.FL_MP,o=L.data.FR_MP):(n=L.data.pts_s,r=L.data.SF_MP,o=L.data.SB_MP),a<r.length)g=(s=0)<a?r[a-1].index:0,l=a<r.length-1?r[a+1].index:n.length,c=r[a].index;else{s=2;var m=a-r.length;g=0<m?o[m-1].index:0,l=m<o.length-1?o[m+1].index:n.length,c=o[m].index}for(var d=parseInt(g);d<parseInt(l);d++)if(d<c){var P=i/((c-g)/2)*((c-g)/2-(c-d)/2)/e.contPar.winScaling,u=t/((c-g)/2)*((c-g)/2-(c-d)/2)/e.contPar.winScaling;n[d][s]=parseFloat(n[d][s])+parseFloat(P),n[d][s+1]=parseFloat(n[d][s+1])+parseFloat(u)}else if(d===c)n[d][s]=parseFloat(n[d][s])+parseFloat(i)/e.contPar.winScaling,n[d][s+1]=parseFloat(n[d][s+1])+parseFloat(t)/e.contPar.winScaling;else{P=i/((l-c)/2)*((l-c)/2-(d-c)/2)/e.contPar.winScaling,u=t/((l-c)/2)*((l-c)/2-(d-c)/2)/e.contPar.winScaling;n[d][s]=parseFloat(n[d][s])+parseFloat(P),n[d][s+1]=parseFloat(n[d][s+1])+parseFloat(u)}},judgeOnPoint:function(i,t){var a,e;t.imgDir===L.imgDir[0]?(a="imgf",e=L.data.FL_MP.length):(a="imgs",e=L.data.SF_MP.length);for(var n=!1,r=!1,o=i.offsetX?i.offsetX:i.touches[0].pageX-t.jqueryId.offset().left,s=i.offsetY?i.offsetY:i.touches[0].pageY-t.jqueryId.offset().top,g=0;g<t.outlinePar.PaintLines.length;g++){var l=t.outlinePar.PaintLines[g];if(l.LineType!=L.LineType[0]){if(Math.sqrt(Math.pow(l.EndPt.x-o,2)+Math.pow(l.EndPt.y-s,2))<t.outlinePar.radius*L.enLargePLCirRadius&&(n=!0,t.APIPar.hoverOnPoint===L.hoverOnPoint[0]))return t.APIPar.hoverOnPoint=L.hoverOnPoint[1],t.addDelMPPar.hoverPointSign=L.sign[0],void $("body").trigger(a+"_Hover2Suspension_in",[{dir:2,index:l.LineName,x:l.EndPt.x,y:l.EndPt.y}])}else if(l.LineType===L.LineType[0]){if(Math.sqrt(Math.pow(l.StartPt.x-o,2)+Math.pow(l.StartPt.y-s,2))<t.outlinePar.radius&&(n=!0,t.APIPar.hoverOnPoint===L.hoverOnPoint[0]))return t.APIPar.hoverOnPoint=L.hoverOnPoint[1],t.addDelMPPar.hoverPointSign=L.sign[0],void $("body").trigger(a+"_Hover2Suspension_in",[{dir:2,index:l.LineName+"-S",x:l.StartPt.x,y:l.StartPt.y}]);if(Math.sqrt(Math.pow(l.EndPt.x-o,2)+Math.pow(l.EndPt.y-s,2))<t.outlinePar.radius&&(n=!0,t.APIPar.hoverOnPoint===L.hoverOnPoint[0]))return t.APIPar.hoverOnPoint=L.hoverOnPoint[1],t.addDelMPPar.hoverPointSign=L.sign[0],void $("body").trigger(a+"_Hover2Suspension_in",[{dir:2,index:l.LineName+"-E",x:l.EndPt.x,y:l.EndPt.y}])}}for(g=0;g<t.outlinePar.circles.length;g++){var c=t.outlinePar.circles[g];if(Math.sqrt(Math.pow(c.x-o,2)+Math.pow(c.y-s,2))<=t.outlinePar.radius&&(r=!0,t.APIPar.hoverOnPoint===L.hoverOnPoint[0])){if(t.APIPar.hoverOnPoint=L.hoverOnPoint[1],c.sign===L.sign[0]?t.addDelMPPar.hoverPointSign=L.sign[0]:t.addDelMPPar={hoverPointSign:L.sign[1],delCirIndex:g},c.sign===L.sign[0]){var m=0;if(g<e){for(var d=0;d<g;d++)t.outlinePar.circles[d].sign===L.sign[1]&&m++;$("body").trigger(a+"_Hover2Suspension_in",[{dir:0,index:g-m,x:c.x,y:c.y}])}else{for(d=e;d<g;d++)t.outlinePar.circles[d].sign===L.sign[1]&&m++;$("body").trigger(a+"_Hover2Suspension_in",[{dir:1,index:g-e-m,x:c.x,y:c.y}])}}return}}!1===n&&!1===r&&t.APIPar.hoverOnPoint===L.hoverOnPoint[1]&&$("body").trigger(a+"_Hover2Suspension_out"),!1===n&&!1===r&&(t.APIPar.hoverOnPoint=L.hoverOnPoint[0],t.addDelMPPar.hoverPointSign=L.sign[0])},findPointOnOutline:function(i,t,a){var e,n,r=L.MAXNUM,o=-1,s=0;e=a.imgDir===L.imgDir[0]?L.data.pts_f:L.data.pts_s,t===L.drawDir[0]?n=0:t===L.drawDir[1]&&(n=2);for(var g=L.minDownIndex;g<L.maxUpIndex;g++)(s=Math.abs(i-parseFloat(e[g][n+1]*a.contPar.winScaling)))<10&&s<r&&(r=s,o=parseFloat(e[g][n]*a.contPar.winScaling));return o},findClosestPoint:function(i,t,a){var e;e=i.imgDir===L.imgDir[0]?L.data.pts_f:L.data.pts_s;for(var n=[],r=[],o=0;o<e.length;o++)n.push(Math.abs(e[o][1]*i.contPar.winScaling-a)),r.push(Math.abs(e[o][3]*i.contPar.winScaling-a));var s=n.indexOf(Math.min.apply(null,n)),g=r.indexOf(Math.min.apply(null,r)),l=Math.abs(e[s][0]*i.contPar.winScaling-t),c=Math.abs(e[g][2]*i.contPar.winScaling-t);return l<c?{drawDir:L.drawDir[0],index:s,dVx:l,dVy:n[s]}:{drawDir:L.drawDir[1],index:g,dVx:c,dVy:r[g]}},cloneObj:function(i){var t,a=i.constructor===Array?[]:{};if("object"==typeof i){if(window.JSON)t=JSON.stringify(i),a=JSON.parse(t);else for(var e in i)a[e]="object"==typeof i[e]?this.cloneObj(i[e]):i[e];return a}},compare:function(i,t){return i.index<t.index?-1:i.index>t.index?1:0},setRgb:function(i,t,a){var e,n,r=a.contPar.winScaling*a.zoomImg.imgScaling;a.imgDir===L.imgDir[0]?(e=this.cloneObj(L.data.pts_f),n=L.originalData.pts_f_target):(e=this.cloneObj(L.data.pts_s),n=L.originalData.pts_s_target);for(var o=0;o<e.length;o++)e[o][0]=(e[o][0]*a.contPar.winScaling-a.imgPar.imgx)/r,e[o][1]=(e[o][1]*a.contPar.winScaling-a.imgPar.imgy)/r,e[o][2]=(e[o][2]*a.contPar.winScaling-a.imgPar.imgx)/r,e[o][3]=(e[o][3]*a.contPar.winScaling-a.imgPar.imgy)/r;if(i.dir!=L.drawDir[2]){if(i.dir===L.drawDir[0]){a.APIPar.firstColorArray=new Array;for(o=0;o<e.length-1;o++){var s=Math.sqrt(Math.pow(e[o][0]-n[o][0],2)+Math.pow(e[o][1]-n[o][1],2)),g=Math.sqrt(Math.pow(e[o+1][0]-n[o+1][0],2)+Math.pow(e[o+1][1]-n[o+1][1],2));a.APIPar.firstColorArray.push({index:o,rgb:this.dist2Rgb(1-(s+g)/(2*a.outlinePar.distanceBound))})}}else if(i.dir===L.drawDir[1]){a.APIPar.secondColorArray=new Array;for(o=0;o<e.length-1;o++){s=Math.sqrt(Math.pow(e[o][2]-n[o][2],2)+Math.pow(e[o][3]-n[o][3],2)),g=Math.sqrt(Math.pow(e[o+1][2]-n[o+1][2],2)+Math.pow(e[o+1][3]-n[o+1][3],2));a.APIPar.secondColorArray.push({index:o,rgb:this.dist2Rgb(1-(s+g)/(2*a.outlinePar.distanceBound))})}}}else if(t.LineType!=L.LineType[0]){var l=Math.abs(t.EndPt.y-i.y);l=l*a.contPar.winScaling*a.zoomImg.imgScaling,t.rgb=this.dist2Rgb(1-l/a.outlinePar.distanceBound)}else{var c,m,d,P;for(r=a.contPar.winScaling*a.zoomImg.imgScaling,o=0;o<a.outlinePar.PaintLines.length;o++)a.outlinePar.PaintLines[o].LineName===t.LineName&&(c=(a.outlinePar.PaintLines[o].StartPt.x-a.imgPar.imgx)/r,m=(a.outlinePar.PaintLines[o].StartPt.y-a.imgPar.imgy)/r,d=(a.outlinePar.PaintLines[o].EndPt.x-a.imgPar.imgx)/r,P=(a.outlinePar.PaintLines[o].EndPt.y-a.imgPar.imgy)/r);var u=(Math.sqrt(Math.pow(t.StartPt.x-c,2)+Math.pow(t.StartPt.y-m,2))+Math.sqrt(Math.pow(t.EndPt.x-d,2)+Math.pow(t.EndPt.y-P,2)))*a.contPar.winScaling*a.zoomImg.imgScaling*.5;t.rgb=this.dist2Rgb(1-u/a.outlinePar.distanceBound)}},dist2Rgb:function(i){if(i<=0)var t=0;else if(i>L.closeRatio)t=255;else t=parseInt(255*this.colMathFun(i));return"rgb(255,"+t+",0)"},colMathFun:function(i){return Math.pow(L.bottomNum,i)-1},setMPIcon:function(l){var i,t,a,e,n=l.contPar.winScaling*l.zoomImg.imgScaling;l.imgDir===L.imgDir[0]?(a=L.data.pts_f,e=L.originalData.pts_f_target,i=L.data.FL_MP,t=L.data.FR_MP):(a=L.data.pts_s,e=L.originalData.pts_s_target,i=L.data.SF_MP,t=L.data.SB_MP),l.APIPar.iconArray=new Array;for(var r=0;r<i.length;r++){var o=(a[g=i[r].index][0]*l.contPar.winScaling-l.imgPar.imgx)/n,s=(a[g][1]*l.contPar.winScaling-l.imgPar.imgy)/n;1-Math.sqrt(Math.pow(o-e[g][0],2)+Math.pow(s-e[g][1],2))/(l.contPar.height*L.mRatio)>L.closeRatio?l.APIPar.iconArray.push(L.MPIcon[1]):l.APIPar.iconArray.push(L.MPIcon[0])}for(r=0;r<t.length;r++){var g;o=(a[g=t[r].index][2]*l.contPar.winScaling-l.imgPar.imgx)/n,s=(a[g][3]*l.contPar.winScaling-l.imgPar.imgy)/n;1-Math.sqrt(Math.pow(o-e[g][2],2)+Math.pow(s-e[g][3],2))/(l.contPar.height*L.mRatio)>L.closeRatio?l.APIPar.iconArray.push(L.MPIcon[1]):l.APIPar.iconArray.push(L.MPIcon[0])}l.APIPar.PaintLines_iconArray=new Array,angular.forEach(l.outlinePar.PaintLines,function(e){if(e.LineType!=L.LineType[0])angular.forEach(l.APIPar.PaintLines_target,function(i){if(e.LineName===i.LineName){var t=l.contPar.winScaling*l.zoomImg.imgScaling,a=(e.EndPt.y-l.imgPar.imgy)/t;1-Math.abs(a-i.EndPt.y)/(l.contPar.height*L.mRatio)>L.closeRatio?l.APIPar.PaintLines_iconArray.push({LineName:e.LineName,icon:L.MPIcon[1]}):l.APIPar.PaintLines_iconArray.push({LineName:e.LineName,icon:L.MPIcon[0]})}});else{var n,r,o,s,g=l.contPar.winScaling*l.zoomImg.imgScaling;angular.forEach(l.APIPar.PaintLines_target,function(i){if(e.LineName===i.LineName){n=(e.StartPt.x-l.imgPar.imgx)/g,r=(e.StartPt.y-l.imgPar.imgy)/g,o=(e.EndPt.x-l.imgPar.imgx)/g,s=(e.EndPt.y-l.imgPar.imgy)/g;var t=Math.sqrt(Math.pow(i.StartPt.x-n,2)+Math.pow(i.StartPt.y-r,2)),a=Math.sqrt(Math.pow(i.EndPt.x-o,2)+Math.pow(i.EndPt.y-s,2));1-t/(l.contPar.height*L.mRatio)>L.closeRatio?l.APIPar.PaintLines_iconArray.push({LineName:e.LineName+"-S",icon:L.MPIcon[1]}):l.APIPar.PaintLines_iconArray.push({LineName:e.LineName+"-S",icon:L.MPIcon[0]}),1-a/(l.contPar.height*L.mRatio)>L.closeRatio?l.APIPar.PaintLines_iconArray.push({LineName:e.LineName+"-E",icon:L.MPIcon[1]}):l.APIPar.PaintLines_iconArray.push({LineName:e.LineName+"-E",icon:L.MPIcon[0]})}})}})},setGesture:function(i,e){L.mobileTouchRatio=2;var n,r=this,o=!1;$(i).unbind(),$(i).bind("touchstart",function(i){2<=i.touches.length?(o=!0,n=i.touches):1===i.touches.length&&r.canvasClick(i,e)}).bind("touchmove",function(i){if(2<=i.touches.length&&o){if(e.clickEvePar.isDraggingCir===L.isDraggingCir[0]){r.stopDragging(event,e),e.infPar.eventFlag=L.Flag[1];var t=i.touches,a=r.getDistance(t[0],t[1])/r.getDistance(n[0],n[1]);i.offsetX=(n[0].pageX+n[1].pageX)/2-e.jqueryId.offset().left,i.offsetY=(n[0].pageY+n[1].pageY)/2-e.jqueryId.offset().top,i.zoom=a/e.gestureScale,1<i.zoom?i.wheelDelta=120:i.zoom<1?i.wheelDelta=-120:i.wheelDelta=0,e.infPar.eventFlag=L.Flag[0],r.scaleImg(i,e),e.gestureScale=a}}else 1===i.touches.length&&r.mobileDragging(i,e)}).bind("touchend",function(i){o&&(o=!1),e.mobilePar.outsideCir=L.outsideCir[0],r.stopDragging(event,e)})},getDistance:function(i,t){var a=t.pageX-i.pageX,e=t.pageY-i.pageY;return Math.sqrt(a*a+e*e)},mobileDragging:function(i,t){if(t.clickEvePar.isDraggingCir===L.isDraggingCir[1]){if(null!=t.clickEvePar.previousSelectedCircle)if(L.testNum.test(t.mSelPointPar.mSelectedCircleIndex)){var a=i.offsetX?i.offsetX:i.touches[0].pageX-t.jqueryId.offset().left,e=i.offsetY?i.offsetY:i.touches[0].pageY-t.jqueryId.offset().top,n=t.contPar.height*L.mRatio*L.enLargeMRadius,r=a-t.outlinePar.originalCircles[t.mSelPointPar.mSelectedCircleIndex].x,o=e-t.outlinePar.originalCircles[t.mSelPointPar.mSelectedCircleIndex].y;n<Math.sqrt(Math.pow(r,2)+Math.pow(o,2))&&(t.mobilePar.outsideCir=L.outsideCir[1]),t.mobilePar.outsideCir===L.outsideCir[1]&&(i.offsetX=a-n,i.offsetY=e,this.dragging(i,t))}else this.dragging(i,t)}else this.dragging(i,t)},mobileHandleImg:function(i,a){var t,e,n;a.imgDir===L.imgDir[0]?(t=L.data.pts_f,e=L.data.img_f_width,n=L.data.img_f_height):(t=L.data.pts_s,e=L.data.img_s_width,n=L.data.img_s_height),a.ctxDraw.clearRect(0,0,a.canvasDraw.width,a.canvasDraw.height),a.ctxImg.clearRect(0,0,a.canvasImg.width,a.canvasImg.height);var r=i.offsetX?i.offsetX:i.touches[0].pageX-a.jqueryId.offset().left,o=i.offsetY?i.offsetY:i.touches[0].pageY-a.jqueryId.offset().top;a.dgImgPar.preOffsetx=r+50,a.dgImgPar.preOffsety=o;var s=r-a.dgImgPar.preOffsetx,g=o-a.dgImgPar.preOffsety;a.dgImgPar.draggingCanvasScale=a.zoomImg.imgScaling,a.imgPar.imgx+=s,a.imgPar.imgy+=g,a.imgPar.imgx>=.5*a.canvasImg.width-a.imgPar.imgw*a.zoomImg.imgScaling&&Math.abs(a.imgPar.imgy)<=a.canvasImg.height*(a.zoomImg.imgScaling-1)&&a.imgPar.imgx<=.5*a.canvasImg.width&&a.imgPar.imgy<=0?(a.ctxImg.drawImage(a.imgPar.img,0,0,e,n,a.imgPar.imgx,a.imgPar.imgy,a.imgPar.imgw*a.zoomImg.imgScaling,a.imgPar.imgh*a.zoomImg.imgScaling),a.dgImgPar.preOffsetx=r,a.dgImgPar.preOffsety=o,a.dgImgPar.zoomCauseDrag===L.zoomCauseDrag[1]&&(a.dgImgPar.zoomCauseDrag=L.zoomCauseDrag[0])):a.dgImgPar.zoomCauseDrag===L.zoomCauseDrag[1]&&Math.abs(a.imgPar.imgy)<=a.canvasImg.height*(a.zoomImg.imgScaling-1)&&a.imgPar.imgy<=0?(a.ctxImg.drawImage(a.imgPar.img,0,0,e,n,a.imgPar.imgx,a.imgPar.imgy,a.imgPar.imgw*a.zoomImg.imgScaling,a.imgPar.imgh*a.zoomImg.imgScaling),a.dgImgPar.preOffsetx=r,a.dgImgPar.preOffsety=o):(a.imgPar.imgx-=s,a.imgPar.imgy-=g,a.ctxImg.drawImage(a.imgPar.img,0,0,e,n,a.imgPar.imgx,a.imgPar.imgy,a.imgPar.imgw*a.zoomImg.imgScaling,a.imgPar.imgh*a.zoomImg.imgScaling));for(var l=a.imgPar.imgx-a.dgImgPar.preimgx,c=a.imgPar.imgy-a.dgImgPar.preimgy,m=0;m<a.outlinePar.circles.length;m++)a.outlinePar.circles[m].x+=l,a.outlinePar.circles[m].y+=c,a.outlinePar.originalCircles[m].x+=l,a.outlinePar.originalCircles[m].y+=c;for(m=0;m<t.length;m++)t[m][0]+=l/a.contPar.winScaling,t[m][1]+=c/a.contPar.winScaling,t[m][2]+=l/a.contPar.winScaling,t[m][3]+=c/a.contPar.winScaling;angular.forEach(a.outlinePar.PaintLines,function(i,t){a.outlinePar.PaintLines[t].StartPt.x+=l,a.outlinePar.PaintLines[t].StartPt.y+=c,a.outlinePar.PaintLines[t].EndPt.x+=l,a.outlinePar.PaintLines[t].EndPt.y+=c,a.outlinePar.originalPaintLines[t].StartPt.x+=l,a.outlinePar.originalPaintLines[t].StartPt.y+=c,a.outlinePar.originalPaintLines[t].EndPt.x+=l,a.outlinePar.originalPaintLines[t].EndPt.y+=c})},isPc:function(){var i={},t=navigator.platform;return i.win=0==t.indexOf("Win"),i.mac=0==t.indexOf("Mac"),i.x11="X11"==t||0==t.indexOf("Linux"),!!(i.win||i.mac||i.xll)}}}]),view.controller("SwitchViewCtrl",["$scope","dataSrv",function(a,p){a.getData=function(i){p.APIFlag=p.Flag[1],p.defImg=new Image,p.defImg.src=p.defImgSrc,p.targetImg=new Image,p.targetImg.src=p.targetImgSrc,p.currentId=i.id,p.imgCont=n(i.imgCont),p.retrButton=n(i.retrButton),p.data=n(i),function(i){for(var t=0;t<i.FL_MP.length;t++)i.FL_MP[t]={index:i.FL_MP[t],sign:p.sign[0]};for(var t=0;t<i.FR_MP.length;t++)i.FR_MP[t]={index:i.FR_MP[t],sign:p.sign[0]};for(var t=0;t<i.SF_MP.length;t++)i.SF_MP[t]={index:i.SF_MP[t],sign:p.sign[0]};for(var t=0;t<i.SB_MP.length;t++)i.SB_MP[t]={index:i.SB_MP[t],sign:p.sign[0]}}(p.data),p.originalData=n(p.data),p.data.originalPaintLines=n(p.data.PaintLines),i.isTutorial===p.isTutorial[1]&&(p.promptButton=i.promptButton,$(p.promptButton).unbind());for(var t=0;t<p.retrButton.length;t++)$(p.retrButton[t]).unbind();setTimeout(function(){p.APIFlag=p.Flag[0],a.$broadcast("get_data","success")},p.setOutTime)},a.postAdjustRes=function(){p.APIFlag=p.Flag[1];for(var i=p.imgf_par.contPar.winScaling*p.imgf_par.zoomImg.imgScaling,t=new Array,a=0;a<p.data.pts_f.length;a++)t[a]=new Array(4),t[a][0]=(p.data.pts_f[a][0]*p.imgf_par.contPar.winScaling-p.imgf_par.imgPar.imgx)/i,t[a][1]=(p.data.pts_f[a][1]*p.imgf_par.contPar.winScaling-p.imgf_par.imgPar.imgy)/i,t[a][2]=(p.data.pts_f[a][2]*p.imgf_par.contPar.winScaling-p.imgf_par.imgPar.imgx)/i,t[a][3]=(p.data.pts_f[a][3]*p.imgf_par.contPar.winScaling-p.imgf_par.imgPar.imgy)/i;var e=p.imgs_par.contPar.winScaling*p.imgs_par.zoomImg.imgScaling,n=new Array;for(a=0;a<p.data.pts_s.length;a++)n[a]=new Array(4),n[a][0]=(p.data.pts_s[a][0]*p.imgs_par.contPar.winScaling-p.imgs_par.imgPar.imgx)/e,n[a][1]=(p.data.pts_s[a][1]*p.imgs_par.contPar.winScaling-p.imgs_par.imgPar.imgy)/e,n[a][2]=(p.data.pts_s[a][2]*p.imgs_par.contPar.winScaling-p.imgs_par.imgPar.imgx)/e,n[a][3]=(p.data.pts_s[a][3]*p.imgs_par.contPar.winScaling-p.imgs_par.imgPar.imgy)/e;var r=[];for(a=0;a<p.imgf_par.outlinePar.PaintLines.length;a++){var o=p.imgf_par.outlinePar.PaintLines[a],s=parseFloat((o.StartPt.x-p.imgf_par.imgPar.imgx)/i),g=parseFloat((o.StartPt.y-p.imgf_par.imgPar.imgy)/i),l=parseFloat((o.EndPt.x-p.imgf_par.imgPar.imgx)/i),c=parseFloat((o.EndPt.y-p.imgf_par.imgPar.imgy)/i);r.push({LineName:o.LineName,ImgDir:o.ImgDir,EndPt:{Y:c,X:l},LineType:o.LineType,StartPt:{Y:g,X:s}})}for(a=0;a<p.imgs_par.outlinePar.PaintLines.length;a++){o=p.imgs_par.outlinePar.PaintLines[a],s=parseFloat((o.StartPt.x-p.imgs_par.imgPar.imgx)/e),g=parseFloat((o.StartPt.y-p.imgs_par.imgPar.imgy)/e),l=parseFloat((o.EndPt.x-p.imgs_par.imgPar.imgx)/e),c=parseFloat((o.EndPt.y-p.imgs_par.imgPar.imgy)/e);r.push({LineName:o.LineName,ImgDir:o.ImgDir,EndPt:{Y:c,X:l},LineType:o.LineType,StartPt:{Y:g,X:s}})}var m=[],d=[];for(a=0;a<p.data.pts_f.length;a++)m.push(t[a][0]+":"+t[a][1]+":"+t[a][2]+":"+t[a][3]);for(a=0;a<p.data.pts_s.length;a++)d.push(n[a][0]+":"+n[a][1]+":"+n[a][2]+":"+n[a][3]);var P=m.join(","),u=d.join(","),h=4;(p.adjustImgsStatus||p.adjustImgfStatus)&&(h=3);var f={id:Number(p.currentId),pts_f:P,pts_s:u,paintLines:JSON.stringify(r),ptsStatus:h};return p.APIFlag=p.Flag[0],f},a.bindFun=function(i,t,a){if(""!==i&&null!=i){var e=i.split("_");"Hover2Suspension"===e[1]?($("body").bind(i+"_in",t),$("body").bind(i+"_out",a)):"Click2Suspension"===e[1]?($("body").bind(i+"_in",t),$("body").bind(i+"_out",a)):$("body").bind(i,t)}},a.unbindFun=function(i){if(""!==i&&null!=i){var t=i.split("_");"Hover2Suspension"===t[1]?($("body").unbind(i+"_in"),$("body").unbind(i+"_out")):"Click2Suspension"===t[1]?($("body").unbind(i+"_in"),$("body").unbind(i+"_out")):$("body").unbind(i)}};var n=function(i){var t,a=i.constructor===Array?[]:{};if("object"==typeof i){if(window.JSON)t=JSON.stringify(i),a=JSON.parse(t);else for(var e in i)a[e]="object"==typeof i[e]?n(i[e]):i[e];return a}}}]),view.directive("tozDrawImgf",["dataSrv","drawSrv",function(t,e){return{restrict:"A",replace:!0,scope:{},template:' <div><canvas id="imgfDrawCanvas" style="display:block; position:absolute; z-index: 1"></canvas> <canvas id="imgfImgCanvas" style="display:block; position: absolute;z-index: 0"></canvas></div>',controller:["$scope",function(i){i.imgf_par={imgDir:t.imgDir[0],gestureScale:1,jqueryId:$("#imgfDrawCanvas"),canvasDraw:document.getElementById("imgfDrawCanvas"),ctxDraw:document.getElementById("imgfDrawCanvas").getContext("2d"),canvasImg:document.getElementById("imgfImgCanvas"),ctxImg:document.getElementById("imgfImgCanvas").getContext("2d"),infPar:{showPrompt:t.showPrompt[0],resizeTimer:null,eventFlag:!1,drawFlag:!1},contPar:{width:0,height:0,winScaling:1},imgPar:{img:new Image,imgx:0,imgy:0,imgh:0,imgw:0},retrPar:{retrButton:"",MaxRetrNum:t.MaxRetrNum,retrArray:new Array,overMaxRetrNum:!1},outlinePar:{lineWidth:3,circles:[],radius:10,originalCircles:[],distanceBound:100,PaintLines:new Array,originalPaintLines:new Array},clickEvePar:{previousSelectedCircle:[],isDraggingCir:t.isDraggingCir[0],clickX:0,clickY:0},mSelPointPar:{mSelectedCircleIndex:"",mSelectedPointDownIndex:0,mSelectedPointUpIndex:0,mSelectedPointIndex:0},zoomImg:{MIN_SCALE:t.MIN_SCALE,MAX_SCALE:t.MAX_SCALE,imgScaling:t.MIN_SCALE,zoom:1,bfScalingimgx:0,bfScalingimgy:0,zoomIntensity:t.zoomIntensity,offsetX:0,offsetY:0},dgImgPar:{zoomCauseDrag:t.zoomCauseDrag[0],draggingCanvas:t.draggingCanvas[0],preimgx:0,preimgy:0,preOffsetx:0,preOffsety:0,draggingCanvasScale:1},addDelMPPar:{hoverPointSign:"",delCirIndex:-1},APIPar:{hoverOnPoint:t.hoverOnPoint[0],firstColorArray:new Array,secondColorArray:new Array,PaintLines_target:new Array,iconArray:new Array,PaintLines_iconArray:new Array},mobilePar:{outsideCir:t.outsideCir[0]}},t.imgf_par=i.imgf_par}],link:function(a){a.$on("get_data",function(i,t){e.pretreatment(a.imgf_par),e.init(a.imgf_par),e.draw(a.imgf_par),e.winResize(a.imgf_par),e.bindRetrEve(a.imgf_par)})}}}]),view.directive("tozDrawImgs",["dataSrv","drawSrv",function(t,e){return{restrict:"A",replace:!0,scope:{},template:' <div><canvas id="imgsDrawCanvas" style="display:block; position:absolute; z-index: 1"></canvas> <canvas id="imgsImgCanvas" style="display:block; position: absolute;z-index: 0"></canvas></div>',controller:["$scope",function(i){i.imgs_par={imgDir:t.imgDir[1],gestureScale:1,jqueryId:$("#imgsDrawCanvas"),canvasDraw:document.getElementById("imgsDrawCanvas"),ctxDraw:document.getElementById("imgsDrawCanvas").getContext("2d"),canvasImg:document.getElementById("imgsImgCanvas"),ctxImg:document.getElementById("imgsImgCanvas").getContext("2d"),infPar:{showPrompt:t.showPrompt[0],resizeTimer:null,eventFlag:!1,drawFlag:!1},contPar:{width:0,height:0,winScaling:1},imgPar:{img:new Image,imgx:0,imgy:0,imgh:0,imgw:0},retrPar:{retrButton:"",MaxRetrNum:t.MaxRetrNum,retrArray:new Array,overMaxRetrNum:!1},outlinePar:{lineWidth:3,circles:[],radius:10,originalCircles:[],distanceBound:100,PaintLines:new Array,originalPaintLines:new Array},clickEvePar:{previousSelectedCircle:[],isDraggingCir:t.isDraggingCir[0],clickX:0,clickY:0},mSelPointPar:{mSelectedCircleIndex:"",mSelectedPointDownIndex:0,mSelectedPointUpIndex:0,mSelectedPointIndex:0},zoomImg:{MIN_SCALE:t.MIN_SCALE,MAX_SCALE:t.MAX_SCALE,imgScaling:t.MIN_SCALE,zoom:1,bfScalingimgx:0,bfScalingimgy:0,zoomIntensity:t.zoomIntensity,offsetX:0,offsetY:0},dgImgPar:{zoomCauseDrag:t.zoomCauseDrag[0],draggingCanvas:t.draggingCanvas[0],preimgx:0,preimgy:0,preOffsetx:0,preOffsety:0,draggingCanvasScale:1},addDelMPPar:{hoverPointSign:"",delCirIndex:-1},APIPar:{hoverOnPoint:t.hoverOnPoint[0],firstColorArray:new Array,secondColorArray:new Array,PaintLines_target:new Array,iconArray:new Array,PaintLines_iconArray:new Array},mobilePar:{outsideCir:t.outsideCir[0]}},t.imgs_par=i.imgs_par}],link:function(a){a.$on("get_data",function(i,t){e.pretreatment(a.imgs_par),e.init(a.imgs_par),e.draw(a.imgs_par),e.winResize(a.imgs_par),e.bindRetrEve(a.imgs_par)})}}}]);var stressBoxId,theLanguage=$("html").attr("lang"),ctrl=document.querySelector("[ng-controller=SwitchViewCtrl]"),showTips=!1,fl_kpName_fir=["fl_toe","fl_knee","fl_crotch_cen","fl_crotch_out","fl_waist","fl_hip","fl_armsye","fl_biceps","fl_shoulder","fl_neck","fr_face","fl_headtop"],fl_kpName_sec=["fl_toe","fl_calf","fl_knee","fl_crotch_cen","fl_crotch_out","fl_waist","fl_hip","fl_armsye","fl_biceps","fl_shoulder","fl_neck","fr_face","fl_headtop"],fr_kpName=["fr_toe","fr_knee","fr_waist","fr_hip","fr_armsye","fr_biceps","fr_shoulder","fl_neck","fr_face","fr_headtop"],sf_kpName=["sf_knee","sf_knee","sf_knee","sf_knee","sf_belly","sf_belly","sf_belly","sf_bust","sf_jaw","sf_headtop"],sb_kpName=["sb_toe","sb_foot","sb_foot","sb_foot","sb_foot","sb_crotch","sb_hip","sb_bkwaist","sb_hump","sb_neck","sb_headtop"],exception_kpName={f:["fr_thigh"],s:["sf_jaw"]},showTips_BindName=["imgf_Hover2Suspension","imgs_Hover2Suspension"],hideGetMeasure=!1;function appendCorpName(){var i="<span>"+getCookie("tozSDK_corpName")+"</span>";$("#Account").append(i)}function showGuide(i){i.unbindFun(showTips_BindName[0]),i.unbindFun(showTips_BindName[1]),showTips=!0,i.bindFun(showTips_BindName[0],function(i,t){var a,e,n=$("#canvasContainer").offset(),r=$(".content-imgf").offset(),o=t.x+r.left-n.left,s=.0556*$("#canvasContainer").height(),g=500+s,l=-g;0===t.dir?0<o+-300?(a=o+-300,0<t.y+l?e=t.y+l:t.y+g<=$("#canvasContainer").height()&&(e=t.y+s)):o+300<$("#canvasContainer").width()&&(a=o+50,0<t.y+l?e=t.y+l:t.y+g<=$("#canvasContainer").height()&&(e=t.y+s)):1!==t.dir&&2!==t.dir||(o+300<$("#canvasContainer").width()?(a=o+50,0<t.y+l?e=t.y+l:t.y+g<=$("#canvasContainer").height()&&(e=t.y+s)):0<o+-300&&(a=o+-300,0<t.y+l?e=t.y+l:t.y+g<=$("#canvasContainer").height()&&(e=t.y+s)));var c="";null===measureData.PaintKeyPts||""===measureData.PaintKeyPts?0===t.dir?c=13===measureData.FL_MP.length?fl_kpName_sec[t.index]:fl_kpName_fir[t.index]:1===t.dir?c=fr_kpName[t.index]:"FT_Waist_Line"===t.index&&(c+="f_side_waistline_point"):0===t.dir?c=measureData.PaintKeyPts[t.index].PtName:1===t.dir?c=measureData.PaintKeyPts[t.index+measureData.FL_MP.length].PtName:"FT_Waist_Line"===t.index&&(c+="f_side_waistline_point");for(var m=0;m<exception_kpName.f.length;m++)if(c===exception_kpName.f[m])return;$("#canvasContainer").append("<div class='toz-poptip'><img class='tipimg' src='assets/imgs/Guide/"+c+".png'></div>"),null!=e&&null!=a&&$(".toz-poptip").css({top:e+"px",left:a+"px"}),$(".toz-poptip").show()},function(){$(".toz-poptip").remove()}),i.bindFun(showTips_BindName[1],function(i,t){var a,e,n=$("#canvasContainer").offset(),r=$(".content-imgs").offset(),o=t.x+r.left-n.left,s=.0556*$("#canvasContainer").height(),g=500+s,l=-g;1===t.dir?0<o+-300?(a=o+-300,0<t.y+l?e=t.y+l:t.y+g<=$("#canvasContainer").height()&&(e=t.y+s)):o+300<$("#canvasContainer").width()&&(a=o+50,0<t.y+l?e=t.y+l:t.y+g<=$("#canvasContainer").height()&&(e=t.y+s)):0!==t.dir&&2!==t.dir||(o+300<$("#canvasContainer").width()?(a=o+50,0<t.y+l?e=t.y+l:t.y+g<=$("#canvasContainer").height()&&(e=t.y+s)):0<o+-300&&(a=o+-300,0<t.y+l?e=t.y+l:t.y+g<=$("#canvasContainer").height()&&(e=t.y+s)));var c="";""===measureData.PaintKeyPts||null===measureData.PaintKeyPts?0===t.dir?c=sf_kpName[t.index]:1===t.dir?c=sb_kpName[t.index]:"Sd_FT_Waist_Line"===t.index?c+="s_front_waistline_point":"Sd_BK_Waist_Line"===t.index?c+="s_back_waistline_point":"Sd_Arm-S"===t.index?c+="s_arm_line_top_point":"Sd_Arm-E"===t.index&&(c+="s_sleeve_length_end_point"):0===t.dir?c=measureData.PaintKeyPts[t.index+measureData.FL_MP.length+measureData.FR_MP.length].PtName:1===t.dir?c=measureData.PaintKeyPts[t.index+measureData.FL_MP.length+measureData.FR_MP.length+measureData.SF_MP.length].PtName:"Sd_FT_Waist_Line"===t.index?c+="s_front_waistline_point":"Sd_BK_Waist_Line"===t.index?c+="s_back_waistline_point":"Sd_Arm-S"===t.index?c+="s_arm_line_top_point":"Sd_Arm-E"===t.index&&(c+="s_sleeve_length_end_point");for(var m=0;m<exception_kpName.s.length;m++)if(c===exception_kpName.s[m])return;$("#canvasContainer").append("<div class='toz-poptip'><img class='tipimg' src='assets/imgs/Guide/"+c+".png'></div>"),$(".toz-poptip").css({top:e+"px",left:a+"px"}),$(".toz-poptip").show()},function(){$(".toz-poptip").remove()})}function select2highlightBox(i){var t=$(i).attr("id").split("_");$(".text-item").removeClass("select-box"),$("#"+t[0]+"_data").addClass("select-box"),stressBoxId="#"+t[0]+"_data"}function maintainHighlightedBox(){$(".text-item").removeClass("select-box"),$(stressBoxId).addClass("select-box")}function addScrollbar(i){-1<navigator.userAgent.indexOf("Firefox")&&($(".cover-layer").show(),$(i).css({"overflow-y":"hidden","-ms-overflow-y":"hidden"}),$(i).addClass("mCustomScrollbar"),$(i).addClass("fluid"),$(".cover-layer").hide())}function showOrHideButton(i){hideGetMeasure=!0===i,document.body.clientWidth<=768?0<$("#imgfContent").css("z-index")?$("#showFrontImg").click():$("#imgfContent").css("z-index")<=0&&$("#showSideImg").click():($("#retractFront").show(),$("#showSideImg").hide(),$("#showFrontImg").hide(),!0===hideGetMeasure?$("#getMeasurements").hide():$("#getMeasurements").show(),$("#retractSide").show(),$("#imgfContent").css("z-index",9),$("#imgsContent").css("z-index",9))}appendCorpName(),addScrollbar(".cus-list"),showOrHideButton(),$(window).resize(function(){showOrHideButton()}),$(document).bind("click",function(i){for(var t=(i=i||window.event).target||i.srcElement;t;){if(t.id&&"accountContainer"==t.id)return;t=t.parentNode}$(".toz-header-drop-down-content").css("display","none")}),$("#Account").click(function(){window.location.href=accountURL[theLanguage]}),$("#Measure").click(function(){window.location.href=measureURL[theLanguage]}),$("#Tutorial").click(function(){window.location.href=tutorialURL[theLanguage]}),$("#Logout").click(function(){delCookie("tozSDK_corpName"),delCookie("tozSDK_token"),window.location.href=loginURL[theLanguage]}),$("#showTips").click(function(){var i=angular.element(ctrl).scope();!0===showTips?(showTips=!1,$(".toz-poptip").remove(),i.unbindFun(showTips_BindName[0]),i.unbindFun(showTips_BindName[1])):showGuide(i)}),$("#showSideImg").click(function(){$("#retractFront").hide(),$("#showSideImg").hide(),$("#showFrontImg").show(),!0===hideGetMeasure?$("#getMeasurements").hide():$("#getMeasurements").show(),$("#retractSide").show(),$("#imgfContent").css("z-index",-9),$("#imgsContent").css("z-index",9)}),$("#showFrontImg").click(function(){$("#retractFront").show(),$("#showSideImg").show(),$("#showFrontImg").hide(),$("#getMeasurements").hide(),$("#retractSide").hide(),$("#imgfContent").css("z-index",9),$("#imgsContent").css("z-index",-9)}),$(".toz-header-drop-down").click(function(){"none"===$(this).find(".toz-header-drop-down-content").css("display")?$(this).find(".toz-header-drop-down-content").css({display:"block"}):$(this).find(".toz-header-drop-down-content").css({display:"none"})}),setTimeout(function(){$("#Logout").click()},36e5*Number(getCookie("tozSDK_keepTime")));var token=getCookie("token"),currentPage=(theLanguage=$("html").attr("lang"),ctrl=document.querySelector("[ng-controller=SwitchViewCtrl]"),1),listTotal=0,pageLimit=20,searchStatus=!1,listData={},measureData={},excelId=-1,activeIcon="",ptDef={},ptDefLength=0,unit=["cm","in"],currentUnit=unit[0],maxTableLength=13,corpApi="",httpBasicAuth="",preViewArray=["adjust","show"],preView=preViewArray[0],isMobile=!0;function getCorpAPI(){toz_ajax.post({url:SDKAPI.getlimit,data:{accessToken:token},closeLoading:!0,success:function(i){0===i.data.code?(corpApi=i.data.data.corpApi?i.data.data.corpApi:"",httpBasicAuth=i.data.data.httpBasicAuth?i.data.data.httpBasicAuth:""):toz_Toast.init({title:"Wrong",content:i.data.data,duration:-1,mask:!1,icon:"failure"})}})}function uploadList(i){var a=void 0===i?1:i,t={};if(!1===searchStatus)t={accessToken:token,userId:"",limit:pageLimit,offset:(a-1)*pageLimit};else{var e=new Date($("#startTime").val()),n=new Date($("#endTime").val());t={accessToken:token,lastPtsStatus:Number($('input[name="selectedStatus"]:checked').val()),startTime:e.getTime()?e.getTime():"",endTime:n.getTime()?n.getTime():"",userId:$("#searchId").val()?$("#searchId").val().toString():"",limit:pageLimit,offset:(a-1)*pageLimit}}toz_ajax.post({url:SDKAPI.listMeasure,data:t,success:function(i){if($(".cus-list").empty(),void 0!==i.data.data.data){var t=(a-1)*pageLimit+1;appendAtList(listData=i.data.data.data,t),maintainHighlightedBox(),listTotal=i.data.data.total}else toz_Toast.init({title:"Wrong",content:"The data is null!",duration:-1,mask:!1,icon:"failure"})}})}function uploadTutorialList(i){var h=void 0===i?1:i,t={accessToken:token,userId:"",limit:pageLimit,offset:(h-1)*pageLimit};toz_ajax.post({url:SDKAPI.listTutorial,data:t,success:function(i){var t=(h-1)*pageLimit+1;if($("#tutorialList").empty(),void 0!==i.data.data.data){for(var a=0;a<i.data.data.data.length;a++){var e=i.data.data.data[a],n=genderTable[theLanguage][Number(e.userGender)],r=new Date(e.createdTime),o=r.getFullYear()+"-";o+=(r.getMonth()+1<10?"0"+(r.getMonth()+1):r.getMonth()+1)+"-",o+=(r.getDate()<10?"0"+r.getDate():r.getDate())+" ",o+=(r.getHours()<10?"0"+r.getHours():r.getHours())+":",o+=(r.getMinutes()<10?"0"+r.getMinutes():r.getMinutes())+":",o+=r.getSeconds()<10?"0"+r.getSeconds():r.getSeconds();void 0!==e.measureInfo&&null!==e.measureInfo&&e.measureInfo!==[]&&0!==e.measureInfo.length&&null!=typeof e.measureInfo.measures&&null!=e.measureInfo.measures&&!0;var s=t,g=o,l=e.id,c=n,m=e.userHeight,d=e.userId,P=e.userWeight,u='<li class="cus-item" ><div class="cus-content"><div class="mobile-cus-data cus-data"><div id="'+l+'_data" class="mobile-text-item text-item"><span id="listNum" title="listNum" >'+s+'</span></br><div class="mobile-cus-data-content cus-data-content"><span title="id" >'+userIdTable[theLanguage]+": "+d+'</span></br><span title="sex">'+c+'</span><span title="height">'+m+'CM</span><span title="weight">'+P+'KG</span> </br><span title="createdTime" >'+g+'</span></div></div><div class="mobile-list-button list-button"><div class="button-item"><button id="'+l+'" onclick="getTutorialData(this);select2highlightBox(this)">'+adjustTable[theLanguage]+"</button></div></div></div></div></li>";$("#tutorialList").append(u),t++}maintainHighlightedBox()}else toz_Toast.init({title:"Wrong",content:"The data is null!",duration:-1,mask:!1,icon:"failure"})}})}function appendAtList(i,t){$(".cus-list").empty();for(var a=t||1,e=0;e<i.length;e++){var n=i[e],r=genderTable[theLanguage][Number(n.userGender)],o=new Date(n.createdTime),s=o.getFullYear()+"-";s+=(o.getMonth()+1<10?"0"+(o.getMonth()+1):o.getMonth()+1)+"-",s+=(o.getDate()<10?"0"+o.getDate():o.getDate())+" ",s+=(o.getHours()<10?"0"+o.getHours():o.getHours())+":",s+=(o.getMinutes()<10?"0"+o.getMinutes():o.getMinutes())+":",s+=o.getSeconds()<10?"0"+o.getSeconds():o.getSeconds();var g=!1;void 0!==n.measureInfo&&null!==n.measureInfo&&n.measureInfo!==[]&&0!==n.measureInfo.length&&null!=typeof n.measureInfo.measures&&null!=n.measureInfo.measures&&(g=!0);var l=a,c=s,m=n.id,d=r,P=n.userHeight,u=n.userId,h=n.userWeight,f=g,p='<li class="cus-item" ><div class="cus-content"><div class="mobile-cus-data cus-data"><div id="'+m+'_data" class="mobile-text-item text-item"><span id="listNum" title="listNum" >'+l+'</span></br><div class="mobile-cus-data-content cus-data-content"><span title="id" >'+userIdTable[theLanguage]+": "+u+'</span></br><span title="sex">'+d+'</span><span title="height">'+P+'CM</span><span title="weight">'+h+'KG</span> </br><span title="createdTime" >'+c+'</span></div></div><div class="mobile-list-button list-button"><div class="button-item"><button id="'+m+'" onclick="getData(this);select2highlightBox(this)">'+adjustTable[theLanguage]+"</button>";p+=!1===f?'<button id="'+m+'_show" onclick="viewSize(this);select2highlightBox(this)" disabled>'+viewTable[theLanguage]+"</button>":'<button id="'+m+'_show" onclick="viewSize(this);select2highlightBox(this)" >'+viewTable[theLanguage]+"</button>",p+="</div></div></div></div></li>",$(".cus-list").append(p),a++}maintainHighlightedBox()}function getData(L){var i={accessToken:token,id:Number($(L).attr("id"))};toz_ajax.post({url:SDKAPI.imgsMeasure,data:i,success:function(i){if("200"==i.data.code&&null!=i.data.data){excelId=Number($(L).attr("id"));for(var t,a=JSON.parse(i.data.data.ptsInfo),e=(a=a[a.length-1]).pts_f.split(","),n=[],r=0;r<e.length;r++){n[r]=new Array,t=e[r].split(":");for(var o=0;o<t.length;o++)n[r].push(Number(t[o]))}e=a.pts_s.split(",");var s=[];for(r=0;r<e.length;r++){s[r]=new Array,t=e[r].split(":");for(o=0;o<t.length;o++)s[r].push(Number(t[o]))}var g=JSON.parse(i.data.data.basicInfo);e=g.FLCOLOR.split(",");var l=[];for(r=0;r<e.length-1;r++){t=e[r].split(":"),l[r]=new Array;for(o=0;o<t.length;o++)l[r].push(Number(t[o]))}e=g.FLCOLOR.split(",");var c=[];for(r=0;r<e.length-1;r++){t=e[r].split(":"),c[r]=new Array;for(o=0;o<t.length;o++)c[r].push(Number(t[o]))}e=g.SFCOLOR.split(",");var m=[];for(r=0;r<e.length-1;r++){t=e[r].split(":"),m[r]=new Array;for(o=0;o<t.length;o++)m[r].push(Number(t[o]))}e=g.SBCOLOR.split(",");var d=[];for(r=0;r<e.length-1;r++){t=e[r].split(":"),d[r]=new Array;for(o=0;o<t.length;o++)d[r].push(Number(t[o]))}e=g.img_f_size.split(":");var P=Number(e[0]),u=Number(e[1]);e=g.img_s_size.split(":");var h=Number(e[0]),f=Number(e[1]),p="data:image/jpg;base64,"+i.data.data.userImgBasedF,w="data:image/jpg;base64,"+i.data.data.userImgBasedS,S="";if(void 0!==g.PaintKeyPts){S=g.PaintKeyPts;var v=new Array;for(o=0;o<S.length;o++)"fl"===S[o].PtDir&&v.push(Number(S[o].PtIndex));var x=new Array;for(o=0;o<S.length;o++)"fr"===S[o].PtDir&&x.push(Number(S[o].PtIndex));var y=new Array;for(o=0;o<S.length;o++)"sf"===S[o].PtDir&&y.push(Number(S[o].PtIndex));var I=new Array;for(o=0;o<S.length;o++)"sb"===S[o].PtDir&&I.push(Number(S[o].PtIndex))}else{v=new Array;t=(e=g.FL_MP.split(";"))[0].split(",");for(o=0;o<t.length;o++)v.push(Number(t[o]));x=new Array;t=(e=g.FR_MP.split(";"))[0].split(",");for(o=0;o<t.length;o++)x.push(Number(t[o]));y=new Array;t=(e=g.SF_MP.split(";"))[0].split(",");for(o=0;o<t.length;o++)y.push(Number(t[o]));I=new Array;t=(e=g.SB_MP.split(";"))[0].split(",");for(o=0;o<t.length;o++)I.push(Number(t[o]))}measureData={id:i.data.data.id,userId:i.data.data.userId,userGender:i.data.data.userGender,userHeight:i.data.data.userHeight,userWeight:i.data.data.userWeight,createdTime:i.data.data.createdTime,PaintLines:JSON.parse(a.paintLines),pts_f:n,pts_s:s,url_f:p,url_s:w,FL_MP:v,FR_MP:x,SF_MP:y,SB_MP:I,FLCOLOR:l,FRCOLOR:c,SFCOLOR:m,SBCOLOR:d,img_f_width:P,img_f_height:u,img_s_width:h,img_s_height:f,isTutorial:!1,PaintKeyPts:S,imgCont:["#imgfContent","#imgsContent"],retrButton:["#retractFront","#retractSide"]},$("#catalogContainer").hide(),$("#prompt").hide(),$(".mobile-button-group").show(),$("#getMeasurements").show(),$("#adjustContainer").show(),preView=preViewArray[0],$("#footerMeasure").click(),$("#imgfContent").css("z-index",9),showOrHideButton();var _=angular.element(ctrl).scope();_.getData(measureData),!0===showTips&&showGuide(_)}else toz_Toast.init({title:"Wrong",content:"Sorry, network connection failed. Please try again.(Code:"+i.data.code+")",duration:-1,mask:!1,icon:"failure"})}})}function getTutorialData(i){$(".show-view").hide(),$(".right-view").show();var t={accessToken:getCookie("token"),id:Number($(i).attr("id"))};toz_ajax.post({url:SDKAPI.imgsTutorial,data:t,success:function(i){if("200"==i.data.code&&0!=i.data.data.length){for(var t,a=JSON.parse(i.data.data.ptsInfo),e=(a=a[a.length-1]).pts_f.split(","),n=[],r=0;r<e.length;r++){n[r]=new Array,t=e[r].split(":");for(var o=0;o<t.length;o++)n[r].push(Number(t[o]))}e=a.pts_s.split(",");var s=[];for(r=0;r<e.length;r++){s[r]=new Array,t=e[r].split(":");for(o=0;o<t.length;o++)s[r].push(Number(t[o]))}var g=JSON.parse(i.data.data.basicInfo);e=g.FLCOLOR.split(",");var l=[];for(r=0;r<e.length-1;r++){t=e[r].split(":"),l[r]=new Array;for(o=0;o<t.length;o++)l[r].push(Number(t[o]))}e=g.FLCOLOR.split(",");var c=[];for(r=0;r<e.length-1;r++){t=e[r].split(":"),c[r]=new Array;for(o=0;o<t.length;o++)c[r].push(Number(t[o]))}e=g.SFCOLOR.split(",");var m=[];for(r=0;r<e.length-1;r++){t=e[r].split(":"),m[r]=new Array;for(o=0;o<t.length;o++)m[r].push(Number(t[o]))}e=g.SBCOLOR.split(",");var d=[];for(r=0;r<e.length-1;r++){t=e[r].split(":"),d[r]=new Array;for(o=0;o<t.length;o++)d[r].push(Number(t[o]))}e=g.img_f_size.split(":");var P=Number(e[0]),u=Number(e[1]);e=g.img_s_size.split(":");var h=Number(e[0]),f=Number(e[1]),p="data:image/jpg;base64,"+i.data.data.userImgBasedF,w="data:image/jpg;base64,"+i.data.data.userImgBasedS,S=[],v=[],x=JSON.parse(i.data.data.targetPtsInfo);e=(x=x[x.length-1]).pts_f.split(",");for(r=0;r<e.length;r++){S[r]=new Array,t=e[r].split(":");for(o=0;o<t.length;o++)S[r].push(Number(t[o]))}e=x.pts_s.split(",");for(r=0;r<e.length;r++){v[r]=new Array,t=e[r].split(":");for(o=0;o<t.length;o++)v[r].push(Number(t[o]))}var y="";if(void 0!==g.PaintKeyPts){y=g.PaintKeyPts;var I=new Array;for(o=0;o<y.length;o++)"fl"===y[o].PtDir&&I.push(Number(y[o].PtIndex));var _=new Array;for(o=0;o<y.length;o++)"fr"===y[o].PtDir&&_.push(Number(y[o].PtIndex));var L=new Array;for(o=0;o<y.length;o++)"sf"===y[o].PtDir&&L.push(Number(y[o].PtIndex));var C=new Array;for(o=0;o<y.length;o++)"sb"===y[o].PtDir&&C.push(Number(y[o].PtIndex))}else{I=new Array;t=(e=g.FL_MP.split(";"))[0].split(",");for(o=0;o<t.length;o++)I.push(Number(t[o]));_=new Array;t=(e=g.FR_MP.split(";"))[0].split(",");for(o=0;o<t.length;o++)_.push(Number(t[o]));L=new Array;t=(e=g.SF_MP.split(";"))[0].split(",");for(o=0;o<t.length;o++)L.push(Number(t[o]));C=new Array;t=(e=g.SB_MP.split(";"))[0].split(",");for(o=0;o<t.length;o++)C.push(Number(t[o]))}measureData={id:i.data.data.id,PaintLines:JSON.parse(JSON.parse(a.paintLines)),PaintLines_target:JSON.parse(x.paintLines),pts_f:n,pts_f_target:S,pts_s:s,pts_s_target:v,url_f:p,url_s:w,FL_MP:I,FR_MP:_,SF_MP:L,SB_MP:C,FLCOLOR:l,FRCOLOR:c,SFCOLOR:m,SBCOLOR:d,img_f_width:P,img_f_height:u,img_s_width:h,img_s_height:f,PaintKeyPts:y,isTutorial:!0,imgCont:["#imgfContainer","#imgsContainer"],retrButton:["#retractFront","#retractSide"],promptButton:"#prompt"},$("#tllistContainer").hide(),$("#tutorialContainer").hide(),$(".mobile-button-group").show(),$("#prompt").show(),$("#adjustContainer").show(),$(".content-imgf").css("z-index",9),showOrHideButton(!0);var b=angular.element(ctrl).scope();b.getData(measureData),!0===showTips&&showGuide(b)}else toz_Toast.init({title:"Wrong",content:"Sorry, network connection failed. Please try again.(Code:"+i.data.code+")",duration:-1,mask:!1,icon:"failure"})}})}function viewSize(i){var t=$(i).attr("id");t=(t=t.split("_"))[0];var a={accessToken:token.toString(),id:t};toz_ajax.post({url:SDKAPI.imgsMeasure,data:a,success:function(i){if(200===i.data.code){var t="data:image/jpg;base64,"+i.data.data.userImgBasedF,a="data:image/jpg;base64,"+i.data.data.userImgBasedS;measureData={userGender:i.data.data.userGender,userHeight:i.data.data.userHeight,userWeight:i.data.data.userWeight,createdAt:i.data.data.createdTime,frontImg:t,sideImg:a};var e=JSON.parse(i.data.data.measureInfo);excelId=i.data.data.id,initSizeView(e=e[e.length-1].measures)}else toz_Toast.init({title:"Wrong",content:i.data.data,duration:-1,mask:!1,icon:"failure"})}})}function getMeasurements(){var i=new function(i){this.accessToken=token,this.id=i.id,this.pts_f=i.pts_f,this.pts_s=i.pts_s,this.paintLines=i.paintLines,this.ptsStatus=i.ptsStatus}(angular.element(ctrl).scope().postAdjustRes());toz_ajax.post({url:SDKAPI.modelling,data:i,success:function(i){"200"==i.data.code?initSizeView(i.data.data):toz_Toast.init({title:"Wrong",content:i.data.data,duration:-1,mask:!1,icon:"failure"})}})}function initSizeView(i){$("#catalogContainer").hide(),$("#adjustContainer").hide(),initToogle(),$("#showContainer").show(),preView=preViewArray[1],$("#footerMeasure").click(),null!=document.getElementById("showContainer")&&initSizeList(i,!1)}function initSizeList(i,t){$("#firBodySizeList").empty(),$("#secBodySizeList").empty();var a=0;if(!0===t)a=ptDefLength;else{ptDef={};for(var e=0;e<i.length;e++){var n=i[e].sizeid;ptDef[n]={descCn:i[e].descCn,descEn:i[e].descEn,descHk:i[e].descHk,iconUrl:i[e].iconUrl,nameCn:i[e].nameCn,nameEn:i[e].nameEn,nameHk:i[e].nameHk,sizeval:i[e].sizeval,adjustedval:i[e].adjustedval?i[e].adjustedval:i[e].sizeval,masureStatus:4},a++}ptDefLength=a}var r=document.documentElement.clientWidth,o=1;if(a<maxTableLength||r<1e3){$(".sce-table").hide();var s="";for(var e in ptDef){if(null!=ptDef[e].adjustedval&&""!=ptDef[e].adjustedval){"zh-cmn-Hans"===theLanguage?s=ptDef[e].nameCn:"en"===theLanguage?s=ptDef[e].nameEn:"ja"===theLanguage&&(s=ptDef[e].nameEn);var g="<tr  id='"+e+"'  class='measure-cell'><td  onclick='iconToggle(this)' class='measure-icon'  ><img src="+ptDef[e].iconUrl+"></td><td onclick='iconToggle(this)'>"+o+". "+s+"</td><td ondblclick='editClick(this)'class='detail-form' id='detail-form-"+e+"' value='"+ptDef[e].adjustedval.toFixed(2)+"' ><span class='size-inf no-edit-form'  >"+ptDef[e].adjustedval.toFixed(2)+"</span><div class='edit-input'></div></td></tr><tr  id='remark-"+e+"'></tr>";$("#firBodySizeList").append(g)}o++}}else{var l=0;for(var e in ptDef)l++;l=Math.ceil(l/2),$(".sce-table").show();var c=0;for(var e in ptDef){s="";if("zh-cmn-Hans"===theLanguage?s=ptDef[e].nameCn:"en"===theLanguage?s=ptDef[e].nameEn:"ja"===theLanguage&&(s=ptDef[e].nameEn),c<l){if(null!=ptDef[e].adjustedval&&""!=ptDef[e].adjustedval){g="<tr  id='"+e+"'  class='measure-cell'><td  onclick='iconToggle(this)' class='measure-icon'    ><img src="+ptDef[e].iconUrl+"></td><td onclick='iconToggle(this)'>"+o+". "+s+"</td><td ondblclick='editClick(this)'class='detail-form' id='detail-form-"+e+"' value='"+ptDef[e].adjustedval.toFixed(2)+"' ><span class='size-inf no-edit-form'  >"+ptDef[e].adjustedval.toFixed(2)+"</span><div class='edit-input'></div></td></tr><tr  id='remark-"+e+"'></tr>";$("#firBodySizeList").append(g)}}else if(null!=ptDef[e].adjustedval&&""!=ptDef[e].adjustedval){g="<tr  id='"+e+"'  class='measure-cell'><td  onclick='iconToggle(this)' class='measure-icon'  ><img src="+ptDef[e].iconUrl+"></td><td onclick='iconToggle(this)'>"+o+". "+s+"</td><td ondblclick='editClick(this)'class='detail-form' id='detail-form-"+e+"' value='"+ptDef[e].adjustedval.toFixed(2)+"' ><span class='size-inf no-edit-form'  >"+ptDef[e].adjustedval.toFixed(2)+"</span><div class='edit-input'></div></td></tr><tr  id='remark-"+e+"'></tr>";$("#secBodySizeList").append(g)}o++,c++}}$(".content").mCustomScrollbar()}function iconToggle(i){var t=i.parentElement.nextSibling.id,a=t.split("-"),e="#remark-"+activeIcon,n="#"+t;if(a[1]!=activeIcon){if(""!=activeIcon&&($(e).removeClass("micon-active"),$(e).find(".desc-container").remove()),$(n).addClass("micon-active"),activeIcon=a[1],"zh-cmn-Hans"===theLanguage)var r="<p>"+ptDef[activeIcon].descCn+"</p>";else if("en"===theLanguage)r="<p>"+ptDef[activeIcon].descEn+"</p>";else if("ja"===theLanguage)r="<p>"+ptDef[activeIcon].descEn+"</p>";$(n).prepend("<td colspan='3' class='desc-container' onclick='descToggle(this)'><div class='desc-arrow desc-arrow-right'></div> <div class='size-desc'>"+r+"</div></td>")}else $(n).find(".desc-container").remove(),$(n).removeClass("micon-active"),activeIcon=""}function descToggle(i){var t="#"+i.parentElement.id+" .desc-container .size-desc",a="#"+i.parentElement.id+" .desc-container .desc-arrow";$(t).toggle("fast",function(){"none"==$(t).css("display")?($(a).removeClass("desc-arrow-right"),$(a).addClass("desc-arrow-left")):($(a).addClass("desc-arrow-right"),$(a).removeClass("desc-arrow-left"))})}function editClick(t){if(!$(t).is(".input")){var a=Number($(t).text());$(t).addClass("input").html('<input type="number"  value="'+Number($(t).text())+'" />').find("input").focus().blur(function(){var i=t.id.split("-");i=i[2],ptDef[i].adjustedval=Number($(this).val()),ptDef[i].adjustedval!=a&&(ptDef[i].masureStatus=3),$(this).parent().removeClass("input").html($(this).val()||a||0)})}}function toogle(i){if("CM"===$(i).text()){for(var t in ptDef)ptDef[t].adjustedval*=.3937008,currentUnit=unit[1],$("#detail-form-"+t).text(ptDef[t].adjustedval.toFixed(2));$(i).html("IN")}else if("IN"===$(i).text()){for(var t in ptDef)ptDef[t].adjustedval*=2.54,currentUnit=unit[0],$("#detail-form-"+t).text(ptDef[t].adjustedval.toFixed(2));$(i).html("CM")}}function initToogle(){$(".unit-toogle").html("CM")}function timeAscending(i,t){return i.createdTime<t.createdTime?-1:i.createdTime>t.createdTime?1:0}function timeDescending(i,t){return i.createdTime<t.createdTime?1:i.createdTime>t.createdTime?-1:0}showTips_BindName=["imgf_Click2Suspension","imgs_Click2Suspension"],getCorpAPI(),uploadList(1),$("#mobileSearch").click(function(){"none"===$("#searchContainer").css("display")?($("#listContainer").hide(),$("#searchContainer").show()):($("#searchContainer").hide(),$("#listContainer").show())}),$("#searchButton").click(function(){$("#pageToolbar").empty(),searchStatus=!0,uploadList(),$("#searchContainer").hide(),$("#listContainer").show()}),$("#prePage").click(function(){1!==currentPage&&uploadList(--currentPage)}),$("#nextPage").click(function(){currentPage!==Math.ceil(listTotal/pageLimit)&&uploadList(++currentPage)}),$("#sortDe").click(function(){$("#sortDe").hide(),$("#sortAs").show(),appendAtList(listData=listData.sort(timeAscending))}),$("#sortAs").click(function(){$("#sortAs").hide(),$("#sortDe").show(),appendAtList(listData=listData.sort(timeDescending))}),$("#footerList").click(function(){$(".footer-nav-bar-content li").removeClass("mobile-selected"),$("#footerList").addClass("mobile-selected"),$(".mobile-container").hide(),$("#catalogContainer").show()}),$("#footerMeasure").click(function(){$(".footer-nav-bar-content li").removeClass("mobile-selected"),$("#footerMeasure").addClass("mobile-selected"),$(".mobile-container").hide(),preView===preViewArray[1]?($("#adjustContainer").hide(),$("#showContainer").show()):($("#showContainer").hide(),$("#adjustContainer").show())}),$("#footerTutorial").click(function(){$(".footer-nav-bar-content li").removeClass("mobile-selected"),$("#footerTutorial").addClass("mobile-selected"),uploadTutorialList(1),$(".mobile-container").hide(),$("#tllistContainer").show(),$("#tutorialContainer").show()}),$("#footerAccount").click(function(){$(".footer-nav-bar-content li").removeClass("mobile-selected"),$("#footerAccount").addClass("mobile-selected"),$(".mobile-container").hide(),$("#accountContainer").show()}),$("#toExcelButton").click(function(){var i=new Array,t="CM";"off"===$(".move").attr("data-state")&&(t="IN");var a=cloneObj(ptDef),e={};e.fileName="UserId"+excelId+"_"+(new Date).toISOString().replace(/[\-\:\.]/g,"");var n=$("html").attr("lang");if("zh-cmn-Hans"===n){for(var r in a)i.push({one:a[r].nameCn,two:a[r].adjustedval.toFixed(2)});e.datas=[{sheetData:i,sheetName:"sheet",sheetFilter:["one","two"],sheetHeader:["名称","尺寸/"+t]}]}else if("en"===n){for(var r in a)i.push({one:a[r].nameEn,two:a[r].adjustedval.toFixed(2)});e.datas=[{sheetData:i,sheetName:"sheet",sheetFilter:["one","two"],sheetHeader:["Name","Size/"+t]}]}else if("ja"===n){for(var r in a)i.push({one:a[r].nameEn,two:a[r].adjustedval.toFixed(2)});e.datas=[{sheetData:i,sheetName:"sheet",sheetFilter:["one","two"],sheetHeader:["Name","Size/"+t]}]}new ExportJsonExcel(e).saveExcel()});theLanguage=$("html").attr("lang");null===(token=getCookie("tozSDK_token"))||""===token?(delCookie("tozSDK_corpName"),delCookie("tozSDK_token"),window.location.href=loginURL[theLanguage]):toz_ajax.post({url:SDKAPI.getlimit,data:{accessToken:token},closeLoading:isMobile||!1,success:function(i){0===i.data.code?($("#measureTimes").html(i.data.data.apiUsage),$("#totalTimes").html(i.data.data.apiLimit),$("#emailName").html(i.data.data.email),$("#chgTozAPI").html("<p>"+(i.data.data.corpApi?i.data.data.corpApi:"Null")+"</p>"),$("#corpApi").attr("value",i.data.data.corpApi?i.data.data.corpApi.replace("https://",""):""),$("#httpBasicAuth").attr("value",i.data.data.httpBasicAuth?i.data.data.httpBasicAuth:"")):toz_Toast.init({title:"Wrong",content:i.data.data,duration:-1,mask:!1,icon:"failure"})}}),$(".cnAccountUrl").click(function(){window.location.href=accountURL["zh-cmn-Hans"]}),$(".enAccountUrl").click(function(){window.location.href=accountURL.en}),$(".jpAccountUrl").click(function(){window.location.href=accountURL.ja}),$(".return-account-html").click(function(){$(".reset-email-html").hide(),$(".reset-password-html").hide(),$(".reset-api-html").hide(),$(".account-html").show()}),$("#chgEmail").click(function(){$(".account-html").hide(),$(".reset-email-html").show()}),$("#chgPassword").click(function(){$(".account-html").hide(),$(".reset-password-html").show()}),$("#chgAPI").click(function(){$(".account-html").hide(),$(".reset-api-html").show()}),$("#firPw").on("change",function(){if(/^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!@$%^&*-_]).{6,16}$/.test($("#firPw").val()))$("#firPwWarning p").remove(),$("#firPwWrong").hide(),$("#firPwRight").show();else if($("#firPwRight").hide(),$("#firPwWrong").show(),!$("#firPwWarning").html()){var i="<p>"+accountFirPwWarning[theLanguage]+"</p>";$("#firPwWarning").append(i)}if(""!=$("#secPw").val()&&null!=$("#secPw").val())if($("#firPw").val()===$("#secPw").val())$("#secPwWarning p").remove(),$("#secPwWrong").hide(),$("#secPwRight").show();else if($("#secPwRight").hide(),$("#secPwWrong").show(),!$("#secPwWarning").html()){i="<p>"+accountSecPwWarning[theLanguage]+"</p>";$("#secPwWarning").append(i)}}),$("#secPw").on("change",function(){if($("#firPw").val()===$("#secPw").val())$("#secPwWarning p").remove(),$("#secPwWrong").hide(),$("#secPwRight").show();else if($("#secPwRight").hide(),$("#secPwWrong").show(),!$("#secPwWarning").html()){var i="<p>"+accountSecPwWarning[theLanguage]+"</p>";$("#secPwWarning").append(i)}}),$("#PwSubmit").click(function(){var i=/^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!@$%^&*-_]).{6,16}$/;if(i.test($("#firPw").val())&&$("#firPw").val()==$("#secPw").val()){var t={accessToken:token,oldpassword:$("#oldPassword").val(),newpassword:$("#firPw").val()};toz_ajax.post({url:SDKAPI.resetpsw,data:t,success:function(i){0===i.data.code?toz_Toast.init({title:"Success",content:"Password has changed",duration:2e3,mask:!1,icon:"success"}):toz_Toast.init({title:"Wrong",content:i.data.data,duration:-1,mask:!1,icon:"failure"})}})}else i.test($("#firPw").val())?$("#firPw").val()!=$("#secPw").val()&&toz_Toast.init({title:"Warning",content:accountSecPwWarning[theLanguage],duration:-1,mask:!1,icon:"warning"}):toz_Toast.init({title:"Warning",content:accountFirPwWarning[theLanguage],duration:-1,mask:!1,icon:"warning"})}),$("#sendCode").click(function(){var i=$("#email").val();if(null!==i&&""!=i){$("#sendCode").attr("disabled","true");var t=60,a=setInterval(function(){$("#sendCode").html(t),0===--t&&(clearInterval(a),$("#sendCode").html(sendText[theLanguage]),$("#sendCode").removeAttr("disabled"))},1e3),e={accessToken:token,email:i};toz_ajax.post({url:SDKAPI.acSendEmail,data:e,success:function(i){0!=i.data.code&&(clearInterval(a),$("#sendCode").html(sendText[theLanguage]),$("#sendCode").removeAttr("disabled"),toz_Toast.init({title:"Wrong",content:i.data.data,duration:-1,mask:!1,icon:"failure"}))},complete:function(i,t){200!=i.status&&(clearInterval(a),$("#sendCode").html(sendText[theLanguage]),$("#sendCode").removeAttr("disabled"))}})}else toz_Toast.init({title:"Warning",content:"Email can't empty!",duration:3e3,mask:!1,icon:"warning"})}),$("#VerCode").on("change",function(){var i={email:$("#email").val(),code:$("#VerCode").val()};toz_ajax.post({url:SDKAPI.vericode,data:i,closeLoading:!0,success:function(i){0===i.data.code?($("#codeWrong").hide(),$("#codeRight").show(),$("#emailSubmit").removeAttr("disabled")):($("#codeRight").hide(),$("#codeWrong").show(),$("#emailSubmit").attr("disabled","true"))}})}),$("#emailSubmit").click(function(){var i={email:$("#email").val(),accessToken:getCookie("token")};toz_ajax.post({url:SDKAPI.newemail,data:i,success:function(i){0===i.data.code?toz_Toast.init({title:"Success",content:"Password has changed",duration:2e3,mask:!1,icon:"success"}):toz_Toast.init({title:"Wrong",content:i.data.data,duration:-1,mask:!1,icon:"failure"})}})}),$("#APISubmit").click(function(){var t="";$("#corpApi").val().match(/^\s*$/)||(t="https://"+$("#corpApi").val());var i=$("#httpBasicAuth").val(),a={accessToken:token,httpBasicAuth:i.toString(),corpApi:t.toString()};toz_ajax.post({url:SDKAPI.updatecorpapi,data:a,contentType:"application/json",success:function(i){0===i.data.code?($("#chgTozAPI").html("<p>"+(""===t?"Null":t)+"</p>"),toz_Toast.init({title:"Success",content:"Api has been reset",duration:2e3,mask:!1,icon:"success"})):toz_Toast.init({title:"Wrong",content:i.data.data,duration:-1,mask:!1,icon:"failure"})}})}),$("#Logout").click(function(){delCookie("tozSDK_corpName"),delCookie("tozSDK_token"),window.location.href=loginURL[theLanguage]}),$(".header-nav-bar-content li a").hover(function(){$("#accountContainer").removeClass("nav-bar-select")},function(){$("#accountContainer").addClass("nav-bar-select")}),$("#corpApi").on("change",function(){var i=$(this).val();if(new RegExp(/[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/gi).test(i))$("#cApiWarnText").empty();else{var t="<p>"+cApiWarnText[theLanguage]+"</p>";$("#cApiWarnText").empty(),$("#cApiWarnText").append(t)}new RegExp("^(http|https)://","i").test(i)&&(i=(i=i.replace("https://","")).replace("http://",""),$(this).val(i))});