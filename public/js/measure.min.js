"use strict";var loginURL={"zh-cmn-Hans":"https://www.emtailor.com/b2bviews/backend-sdk/cn/login.html",en:"https://www.emtailor.com/b2bviews/backend-sdk/en/login.html",ja:"https://www.emtailor.com/b2bviews/backend-sdk/jp/login.html"},measureURL={"zh-cmn-Hans":"https://www.emtailor.com/b2bviews/backend-sdk/cn/measure.html",en:"https://www.emtailor.com/b2bviews/backend-sdk/en/measure.html",ja:"https://www.emtailor.com/b2bviews/backend-sdk/jp/measure.html"},tutorialURL={"zh-cmn-Hans":"https://www.emtailor.com/b2bviews/backend-sdk/cn/tutorial.html",en:"https://www.emtailor.com/b2bviews/backend-sdk/en/tutorial.html",ja:"https://www.emtailor.com/b2bviews/backend-sdk/jp/tutorial.html"},accountURL={"zh-cmn-Hans":"https://www.emtailor.com/b2bviews/backend-sdk/cn/account.html",en:"https://www.emtailor.com/b2bviews/backend-sdk/en/account.html",ja:"https://www.emtailor.com/b2bviews/backend-sdk/jp/account.html"},forgetPwURL={"zh-cmn-Hans":"https://www.emtailor.com/b2bviews/backend-sdk/cn/forget-password.html",en:"https://www.emtailor.com/b2bviews/backend-sdk/en/forget-password.html",ja:"https://www.emtailor.com/b2bviews/backend-sdk/jp/forget-password.html"},measureMobileURL={"zh-cmn-Hans":"https://www.emtailor.com/b2bviews/backend-sdk/cn/measure-mobile.html",en:"https://www.emtailor.com/b2bviews/backend-sdk/en/measure-mobile.html",ja:"https://www.emtailor.com/b2bviews/backend-sdk/jp/measure-mobile.html"},userIdTable={"zh-cmn-Hans":"用户 ID",en:"User ID",ja:"名前"},adjustTable={"zh-cmn-Hans":"调整",en:"Adjust",ja:"調整"},viewTable={"zh-cmn-Hans":"展示",en:"View",ja:"表示"},genderTable={"zh-cmn-Hans":["女","男"],en:["Female","Male"],ja:["女性","男性"]},accountFirPwWarning={"zh-cmn-Hans":"密码长度6-16位，至少分别有一个特殊符号、大写字母、小写字母和数字",en:"Password must be 6-16 characters, and including at least one special character, capital letter, lowercase letter, and digit.",ja:"パスワードは6-16文字で、記号、大文字、小文字、数字を含んでいる必要があります"},accountSecPwWarning={"zh-cmn-Hans":"两个密码不一致",en:"Password is different from the first one.",ja:"パスワードが一致しません"},sendText={"zh-cmn-Hans":"Send",en:"Send",ja:"送る"},cApiWarnText={"zh-cmn-Hans":"这不是一个合法的域名",en:"It isn't an authorized domain!",ja:"It isn't an authorized domain!"},SDKAPI={signin:"https://www.emtailor.com/b2b/api/corp/signin",imgsMeasure:"https://www.emtailor.com/b2b/api/measure/imgs",imgsTutorial:"https://www.emtailor.com/b2b/api/tutorial/imgs",getlimit:"https://www.emtailor.com/b2b/api/corp/acsetting/getlimit",add:"https://www.emtailor.com/b2b/api/measure/add",resetpsw:"https://www.emtailor.com/b2b/api/corp/acsetting/resetpsw",sendemail:"https://www.emtailor.com/b2b/api/corp/forgetpsw/sendemail",acSendEmail:"https://www.emtailor.com/b2b/api/corp/acsetting/sendemail",vericode:"https://www.emtailor.com/b2b/api/corp/forgetpsw/vericode",newemail:"https://www.emtailor.com/b2b/api/corp/acsetting/newemail",newpsw:"https://www.emtailor.com/b2b/api/corp/forgetpsw/newpsw",modelling:"https://www.emtailor.com/b2b/api/measure/modelling",listMeasure:"https://www.emtailor.com/b2b/api/measure/list",listTutorial:"https://www.emtailor.com/b2b/api/tutorial/list",updatecorpapi:"https://www.emtailor.com/b2b/api/corp/acsetting/updatecorpapi"};(toz_ajax=function(i){this.settings={}}).prototype={post:function(i){var e=this,t="tozA_"+this.genID(2);if(this.settings[t]=$.extend({url:"",data:"",timeout:12e4,dataType:"JSON",async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",headers:{Authorization:""},crossDomain:!1,beforeSend:new Function("return"),success:new Function("return"),fail:new Function("return"),complete:new Function("return"),closeLoading:!1},i),""===this.settings[t].url&&toz_Toast.init({title:"Wrong",content:"Url can't be empty.",duration:-1,mask:!1,icon:"failure"}),!this.settings[t].closeLoading)var n=toz_Toast.init({title:"Loading",content:"",duration:-1,mask:!0,icon:"loading"});this.settings[t].beforeSend(this.settings[t]);var r=$.ajax({type:"post",url:e.settings[t].url,data:e.settings[t].data,timeout:e.settings[t].timeout,dataType:e.settings[t].dataType,async:e.settings[t].async,crossDomain:e.settings[t].crossDomain,headers:{Authorization:e.settings[t].headers.Authorization},success:function(i){e.settings[t].closeLoading||toz_Toast.hideToast(n),setTimeout(function(){e.settings[t].success(i),delete e.settings[t]},550)},fail:function(i){e.settings[t].closeLoading||toz_Toast.hideToast(n),toz_Toast.init({title:"Wrong",content:i,duration:-1,mask:!1,icon:"failure"}),e.settings[t].fail(i),delete e.settings[t]},complete:function(i,a){"timeout"==a?r.abort():200!=i.status&&(e.settings[t].closeLoading||toz_Toast.hideToast(n),toz_Toast.init({title:"Wrong",content:"Sorry, network connection failed. Please try again.(ErrorCode:"+i.status+")",duration:-1,mask:!1,icon:"failure"}),e.settings[t].complete({XMLHttpRequest:i,status:a}),delete e.settings[t])}})},get:function(){},genID:function(i){return Number(Math.random().toString().substr(3,i)+Date.now()).toString(36)}};var toz_ajax=new toz_ajax;function setCookie(i,a,e){var t=new Date;t.setDate(t.getDate()+e),document.cookie=i+"="+a+";expires="+t+";path=/"}function getCookie(i){var a=RegExp(i+"=([^;]+)"),e=document.cookie.match(a);return e?e[1]:""}function delCookie(i){setCookie(i,null,-1)}var cloneObj=function(i){var a,e=i.constructor===Array?[]:{};if("object"==typeof i){if(window.JSON)a=JSON.stringify(i),e=JSON.parse(a);else for(var t in i)e[t]="object"==typeof i[t]?cloneObj(i[t]):i[t];return e}};function isPc(){var i={},a=navigator.platform;return i.win=0==a.indexOf("Win"),i.mac=0==a.indexOf("Mac"),i.x11="X11"==a||0==a.indexOf("Linux"),!!(i.win||i.mac||i.xll)}var view=angular.module("adjustment",[]);view.factory("dataSrv",["$rootScope",function(){return{imgCont:{},retrButton:{},mRatio:.05,closeRatio:.95,radiusRatio:.015,lineWidth:2,enLargePLCirRadius:2,mobileTouchRatio:1,enLargeMRadius:2,minDownIndex:100,maxUpIndex:250,minMPDownIndex:50,maxMPUpIndex:250,bottomNum:1.5,staticCirCol:"#000FFF",moveCirCol:"rgb(255,0,0)",setOutTime:100,cusCirCol:"rgb(50,205,50)",MaxRetrNum:20,promptCol:"rgb(220,220,220)",lineCap:"round",globalAlpha:.4,pageLimit:20,defImgSrc:"../public/assets/imgs/def_icon.png",targetImgSrc:"../public/assets/imgs/target_icon.png",imgDir:["f","s","b"],LineType:["free","L","R"],sign:["sys","cus"],MPIcon:["deflection","target"],MIN_SCALE:1,MAX_SCALE:5,zoomIntensity:.2,drawDir:[0,1,2],drawDirIndex:{f:{L:0,R:1},s:{L:1,R:0},b:{L:0,R:1}},isDraggingCir:[!1,!0],Flag:[!1,!0],APIFlag:!1,draggingCanvas:[!1,!0],isTutorial:[!1,!0],overMaxRetrNum:[!1,!0],adjustImgStatus:{},zoomCauseDrag:[!1,!0],hoverOnPoint:[!1,!0],showPrompt:[!1,!0],outsideCir:[!1,!0],MAXNUM:99999,testNum:/^[0-9]*$/,warngCol:"rgb(255,0,0)",perfCol:"rgb(255,255,0)"}}]),view.factory("drawSrv",["dataSrv",function(b){return{newPar:function(i,a,e){return{imgDir:i,drawCanvasJqueryId:$("#"+a),canvasDraw:document.getElementById(a),ctxDraw:document.getElementById(a).getContext("2d"),canvasImg:document.getElementById(e),ctxImg:document.getElementById(e).getContext("2d"),infPar:{showPrompt:b.showPrompt[0],resizeTimer:null,eventFlag:!1,drawFlag:!1},contPar:{width:0,height:0,winScaling:1},imgPar:{img:new Image,imgx:0,imgy:0,imgh:0,imgw:0},retrPar:{retrButton:"",MaxRetrNum:b.MaxRetrNum,retrArray:new Array,overMaxRetrNum:!1},outlinePar:{lineWidth:b.lineWidth,circles:[],radius:10,originalCircles:[],distanceBound:100,PaintLines:new Array},clickEvePar:{previousSelectedCircle:[],isDraggingCir:b.isDraggingCir[0],clickX:0,clickY:0},mSelPointPar:{mSelectedCircleIndex:"",mSelectedPointDownIndex:0,mSelectedPointUpIndex:0,mSelectedPointIndex:0},zoomImg:{MIN_SCALE:b.MIN_SCALE,MAX_SCALE:b.MAX_SCALE,imgScaling:b.MIN_SCALE,zoom:1,bfScalingimgx:0,bfScalingimgy:0,zoomIntensity:b.zoomIntensity,offsetX:0,offsetY:0},dgImgPar:{zoomCauseDrag:b.zoomCauseDrag[0],draggingCanvas:b.draggingCanvas[0],preimgx:0,preimgy:0,preOffsetx:0,preOffsety:0,draggingCanvasScale:1},addDelMPPar:{hoverPointSign:"",delCirIndex:-1},APIPar:{hoverOnPoint:b.hoverOnPoint[0],firstColorArray:new Array,secondColorArray:new Array,PaintLines_target:new Array,iconArray:new Array,PaintLines_iconArray:new Array},mobilePar:{gestureScale:1,outsideCir:b.outsideCir[0]}}},pretreatment:function(i){b.adjustImgStatus[i.imgDir]=!1,i.imgPar.img.src=b.data.url[i.imgDir],i.retrPar.retrButton=b.retrButton[i.imgDir],i.mobilePar.gestureScale=1,i.retrPar.retrArray=new Array,i.infPar.resizeTimer=null,b.data.isTutorial===b.isTutorial[1]&&this.tutorialMode(i),this.middleTier(i)},tutorialMode:function(i){for(var a=this,e=b.data.pts[i.imgDir],t=b.originalData.ptsTarget[i.imgDir],n=$(b.imgCont[i.imgDir]).height(),r=0,o=0;o<e.length-1;o++){var s=Math.sqrt(Math.pow(e[o][r]-t[o][r],2)+Math.pow(e[o][r+1]-t[o][r+1],2)),g=Math.sqrt(Math.pow(e[o+1][r]-t[o+1][r],2)+Math.pow(e[o+1][r+1]-t[o+1][r+1],2));i.APIPar.firstColorArray.push({index:o,rgb:a.dist2Rgb(1-(s+g)/(2*n*b.mRatio))})}r=2;for(o=0;o<e.length-1;o++){s=Math.sqrt(Math.pow(e[o][r]-t[o][r],2)+Math.pow(e[o][r+1]-t[o][r+1],2)),g=Math.sqrt(Math.pow(e[o+1][r]-t[o+1][r],2)+Math.pow(e[o+1][r+1]-t[o+1][r+1],2));i.APIPar.secondColorArray.push({index:o,rgb:a.dist2Rgb(1-(s+g)/(2*n*b.mRatio))})}$(b.promptButton).click(function(){i.infPar.showPrompt===b.showPrompt[0]?i.infPar.showPrompt=b.showPrompt[1]:i.infPar.showPrompt=b.showPrompt[0],a.drawCirLine(i)})},middleTier:function(a){var e=this;$(a.retrPar.retrButton).click(function(){e.doRetroversion(a)}),a.canvasDraw.onselectstart=function(){return!1},a.canvasDraw.ondblclick=function(i){e.addDelMP(i,a)},$(window).bind("resize",function(){a.infPar.resizeTimer&&clearTimeout(a.infPar.resizeTimer),a.infPar.resizeTimer=setTimeout(function(){a.infPar.eventFlag===b.Flag[0]&&a.infPar.drawFlag===b.Flag[0]&&b.APIFlag==b.Flag[0]&&(e.resizeInit(a),e.draw(a))},150)}),e.isPc()?(a.canvasDraw.onmousedown=function(i){e.canvasClick(i,a)},a.canvasDraw.onmousemove=function(i){e.dragging(i,a)},a.canvasDraw.onmouseup=function(i){e.stopDragging(i,a)},a.canvasDraw.onmouseout=function(i){e.stopDragging(i,a)},a.canvasDraw.onmousewheel=function(i){e.scaleImg(i,a)},document.addEventListener&&a.canvasDraw.addEventListener("DOMMouseScroll",function(i){e.scaleImg(i,a)},!1)):e.setGesture(a)},init:function(r){if(r.infPar.eventFlag===b.Flag[0]&&r.infPar.drawFlag===b.Flag[0]&&b.APIFlag==b.Flag[0]){r.infPar.eventFlag=b.Flag[1];var i,a,o=this,e=b.data.MP[r.imgDir][0],t=b.data.MP[r.imgDir][1],n=b.data.pts[r.imgDir],s=b.data.imgSize[r.imgDir][0],g=b.data.imgSize[r.imgDir][1];i=b.data.isTutorial===b.isTutorial[1]?b.originalData.ptsTarget[r.imgDir]:b.originalData.pts[r.imgDir],r.ctxDraw.clearRect(0,0,r.canvasDraw.width,r.canvasDraw.height),r.ctxImg.clearRect(0,0,r.canvasImg.width,r.canvasImg.height),r.infPar={showPrompt:b.showPrompt[0],resizeTimer:null,eventFlag:b.Flag[1],drawFlag:!1},r.clickEvePar={previousSelectedCircle:[],isDraggingCir:b.isDraggingCir[0],clickX:0,clickY:0},r.mSelPointPar={mSelectedCircleIndex:"",mSelectedPointDownIndex:0,mSelectedPointUpIndex:0,mSelectedPointIndex:0},r.zoomImg={MIN_SCALE:b.MIN_SCALE,MAX_SCALE:b.MAX_SCALE,imgScaling:b.MIN_SCALE,zoom:1,bfScalingimgx:0,bfScalingimgy:0,zoomIntensity:b.zoomIntensity,offsetX:0,offsetY:0},r.addDelMPPar={hoverPointSign:"",delCirIndex:-1},r.contPar={width:$(b.imgCont[r.imgDir]).width(),height:$(b.imgCont[r.imgDir]).height(),winScaling:$(b.imgCont[r.imgDir]).height()/g},r.canvasDraw.width=r.contPar.width,r.canvasDraw.height=r.contPar.height,r.canvasImg.width=r.contPar.width,r.canvasImg.height=r.contPar.height,r.imgPar.imgh=r.contPar.height,r.imgPar.imgw=s*r.contPar.height/g,r.imgPar.imgx=(r.contPar.width-r.imgPar.imgw)/2,r.imgPar.imgy=0,r.dgImgPar={zoomCauseDrag:b.zoomCauseDrag[0],draggingCanvas:b.draggingCanvas[0],preimgx:r.imgPar.imgx,preimgy:r.imgPar.imgy,preOffsetx:0,preOffsety:0,draggingCanvasScale:b.MIN_SCALE},r.outlinePar={lineWidth:b.lineWidth,circles:[],radius:r.contPar.height*b.radiusRatio,originalCircles:[],distanceBound:r.contPar.height*b.mRatio,PaintLines:new Array},r.APIPar={hoverOnPoint:b.hoverOnPoint[0],firstColorArray:new Array,secondColorArray:new Array,PaintLines_target:new Array,iconArray:new Array,PaintLines_iconArray:new Array};for(var c=0;c<e.length;c++){var l=e[c].index;a=e[c].sign===b.sign[0]?b.sign[0]:b.sign[1];var m=o.createcircle(n[l][0]*r.contPar.winScaling+r.imgPar.imgx,n[l][1]*r.contPar.winScaling,a),d=o.createcircle(i[l][0]*r.contPar.winScaling+r.imgPar.imgx,i[l][1]*r.contPar.winScaling,a);r.outlinePar.circles.push(m),r.outlinePar.originalCircles.push(d)}for(c=0;c<t.length;c++){l=t[c].index;a=t[c].sign===b.sign[0]?b.sign[0]:b.sign[1];m=o.createcircle(n[l][2]*r.contPar.winScaling+r.imgPar.imgx,n[l][3]*r.contPar.winScaling,a),d=o.createcircle(i[l][2]*r.contPar.winScaling+r.imgPar.imgx,i[l][3]*r.contPar.winScaling,a);r.outlinePar.circles.push(m),r.outlinePar.originalCircles.push(d)}angular.forEach(b.data.PaintLines,function(i){if(i.ImgDir===r.imgDir)if(i.LineType!=b.LineType[0]){var a=b.drawDirIndex[r.imgDir][i.LineType];if(i.LineType===b.LineType[1])var e=o.findPointOnOutline(i.StartPt.Y*r.contPar.winScaling,a,r),t=o.createcircle(e+r.imgPar.imgx,i.StartPt.Y*r.contPar.winScaling,b.sign[0]),n=o.createcircle(r.imgPar.imgx,i.EndPt.Y*r.contPar.winScaling,b.sign[0]);else if(i.LineType===b.LineType[2])e=o.findPointOnOutline(i.StartPt.Y*r.contPar.winScaling,a,r),t=o.createcircle(e+r.imgPar.imgx,i.StartPt.Y*r.contPar.winScaling,b.sign[0]),n=o.createcircle(s*r.contPar.winScaling+r.imgPar.imgx,i.EndPt.Y*r.contPar.winScaling,b.sign[0]);r.outlinePar.PaintLines.push({StartPt:t,EndPt:n,ImgDir:i.ImgDir,LineName:i.LineName,LineType:i.LineType})}else if(i.LineType===b.LineType[0]){t=o.createcircle(i.StartPt.X*r.contPar.winScaling+r.imgPar.imgx,i.StartPt.Y*r.contPar.winScaling,b.sign[0]),n=o.createcircle(i.EndPt.X*r.contPar.winScaling+r.imgPar.imgx,i.EndPt.Y*r.contPar.winScaling,b.sign[0]);r.outlinePar.PaintLines.push({StartPt:t,EndPt:n,ImgDir:i.ImgDir,LineName:i.LineName,LineType:i.LineType})}});for(c=0;c<b.data.pts[r.imgDir].length;c++)b.data.pts[r.imgDir][c][0]+=r.imgPar.imgx/r.contPar.winScaling,b.data.pts[r.imgDir][c][2]+=r.imgPar.imgx/r.contPar.winScaling;b.data.isTutorial===b.isTutorial[1]&&(angular.forEach(b.data.PaintLines_target,function(i){if(i.ImgDir===r.imgDir){if(i.LineType===b.LineType[0])var a=o.createcircle(i.StartPt.X,i.StartPt.Y,b.sign[0]),e=o.createcircle(i.EndPt.X,i.EndPt.Y,b.sign[0]);else a=o.createcircle(s,i.EndPt.Y,b.sign[0]),e=o.createcircle(s,i.EndPt.Y,b.sign[0]);r.APIPar.PaintLines_target.push({StartPt:a,EndPt:e,ImgDir:i.ImgDir,LineName:i.LineName,LineType:i.LineType,rgb:b.warngCol})}}),angular.forEach(r.outlinePar.PaintLines,function(t,i){angular.forEach(r.APIPar.PaintLines_target,function(i,a){if(t.LineName===i.LineName){var e={dir:b.drawDir[2],index:t.LineName,x:t.EndPt.x,y:t.EndPt.y};o.setRgb(e,r.APIPar.PaintLines_target[a],r)}})})),r.infPar.eventFlag=b.Flag[0]}},resizeInit:function(n){if(n.infPar.eventFlag===b.Flag[0]&&n.infPar.drawFlag===b.Flag[0]&&b.APIFlag==b.Flag[0]){n.infPar.eventFlag=b.Flag[1];for(var r=n.contPar.winScaling*n.zoomImg.imgScaling,i=b.data.pts[n.imgDir],a=0;a<i.length;a++)i[a][0]=(i[a][0]*n.contPar.winScaling-n.imgPar.imgx)/r,i[a][1]=(i[a][1]*n.contPar.winScaling-n.imgPar.imgy)/r,i[a][2]=(i[a][2]*n.contPar.winScaling-n.imgPar.imgx)/r,i[a][3]=(i[a][3]*n.contPar.winScaling-n.imgPar.imgy)/r;angular.forEach(b.data.PaintLines,function(e,t){e.ImgDir===n.imgDir&&angular.forEach(n.outlinePar.PaintLines,function(i,a){e.LineName===i.LineName&&(b.data.PaintLines[t].StartPt.X=(i.StartPt.x-n.imgPar.imgx)/r,b.data.PaintLines[t].StartPt.Y=(i.StartPt.y-n.imgPar.imgy)/r,b.data.PaintLines[t].EndPt.X=(i.EndPt.x-n.imgPar.imgx)/r,b.data.PaintLines[t].EndPt.Y=(i.EndPt.y-n.imgPar.imgy)/r)})}),n.infPar.eventFlag=b.Flag[0],this.init(n)}},draw:function(i){this.drawImage(i),this.drawCirLine(i)},drawImage:function(i){var a=b.data.imgSize[i.imgDir][0],e=b.data.imgSize[i.imgDir][1];setTimeout(function(){i.ctxImg.drawImage(i.imgPar.img,0,0,a,e,i.imgPar.imgx,i.imgPar.imgy,i.imgPar.imgw,i.imgPar.imgh)},b.setOutTime)},drawCirLine:function(i,a){if(i.infPar.drawFlag===b.Flag[0]){i.infPar.drawFlag=b.Flag[1];this.drawLines(i,a),this.drawCircles(i),i.infPar.drawFlag=b.Flag[0]}},drawCircles:function(n){if(n.ctxDraw.strokeStyle=b.staticCirCol,n.ctxDraw.fillStyle=b.staticCirCol,n.ctxDraw.globalAlpha=b.globalAlpha,n.clickEvePar.isDraggingCir===b.isDraggingCir[1])n.ctxDraw.fillStyle=b.moveCirCol,b.testNum.test(n.mSelPointPar.mSelectedCircleIndex)?(n.ctxDraw.beginPath(),n.ctxDraw.arc(n.outlinePar.circles[n.mSelPointPar.mSelectedCircleIndex].x,n.outlinePar.circles[n.mSelPointPar.mSelectedCircleIndex].y,n.outlinePar.radius,0,2*Math.PI),n.ctxDraw.fill()):angular.forEach(n.outlinePar.PaintLines,function(i){var a=n.mSelPointPar.mSelectedCircleIndex.split("-");a[0]===i.LineName&&(i.LineType!=b.LineType[0]?(n.ctxDraw.beginPath(),n.ctxDraw.arc(i.EndPt.x,i.EndPt.y,n.outlinePar.radius*b.enLargePLCirRadius,0,2*Math.PI),n.ctxDraw.fill()):"S"===a[1]?(n.ctxDraw.beginPath(),n.ctxDraw.arc(i.StartPt.x,i.StartPt.y,n.outlinePar.radius,0,2*Math.PI),n.ctxDraw.fill()):"E"===a[1]&&(n.ctxDraw.beginPath(),n.ctxDraw.arc(i.EndPt.x,i.EndPt.y,n.outlinePar.radius,0,2*Math.PI),n.ctxDraw.fill()))}),n.ctxDraw.fillStyle=b.staticCirCol;else if(b.data.isTutorial===b.isTutorial[1]){this.setMPIcon(n),n.ctxDraw.globalAlpha=b.globalAlpha,angular.forEach(n.outlinePar.PaintLines,function(t){t.LineType!=b.LineType[0]?angular.forEach(n.APIPar.PaintLines_iconArray,function(i){if(i.LineName.split("-")[0]===t.LineName){var a=n.outlinePar.radius*b.enLargePLCirRadius;i.icon===b.MPIcon[0]?n.ctxDraw.drawImage(b.defImg,0,0,b.defImg.width,b.defImg.height,t.EndPt.x-a,t.EndPt.y-a,2*a,2*a):n.ctxDraw.drawImage(b.targetImg,0,0,b.targetImg.width,b.targetImg.height,t.EndPt.x-a,t.EndPt.y-a,2*a,2*a)}}):t.LineType===b.LineType[0]&&angular.forEach(n.APIPar.PaintLines_iconArray,function(i){var a=i.LineName.split("-");if(a[0]===t.LineName){var e=n.outlinePar.radius;"S"===a[1]?i.icon===b.MPIcon[0]?n.ctxDraw.drawImage(b.defImg,0,0,b.defImg.width,b.defImg.height,t.StartPt.x-e,t.StartPt.y-e,2*e,2*e):n.ctxDraw.drawImage(b.targetImg,0,0,b.targetImg.width,b.targetImg.height,t.StartPt.x-e,t.StartPt.y-e,2*e,2*e):"E"===a[1]&&(i.icon===b.MPIcon[0]?n.ctxDraw.drawImage(b.defImg,0,0,b.defImg.width,b.defImg.height,t.EndPt.x-e,t.EndPt.y-e,2*e,2*e):n.ctxDraw.drawImage(b.targetImg,0,0,b.targetImg.width,b.targetImg.height,t.EndPt.x-e,t.EndPt.y-e,2*e,2*e))}})});for(var i=0;i<n.outlinePar.circles.length;i++){var a=n.outlinePar.circles[i];n.APIPar.iconArray[i]===b.MPIcon[0]?n.ctxDraw.drawImage(b.defImg,0,0,b.defImg.width,b.defImg.height,a.x-n.outlinePar.radius,a.y-n.outlinePar.radius,2*n.outlinePar.radius,2*n.outlinePar.radius):n.ctxDraw.drawImage(b.targetImg,0,0,b.targetImg.width,b.targetImg.height,a.x-n.outlinePar.radius,a.y-n.outlinePar.radius,2*n.outlinePar.radius,2*n.outlinePar.radius)}}else{angular.forEach(n.outlinePar.PaintLines,function(i){i.LineType!=b.LineType[0]?(n.ctxDraw.beginPath(),n.ctxDraw.arc(i.EndPt.x,i.EndPt.y,n.outlinePar.radius*b.enLargePLCirRadius,0,2*Math.PI),n.ctxDraw.fill()):i.LineType===b.LineType[0]&&(n.ctxDraw.beginPath(),n.ctxDraw.arc(i.StartPt.x,i.StartPt.y,n.outlinePar.radius,0,2*Math.PI),n.ctxDraw.fill(),n.ctxDraw.beginPath(),n.ctxDraw.arc(i.EndPt.x,i.EndPt.y,n.outlinePar.radius,0,2*Math.PI),n.ctxDraw.fill())});for(i=0;i<n.outlinePar.circles.length;i++){(a=n.outlinePar.circles[i]).sign===b.sign[0]?n.ctxDraw.fillStyle=b.staticCirCol:n.ctxDraw.fillStyle=b.cusCirCol,n.ctxDraw.beginPath(),n.ctxDraw.arc(a.x,a.y,n.outlinePar.radius,0,2*Math.PI),n.ctxDraw.fill()}}if(b.data.isTutorial===b.isTutorial[1]&&n.infPar.showPrompt===b.showPrompt[1]){var e=b.data.MP[n.imgDir][0],t=b.data.MP[n.imgDir][1],r=b.data.ptsTarget[n.imgDir],o=n.contPar.winScaling*n.zoomImg.imgScaling;n.ctxDraw.fillStyle=b.promptCol,angular.forEach(n.APIPar.PaintLines_target,function(i){i.LineType!=b.LineType[0]?(n.ctxDraw.beginPath(),i.LineType===b.LineType[1]?n.ctxDraw.arc(n.imgPar.imgx,i.EndPt.y*o+n.imgPar.imgy,n.outlinePar.radius*b.enLargePLCirRadius,0,2*Math.PI):i.LineType===b.LineType[2]&&n.ctxDraw.arc(n.imgPar.imgx+n.imgPar.imgw*n.zoomImg.imgScaling,i.EndPt.y*o+n.imgPar.imgy,n.outlinePar.radius*b.enLargePLCirRadius,0,2*Math.PI),n.ctxDraw.fill()):i.LineType===b.LineType[0]&&(n.ctxDraw.beginPath(),n.ctxDraw.arc(i.StartPt.x*o+n.imgPar.imgx,i.StartPt.y*o+n.imgPar.imgy,n.outlinePar.radius,0,2*Math.PI),n.ctxDraw.fill(),n.ctxDraw.beginPath(),n.ctxDraw.arc(i.EndPt.x*o+n.imgPar.imgx,i.EndPt.y*o+n.imgPar.imgy,n.outlinePar.radius,0,2*Math.PI),n.ctxDraw.fill())});for(i=0;i<e.length;i++){var s=e[i].index;n.ctxDraw.beginPath(),n.ctxDraw.arc(r[s][0]*o+n.imgPar.imgx,r[s][1]*o+n.imgPar.imgy,n.outlinePar.radius,0,2*Math.PI),n.ctxDraw.fill()}for(i=0;i<t.length;i++){s=t[i].index;n.ctxDraw.beginPath(),n.ctxDraw.arc(r[s][2]*o+n.imgPar.imgx,r[s][3]*o+n.imgPar.imgy,n.outlinePar.radius,0,2*Math.PI),n.ctxDraw.fill()}n.ctxDraw.fillStyle=b.staticCirCol}},drawLines:function(e,t){var n=this;if(e.ctxDraw.clearRect(0,0,e.canvasDraw.width,e.canvasDraw.height),e.ctxDraw.strokeStyle=b.perfCol,e.ctxDraw.lineWidth=e.outlinePar.lineWidth,e.ctxDraw.globalAlpha=1,b.data.isTutorial===b.isTutorial[0]||""==t||null==t||null==t)n.drawLine(b.LineType[1],e),n.drawLine(b.LineType[2],e);else if(0===t.dir)n.setRgb(t,e.APIPar.firstColorArray,e),n.drawLine(b.LineType[1],e),n.drawLine(b.LineType[2],e);else if(1===t.dir)n.setRgb(t,e.APIPar.secondColorArray,e),n.drawLine(b.LineType[1],e),n.drawLine(b.LineType[2],e);else{n.drawLine(b.LineType[1],e),n.drawLine(b.LineType[2],e);var r=t.index.split("-");angular.forEach(e.APIPar.PaintLines_target,function(i,a){i.LineName===r[0]&&n.setRgb(t,e.APIPar.PaintLines_target[a],e)})}e.ctxDraw.strokeStyle=b.perfCol,e.ctxDraw.lineCap=b.lineCap,angular.forEach(e.outlinePar.PaintLines,function(a){b.data.isTutorial===b.isTutorial[0]?(e.ctxDraw.beginPath(),e.ctxDraw.moveTo(a.StartPt.x,a.StartPt.y),e.ctxDraw.lineTo(a.EndPt.x,a.EndPt.y),e.ctxDraw.lineWidth=e.outlinePar.lineWidth,e.ctxDraw.stroke(),e.ctxDraw.closePath()):b.data.isTutorial===b.isTutorial[1]&&angular.forEach(e.APIPar.PaintLines_target,function(i){a.LineName===i.LineName&&""!=i.rgb&&(e.ctxDraw.strokeStyle=i.rgb,e.ctxDraw.beginPath(),e.ctxDraw.moveTo(a.StartPt.x,a.StartPt.y),e.ctxDraw.lineTo(a.EndPt.x,a.EndPt.y),e.ctxDraw.lineWidth=e.outlinePar.lineWidth,e.ctxDraw.stroke(),e.ctxDraw.closePath())})})},drawLine:function(i,a){var e=b.drawDirIndex[a.imgDir][i]===b.drawDir[0]?0:2,t=b.drawDirIndex[a.imgDir][i]===b.drawDir[0]?b.data.COLOR[a.imgDir][0]:b.data.COLOR[a.imgDir][1],n=b.data.pts[a.imgDir];if(a.ctxDraw.beginPath(),a.ctxDraw.moveTo(n[0][e]*a.contPar.winScaling,n[0][e+1]*a.contPar.winScaling),b.data.isTutorial===b.isTutorial[1]){if(i===b.LineType[1])var r=a.APIPar.firstColorArray;else if(i===b.LineType[2])r=a.APIPar.secondColorArray;for(var o=1;o<n.length;o++){for(var s=0;s<r.length;s++)(o===r[s].index||1===o&&r[s].index===o-1)&&(a.ctxDraw.stroke(),a.ctxDraw.strokeStyle=r[s].rgb,a.ctxDraw.beginPath(),a.ctxDraw.moveTo(n[o-1][e]*a.contPar.winScaling,n[o-1][e+1]*a.contPar.winScaling));a.ctxDraw.lineTo(n[o][e]*a.contPar.winScaling,n[o][e+1]*a.contPar.winScaling)}}else for(o=1;o<n.length;o++){for(s=0;s<t.length;s++)o===t[s][0]&&a.ctxDraw.strokeStyle!=b.warngCol||1===o&&t[s][0]===o-1?(a.ctxDraw.stroke(),a.ctxDraw.strokeStyle=b.warngCol,a.ctxDraw.beginPath(),a.ctxDraw.moveTo(n[o-1][e]*a.contPar.winScaling,n[o-1][e+1]*a.contPar.winScaling)):o===t[s][1]&&a.ctxDraw.strokeStyle!=b.perfCol&&(a.ctxDraw.stroke(),a.ctxDraw.strokeStyle=b.perfCol,a.ctxDraw.beginPath(),a.ctxDraw.moveTo(n[o-1][e]*a.contPar.winScaling,n[o-1][e+1]*a.contPar.winScaling));a.ctxDraw.lineTo(n[o][e]*a.contPar.winScaling,n[o][e+1]*a.contPar.winScaling)}a.ctxDraw.stroke()},canvasClick:function(i,e){var t=this,a=b.data.MP[e.imgDir][0].length,n="img"+e.imgDir;if($("body").trigger(n+"_Click2Suspension_out"),e.infPar.eventFlag===b.Flag[0]&&e.infPar.drawFlag===b.Flag[0]&&b.APIFlag==b.Flag[0]){e.infPar.eventFlag=b.Flag[1],e.clickEvePar.clickX=i.offsetX?i.offsetX:i.touches[0].pageX-e.drawCanvasJqueryId.offset().left,e.clickEvePar.clickY=i.offsetY?i.offsetY:i.touches[0].pageY-e.drawCanvasJqueryId.offset().top,e.dgImgPar.preOffsetx=e.clickEvePar.clickX,e.dgImgPar.preOffsety=e.clickEvePar.clickY,e.dgImgPar.preimgx=e.imgPar.imgx,e.dgImgPar.preimgy=e.imgPar.imgy,angular.forEach(e.outlinePar.PaintLines,function(i,a){if(i.LineType!=b.LineType[0]){if(Math.sqrt(Math.pow(i.EndPt.x-e.clickEvePar.clickX,2)+Math.pow(i.EndPt.y-e.clickEvePar.clickY,2))<e.outlinePar.radius*b.enLargePLCirRadius*b.mobileTouchRatio)return null!=e.clickEvePar.previousSelectedCircle&&(e.clickEvePar.previousSelectedCircle.isSelected=!1),e.clickEvePar.previousSelectedCircle=e.outlinePar.PaintLines[a].EndPt,e.outlinePar.PaintLines[a].isSelected=!0,e.mSelPointPar.mSelectedCircleIndex=e.outlinePar.PaintLines[a].LineName,$("body").trigger(n+"_Click2Suspension_in",[{dir:2,index:e.mSelPointPar.mSelectedCircleIndex,x:i.EndPt.x,y:i.EndPt.y}]),t.pushRetroversion(e),void(e.clickEvePar.isDraggingCir=b.isDraggingCir[1])}else{if(Math.sqrt(Math.pow(i.StartPt.x-e.clickEvePar.clickX,2)+Math.pow(i.StartPt.y-e.clickEvePar.clickY,2))<e.outlinePar.radius*b.mobileTouchRatio)return null!=e.clickEvePar.previousSelectedCircle&&(e.clickEvePar.previousSelectedCircle.isSelected=!1),e.clickEvePar.previousSelectedCircle=e.outlinePar.PaintLines[a].StartPt,e.outlinePar.PaintLines[a].isSelected=!0,e.mSelPointPar.mSelectedCircleIndex=e.outlinePar.PaintLines[a].LineName+"-S",$("body").trigger(n+"_Click2Suspension_in",[{dir:2,index:e.mSelPointPar.mSelectedCircleIndex,x:i.StartPt.x,y:i.StartPt.y}]),t.pushRetroversion(e),void(e.clickEvePar.isDraggingCir=b.isDraggingCir[1]);if(Math.sqrt(Math.pow(i.EndPt.x-e.clickEvePar.clickX,2)+Math.pow(i.EndPt.y-e.clickEvePar.clickY,2))<e.outlinePar.radius*b.mobileTouchRatio)return null!=e.clickEvePar.previousSelectedCircle&&(e.clickEvePar.previousSelectedCircle.isSelected=!1),e.clickEvePar.previousSelectedCircle=e.outlinePar.PaintLines[a].EndPt,e.outlinePar.PaintLines[a].isSelected=!0,e.mSelPointPar.mSelectedCircleIndex=e.outlinePar.PaintLines[a].LineName+"-E",$("body").trigger(n+"_Click2Suspension_in",[{dir:2,index:e.mSelPointPar.mSelectedCircleIndex,x:i.EndPt.x,y:i.EndPt.y}]),t.pushRetroversion(e),void(e.clickEvePar.isDraggingCir=b.isDraggingCir[1])}});for(var r=0;r<e.outlinePar.circles.length;r++){var o=e.outlinePar.circles[r];if(Math.sqrt(Math.pow(o.x-e.clickEvePar.clickX,2)+Math.pow(o.y-e.clickEvePar.clickY,2))<=e.outlinePar.radius*b.mobileTouchRatio){null!=e.clickEvePar.previousSelectedCircle&&(e.clickEvePar.previousSelectedCircle.isSelected=!1),(e.clickEvePar.previousSelectedCircle=o).isSelected=!0;var s=0;if((e.mSelPointPar.mSelectedCircleIndex=r)<a){for(var g=0;g<r;g++)e.outlinePar.circles[g].sign===b.sign[1]&&s++;$("body").trigger(n+"_Click2Suspension_in",[{dir:0,index:e.mSelPointPar.mSelectedCircleIndex-s,x:o.x,y:o.y}])}else{for(g=a;g<r;g++)e.outlinePar.circles[g].sign===b.sign[1]&&s++;$("body").trigger(n+"_Click2Suspension_in",[{dir:1,index:e.mSelPointPar.mSelectedCircleIndex-a-s,x:o.x,y:o.y}])}return t.pushRetroversion(e),void(e.clickEvePar.isDraggingCir=b.isDraggingCir[1])}}e.dgImgPar.draggingCanvas=b.draggingCanvas[1]}},dragging:function(i,e){var t=this,a=b.data.pts[e.imgDir],n=b.data.imgSize[e.imgDir][0],r=b.data.imgSize[e.imgDir][1],o=b.data.MP[e.imgDir][0],s=b.data.MP[e.imgDir][1];if(t.judgeOnPoint(i,e),e.clickEvePar.isDraggingCir===b.isDraggingCir[1]){if(null!=e.clickEvePar.previousSelectedCircle){var g=i.offsetX?i.offsetX:i.touches[0].pageX-e.drawCanvasJqueryId.offset().left,c=i.offsetY?i.offsetY:i.touches[0].pageY-e.drawCanvasJqueryId.offset().top,l=e.mSelPointPar.mSelectedCircleIndex;if(b.testNum.test(l)){var m=g-e.outlinePar.originalCircles[l].x,d=c-e.outlinePar.originalCircles[l].y;if(Math.pow(m,2)+Math.pow(d,2)<Math.pow(e.outlinePar.distanceBound,2)){var P=g-e.outlinePar.circles[l].x,u=c-e.outlinePar.circles[l].y;e.clickEvePar.previousSelectedCircle.x=g,e.clickEvePar.previousSelectedCircle.y=c,e.outlinePar.circles[l]=e.clickEvePar.previousSelectedCircle,t.mSelectedPoint(P,u,l,e)}else{var f=e.outlinePar.circles[l].x,p=e.outlinePar.circles[l].y,h=Math.sqrt(Math.pow(m,2)+Math.pow(d,2));e.clickEvePar.previousSelectedCircle.x=e.outlinePar.originalCircles[l].x+m/h*e.outlinePar.distanceBound,e.clickEvePar.previousSelectedCircle.y=e.outlinePar.originalCircles[l].y+d/h*e.outlinePar.distanceBound;P=e.clickEvePar.previousSelectedCircle.x-f,u=e.clickEvePar.previousSelectedCircle.y-p;e.outlinePar.circles[l]=e.clickEvePar.previousSelectedCircle,t.mSelectedPoint(P,u,l,e)}if(l<o.length)o[l].index>=b.minMPDownIndex&&o[l].index<=b.maxMPUpIndex&&angular.forEach(e.outlinePar.PaintLines,function(i,a){b.drawDirIndex[e.imgDir][i.LineType]===b.drawDir[0]&&(e.outlinePar.PaintLines[a].StartPt.x=t.findPointOnOutline(e.outlinePar.PaintLines[a].StartPt.y,b.drawDirIndex[e.imgDir][i.LineType],e))});else{var w=l-o.length;s[w].index>=b.minMPDownIndex&&s[w].index<=b.maxMPUpIndex&&angular.forEach(e.outlinePar.PaintLines,function(i,a){b.drawDirIndex[e.imgDir][i.LineType]===b.drawDir[1]&&(e.outlinePar.PaintLines[a].StartPt.x=t.findPointOnOutline(e.outlinePar.PaintLines[a].StartPt.y,b.drawDirIndex[e.imgDir][i.LineType],e))})}}else for(var v=0;v<e.outlinePar.PaintLines.length;v++){var S=e.outlinePar.PaintLines[v],x=l.split("-");if(S.LineName===x[0])if(S.LineType!=b.LineType[0]){var y=b.drawDirIndex[e.imgDir][S.LineType]===b.drawDir[0]?0:2;c>=a[b.minDownIndex][y+1]*e.contPar.winScaling?(S.EndPt.y=a[b.minDownIndex][y+1]*e.contPar.winScaling,S.StartPt.y=S.EndPt.y,S.StartPt.x=a[b.minDownIndex][y]*e.contPar.winScaling):c<=a[b.maxUpIndex][y+1]*e.contPar.winScaling?(S.EndPt.y=a[b.maxUpIndex][y+1]*e.contPar.winScaling,S.StartPt.y=S.EndPt.y,S.StartPt.x=a[b.maxUpIndex][y]*e.contPar.winScaling):(S.EndPt.y=c,S.StartPt.y=c,S.StartPt.x=t.findPointOnOutline(c,b.drawDirIndex[e.imgDir][S.LineType],e))}else S.LineType===b.LineType[0]&&("S"===x[1]?(e.clickEvePar.previousSelectedCircle.x=g,e.clickEvePar.previousSelectedCircle.y=c,e.outlinePar.PaintLines[v].StartPt.x=g,e.outlinePar.PaintLines[v].StartPt.y=c):"E"===x[1]&&(e.clickEvePar.previousSelectedCircle.x=g,e.clickEvePar.previousSelectedCircle.y=c,e.outlinePar.PaintLines[v].EndPt.x=g,e.outlinePar.PaintLines[v].EndPt.y=c))}t.drawCirLine(e)}}else if(e.dgImgPar.draggingCanvas===b.draggingCanvas[1]&&e.zoomImg.imgScaling!=e.zoomImg.MIN_SCALE){e.ctxDraw.clearRect(0,0,e.canvasDraw.width,e.canvasDraw.height),e.ctxImg.clearRect(0,0,e.canvasImg.width,e.canvasImg.height);g=i.offsetX?i.offsetX:i.touches[0].pageX-e.drawCanvasJqueryId.offset().left,c=i.offsetY?i.offsetY:i.touches[0].pageY-e.drawCanvasJqueryId.offset().top;var I=g-e.dgImgPar.preOffsetx,D=c-e.dgImgPar.preOffsety;e.dgImgPar.draggingCanvasScale=e.zoomImg.imgScaling,e.imgPar.imgx+=I,e.imgPar.imgy+=D,e.imgPar.imgx>=.5*e.canvasImg.width-e.imgPar.imgw*e.zoomImg.imgScaling&&Math.abs(e.imgPar.imgy)<=e.canvasImg.height*(e.zoomImg.imgScaling-1)&&e.imgPar.imgx<=.5*e.canvasImg.width&&e.imgPar.imgy<=0?(e.ctxImg.drawImage(e.imgPar.img,0,0,n,r,e.imgPar.imgx,e.imgPar.imgy,e.imgPar.imgw*e.zoomImg.imgScaling,e.imgPar.imgh*e.zoomImg.imgScaling),e.dgImgPar.preOffsetx=g,e.dgImgPar.preOffsety=c,e.dgImgPar.zoomCauseDrag===b.zoomCauseDrag[1]&&(e.dgImgPar.zoomCauseDrag=b.zoomCauseDrag[0])):e.dgImgPar.zoomCauseDrag===b.zoomCauseDrag[1]&&Math.abs(e.imgPar.imgy)<=e.canvasImg.height*(e.zoomImg.imgScaling-1)&&e.imgPar.imgy<=0?(e.ctxImg.drawImage(e.imgPar.img,0,0,n,r,e.imgPar.imgx,e.imgPar.imgy,e.imgPar.imgw*e.zoomImg.imgScaling,e.imgPar.imgh*e.zoomImg.imgScaling),e.dgImgPar.preOffsetx=g,e.dgImgPar.preOffsety=c):(e.imgPar.imgx-=I,e.imgPar.imgy-=D,e.ctxImg.drawImage(e.imgPar.img,0,0,n,r,e.imgPar.imgx,e.imgPar.imgy,e.imgPar.imgw*e.zoomImg.imgScaling,e.imgPar.imgh*e.zoomImg.imgScaling))}},stopDragging:function(i,e){var a=b.data.pts[e.imgDir],t="img"+e.imgDir,n=b.data.MP[e.imgDir][0].length;if(e.dgImgPar.draggingCanvas===b.draggingCanvas[1]){for(var r=e.imgPar.imgx-e.dgImgPar.preimgx,o=e.imgPar.imgy-e.dgImgPar.preimgy,s=0;s<e.outlinePar.circles.length;s++)e.outlinePar.circles[s].x+=r,e.outlinePar.circles[s].y+=o,e.outlinePar.originalCircles[s].x+=r,e.outlinePar.originalCircles[s].y+=o;for(s=0;s<a.length;s++)a[s][0]+=r/e.contPar.winScaling,a[s][1]+=o/e.contPar.winScaling,a[s][2]+=r/e.contPar.winScaling,a[s][3]+=o/e.contPar.winScaling;angular.forEach(e.outlinePar.PaintLines,function(i,a){e.outlinePar.PaintLines[a].StartPt.x+=r,e.outlinePar.PaintLines[a].StartPt.y+=o,e.outlinePar.PaintLines[a].EndPt.x+=r,e.outlinePar.PaintLines[a].EndPt.y+=o}),e.dgImgPar.draggingCanvas=b.draggingCanvas[0],this.drawCirLine(e),e.infPar.eventFlag=b.Flag[0]}if(e.clickEvePar.isDraggingCir===b.isDraggingCir[1]){var g;if(0!=e.retrPar.retrArray.length)if(i.offsetX===e.clickEvePar.clickX&&i.offsetY===e.clickEvePar.clickY)e.retrPar.retrArray.pop();else{var c=this.uploadRetrPoint(e.retrPar.retrArray.pop(),e);e.retrPar.retrArray.push(c);var l=b.testNum,m=e.mSelPointPar.mSelectedCircleIndex;if(l.test(m)){var d=e.contPar.winScaling*e.zoomImg.imgScaling,P=(e.outlinePar.circles[m].x-e.imgPar.imgx)/d,u=(e.outlinePar.circles[m].y-e.imgPar.imgy)/d;g=m<n?{dir:0,index:m,x:P,y:u}:{dir:1,index:m-n,x:P,y:u},$("body").trigger(t+"_Mouseup2ChgColor",[g])}else{var f=m.split("-");angular.forEach(e.outlinePar.PaintLines,function(i){f[0]===i.LineName&&(g={dir:2,index:m,x:(i.EndPt.x-e.imgPar.imgx)/(e.contPar.winScaling*e.zoomImg.imgScaling),y:(i.EndPt.y-e.imgPar.imgy)/(e.contPar.winScaling*e.zoomImg.imgScaling)},$("body").trigger(t+"_Mouseup2ChgColor",[g]))})}}e.clickEvePar.isDraggingCir=b.isDraggingCir[0],b.data.isTutorial===b.isTutorial[1]?this.drawCirLine(e,g):this.drawCirLine(e),e.infPar.eventFlag=b.Flag[0]}},scaleImg:function(i,e){if(e.infPar.eventFlag===b.Flag[0]&&e.infPar.drawFlag===b.Flag[0]&&b.APIFlag==b.Flag[0]){e.infPar.eventFlag=b.Flag[1];var a=b.data.pts[e.imgDir],t=b.data.imgSize[e.imgDir][0],n=b.data.imgSize[e.imgDir][1];1===e.zoomImg.imgScaling&&(e.zoomImg.offsetX=i.offsetX,e.zoomImg.offsetY=i.offsetY,e.dgImgPar.draggingCanvasScale=1);var r=0;if(i||(i=window.event),i.wheelDelta?(r=i.wheelDelta/120,window.opera&&(r=-r)):i.detail&&(r=-i.detail/3),e.zoomImg.zoom=Math.exp(r*e.zoomImg.zoomIntensity),e.zoomImg.imgScaling*e.zoomImg.zoom<e.zoomImg.MIN_SCALE&&0!=e.imgPar.imgy){if(e.zoomImg.zoom=1/e.zoomImg.imgScaling,e.outlinePar.distanceBound*=e.zoomImg.zoom,e.ctxImg.clearRect(0,0,e.canvasDraw.width,e.canvasDraw.height),e.zoomImg.zoom<=1){e.zoomImg.bfScalingimgx=e.imgPar.imgx,e.zoomImg.bfScalingimgy=e.imgPar.imgy,e.imgPar.imgx=(e.contPar.width-e.imgPar.imgw)/2;for(var o=e.imgPar.imgy=0;o<e.outlinePar.circles.length;o++)e.outlinePar.circles[o].x=e.imgPar.imgx+(e.outlinePar.circles[o].x-e.zoomImg.bfScalingimgx)*e.zoomImg.zoom,e.outlinePar.circles[o].y=e.imgPar.imgy+(e.outlinePar.circles[o].y-e.zoomImg.bfScalingimgy)*e.zoomImg.zoom,e.outlinePar.originalCircles[o].x=e.imgPar.imgx+(e.outlinePar.originalCircles[o].x-e.zoomImg.bfScalingimgx)*e.zoomImg.zoom,e.outlinePar.originalCircles[o].y=e.imgPar.imgy+(e.outlinePar.originalCircles[o].y-e.zoomImg.bfScalingimgy)*e.zoomImg.zoom;for(o=0;o<a.length;o++)a[o][0]=(e.imgPar.imgx+(a[o][0]*e.contPar.winScaling-e.zoomImg.bfScalingimgx)*e.zoomImg.zoom)/e.contPar.winScaling,a[o][1]=(e.imgPar.imgy+(a[o][1]*e.contPar.winScaling-e.zoomImg.bfScalingimgy)*e.zoomImg.zoom)/e.contPar.winScaling,a[o][2]=(e.imgPar.imgx+(a[o][2]*e.contPar.winScaling-e.zoomImg.bfScalingimgx)*e.zoomImg.zoom)/e.contPar.winScaling,a[o][3]=(e.imgPar.imgy+(a[o][3]*e.contPar.winScaling-e.zoomImg.bfScalingimgy)*e.zoomImg.zoom)/e.contPar.winScaling;angular.forEach(e.outlinePar.PaintLines,function(i,a){e.outlinePar.PaintLines[a].StartPt.x=e.imgPar.imgx+(e.outlinePar.PaintLines[a].StartPt.x-e.zoomImg.bfScalingimgx)*e.zoomImg.zoom,e.outlinePar.PaintLines[a].StartPt.y=e.imgPar.imgy+(e.outlinePar.PaintLines[a].StartPt.y-e.zoomImg.bfScalingimgy)*e.zoomImg.zoom,e.outlinePar.PaintLines[a].EndPt.x=e.imgPar.imgx+(e.outlinePar.PaintLines[a].EndPt.x-e.zoomImg.bfScalingimgx)*e.zoomImg.zoom,e.outlinePar.PaintLines[a].EndPt.y=e.imgPar.imgy+(e.outlinePar.PaintLines[a].EndPt.y-e.zoomImg.bfScalingimgy)*e.zoomImg.zoom})}e.ctxImg.drawImage(e.imgPar.img,0,0,t,n,e.imgPar.imgx,e.imgPar.imgy,e.imgPar.imgw,e.imgPar.imgh),e.zoomImg.imgScaling=e.zoomImg.MIN_SCALE,this.drawCirLine(e)}else if(e.zoomImg.imgScaling*e.zoomImg.zoom>=e.zoomImg.MIN_SCALE&&e.zoomImg.imgScaling*e.zoomImg.zoom<=e.zoomImg.MAX_SCALE){if(e.outlinePar.distanceBound*=e.zoomImg.zoom,e.ctxImg.clearRect(0,0,e.canvasDraw.width,e.canvasDraw.height),e.zoomImg.zoom<1){var s=(e.zoomImg.imgScaling-e.zoomImg.imgScaling*e.zoomImg.zoom)/(e.zoomImg.imgScaling-1);e.zoomImg.bfScalingimgx=e.imgPar.imgx,e.zoomImg.bfScalingimgy=e.imgPar.imgy,e.imgPar.imgx+=((e.canvasDraw.width-e.imgPar.imgw)/2-e.imgPar.imgx)*s,e.imgPar.imgy+=-e.imgPar.imgy*s;for(o=0;o<e.outlinePar.circles.length;o++)e.outlinePar.circles[o].x=e.imgPar.imgx+(e.outlinePar.circles[o].x-e.zoomImg.bfScalingimgx)*e.zoomImg.zoom,e.outlinePar.circles[o].y=e.imgPar.imgy+(e.outlinePar.circles[o].y-e.zoomImg.bfScalingimgy)*e.zoomImg.zoom,e.outlinePar.originalCircles[o].x=e.imgPar.imgx+(e.outlinePar.originalCircles[o].x-e.zoomImg.bfScalingimgx)*e.zoomImg.zoom,e.outlinePar.originalCircles[o].y=e.imgPar.imgy+(e.outlinePar.originalCircles[o].y-e.zoomImg.bfScalingimgy)*e.zoomImg.zoom;for(o=0;o<a.length;o++)a[o][0]=(e.imgPar.imgx+(a[o][0]*e.contPar.winScaling-e.zoomImg.bfScalingimgx)*e.zoomImg.zoom)/e.contPar.winScaling,a[o][1]=(e.imgPar.imgy+(a[o][1]*e.contPar.winScaling-e.zoomImg.bfScalingimgy)*e.zoomImg.zoom)/e.contPar.winScaling,a[o][2]=(e.imgPar.imgx+(a[o][2]*e.contPar.winScaling-e.zoomImg.bfScalingimgx)*e.zoomImg.zoom)/e.contPar.winScaling,a[o][3]=(e.imgPar.imgy+(a[o][3]*e.contPar.winScaling-e.zoomImg.bfScalingimgy)*e.zoomImg.zoom)/e.contPar.winScaling;angular.forEach(e.outlinePar.PaintLines,function(i,a){e.outlinePar.PaintLines[a].StartPt.x=e.imgPar.imgx+(e.outlinePar.PaintLines[a].StartPt.x-e.zoomImg.bfScalingimgx)*e.zoomImg.zoom,e.outlinePar.PaintLines[a].StartPt.y=e.imgPar.imgy+(e.outlinePar.PaintLines[a].StartPt.y-e.zoomImg.bfScalingimgy)*e.zoomImg.zoom,e.outlinePar.PaintLines[a].EndPt.x=e.imgPar.imgx+(e.outlinePar.PaintLines[a].EndPt.x-e.zoomImg.bfScalingimgx)*e.zoomImg.zoom,e.outlinePar.PaintLines[a].EndPt.y=e.imgPar.imgy+(e.outlinePar.PaintLines[a].EndPt.y-e.zoomImg.bfScalingimgy)*e.zoomImg.zoom})}else{e.imgPar.imgx-=(e.zoomImg.offsetX-e.imgPar.imgx)*(e.zoomImg.zoom-1),e.imgPar.imgy-=(e.zoomImg.offsetY-e.imgPar.imgy)*(e.zoomImg.zoom-1);for(o=0;o<e.outlinePar.circles.length;o++)e.outlinePar.circles[o].x-=(e.zoomImg.offsetX-e.outlinePar.circles[o].x)*(e.zoomImg.zoom-1),e.outlinePar.circles[o].y-=(e.zoomImg.offsetY-e.outlinePar.circles[o].y)*(e.zoomImg.zoom-1),e.outlinePar.originalCircles[o].x-=(e.zoomImg.offsetX-e.outlinePar.originalCircles[o].x)*(e.zoomImg.zoom-1),e.outlinePar.originalCircles[o].y-=(e.zoomImg.offsetY-e.outlinePar.originalCircles[o].y)*(e.zoomImg.zoom-1);for(o=0;o<a.length;o++)a[o][0]-=(e.zoomImg.offsetX-a[o][0]*e.contPar.winScaling)*(e.zoomImg.zoom-1)/e.contPar.winScaling,a[o][1]-=(e.zoomImg.offsetY-a[o][1]*e.contPar.winScaling)*(e.zoomImg.zoom-1)/e.contPar.winScaling,a[o][2]-=(e.zoomImg.offsetX-a[o][2]*e.contPar.winScaling)*(e.zoomImg.zoom-1)/e.contPar.winScaling,a[o][3]-=(e.zoomImg.offsetY-a[o][3]*e.contPar.winScaling)*(e.zoomImg.zoom-1)/e.contPar.winScaling;angular.forEach(e.outlinePar.PaintLines,function(i,a){e.outlinePar.PaintLines[a].StartPt.x-=(e.zoomImg.offsetX-e.outlinePar.PaintLines[a].StartPt.x)*(e.zoomImg.zoom-1),e.outlinePar.PaintLines[a].StartPt.y-=(e.zoomImg.offsetY-e.outlinePar.PaintLines[a].StartPt.y)*(e.zoomImg.zoom-1),e.outlinePar.PaintLines[a].EndPt.x-=(e.zoomImg.offsetX-e.outlinePar.PaintLines[a].EndPt.x)*(e.zoomImg.zoom-1),e.outlinePar.PaintLines[a].EndPt.y-=(e.zoomImg.offsetY-e.outlinePar.PaintLines[a].EndPt.y)*(e.zoomImg.zoom-1)}),e.imgPar.imgx>=.5*e.canvasImg.width-e.imgPar.imgw*e.zoomImg.imgScaling&&e.imgPar.imgx<=.5*e.canvasImg.width||(e.dgImgPar.zoomCauseDrag=b.zoomCauseDrag[1])}e.ctxImg.drawImage(e.imgPar.img,0,0,t,n,e.imgPar.imgx,e.imgPar.imgy,e.imgPar.imgw*e.zoomImg.imgScaling*e.zoomImg.zoom,e.imgPar.imgh*e.zoomImg.imgScaling*e.zoomImg.zoom),e.zoomImg.imgScaling*=e.zoomImg.zoom,this.drawCirLine(e)}e.infPar.eventFlag=b.Flag[0]}},addDelMP:function(i,a){if(a.infPar.eventFlag===b.Flag[0]&&a.infPar.drawFlag===b.Flag[0]&&b.APIFlag==b.Flag[0]){a.infPar.eventFlag=b.Flag[1];var e=this,t=b.data.MP[a.imgDir][0],n=b.data.MP[a.imgDir][1],r=b.data.pts[a.imgDir],o=b.originalData.pts[a.imgDir];if(e.judgeOnPoint(i,a),a.addDelMPPar.hoverPointSign===b.sign[1]){e.pushRetroversion(a);var s=e.uploadRetrPoint(a.retrPar.retrArray.pop(),a);return a.retrPar.retrArray.push(s),a.outlinePar.circles.splice(a.addDelMPPar.delCirIndex,1),a.outlinePar.originalCircles.splice(a.addDelMPPar.delCirIndex,1),a.addDelMPPar.delCirIndex<t.length?t.splice(a.addDelMPPar.delCirIndex,1):n.splice(a.addDelMPPar.delCirIndex-t.length,1),e.drawCirLine(a),void(a.infPar.eventFlag=b.Flag[0])}if(a.APIPar.hoverOnPoint===b.hoverOnPoint[0]){var g=i.offsetX?i.offsetX:i.touches[0].pageX-a.drawCanvasJqueryId.offset().left,c=i.offsetY?i.offsetY:i.touches[0].pageY-a.drawCanvasJqueryId.offset().top,l=e.findClosestPoint(a,g,c);if(Math.pow(l.dVx,2)+Math.pow(l.dVy,2)<=Math.pow(a.outlinePar.radius,2)){e.pushRetroversion(a);s=e.uploadRetrPoint(a.retrPar.retrArray.pop(),a);a.retrPar.retrArray.push(s),l.drawDir===b.drawDir[0]?(t.push({index:l.index,sign:b.sign[1]}),t.sort(e.compare)):l.drawDir===b.drawDir[1]&&(n.push({index:l.index,sign:b.sign[1]}),n.sort(e.compare)),a.outlinePar.circles=new Array,a.outlinePar.originalCircles=new Array;for(var m=0;m<t.length;m++){var d=t[m].index,P=e.createcircle(r[d][0]*a.contPar.winScaling,r[d][1]*a.contPar.winScaling,t[m].sign),u=e.createcircle(o[d][0]*a.contPar.winScaling*a.zoomImg.imgScaling+a.imgPar.imgx,o[d][1]*a.contPar.winScaling*a.zoomImg.imgScaling+a.imgPar.imgy,t[m].sign);a.outlinePar.circles.push(P),a.outlinePar.originalCircles.push(u)}for(m=0;m<n.length;m++){d=n[m].index,P=e.createcircle(r[d][2]*a.contPar.winScaling,r[d][3]*a.contPar.winScaling,n[m].sign),u=e.createcircle(o[d][2]*a.contPar.winScaling*a.zoomImg.imgScaling+a.imgPar.imgx,o[d][3]*a.contPar.winScaling*a.zoomImg.imgScaling+a.imgPar.imgy,n[m].sign);a.outlinePar.circles.push(P),a.outlinePar.originalCircles.push(u)}e.drawCirLine(a)}}a.infPar.eventFlag=b.Flag[0]}},pushRetroversion:function(i){if(i.clickEvePar.isDraggingCir===b.isDraggingCir[0]){var a=this.keepRetrPoint(i,this);i.retrPar.retrArray.length!=i.retrPar.MaxRetrNum?i.retrPar.retrArray.push(a):(i.retrPar.retrArray.shift(),i.retrPar.retrArray.push(a),i.retrPar.overMaxRetrNum=b.overMaxRetrNum[1])}},keepRetrPoint:function(i){var a=this,e=a.cloneObj(b.data.MP[i.imgDir][0]),t=a.cloneObj(b.data.MP[i.imgDir][1]);return{pts:a.cloneObj(b.data.pts[i.imgDir]),firMP:e,secMP:t,circles:a.cloneObj(i.outlinePar.circles),originalCircles:a.cloneObj(i.outlinePar.originalCircles),PaintLines:a.cloneObj(i.outlinePar.PaintLines),firstColorArray:a.cloneObj(i.APIPar.firstColorArray),secondColorArray:a.cloneObj(i.APIPar.secondColorArray),PaintLines_target:a.cloneObj(i.APIPar.PaintLines_target)}},uploadRetrPoint:function(i,a){b.adjustImgStatus[a.imgDir]=!0;var e=this;$(a.retrPar.retrButton).removeAttr("disabled");for(var t=a.contPar.winScaling*a.zoomImg.imgScaling,n=e.cloneObj(i.firMP),r=e.cloneObj(i.secMP),o=e.cloneObj(i.circles),s=0;s<o.length;s++)o[s].x=(o[s].x-a.imgPar.imgx)/t,o[s].y=(o[s].y-a.imgPar.imgy)/t;var g=e.cloneObj(i.originalCircles);for(s=0;s<o.length;s++)g[s].x=(g[s].x-a.imgPar.imgx)/t,g[s].y=(g[s].y-a.imgPar.imgy)/t;var c=new Array;for(s=0;s<i.pts.length;s++)c[s]=new Array(4),c[s][0]=(i.pts[s][0]*a.contPar.winScaling-a.imgPar.imgx)/t,c[s][1]=(i.pts[s][1]*a.contPar.winScaling-a.imgPar.imgy)/t,c[s][2]=(i.pts[s][2]*a.contPar.winScaling-a.imgPar.imgx)/t,c[s][3]=(i.pts[s][3]*a.contPar.winScaling-a.imgPar.imgy)/t;var l=e.cloneObj(i.PaintLines);for(s=0;s<l.length;s++)l[s].StartPt.x=(l[s].StartPt.x-a.imgPar.imgx)/t,l[s].StartPt.y=(l[s].StartPt.y-a.imgPar.imgy)/t,l[s].EndPt.x=(l[s].EndPt.x-a.imgPar.imgx)/t,l[s].EndPt.y=(l[s].EndPt.y-a.imgPar.imgy)/t;return{firMP:n,secMP:r,circles:o,originalCircles:g,pts:c,PaintLines:l,firstColorArray:e.cloneObj(i.firstColorArray),secondColorArray:e.cloneObj(i.secondColorArray),PaintLines_target:e.cloneObj(i.PaintLines_target)}},doRetroversion:function(i){var a=this;if(0!==i.retrPar.retrArray.length){var e=b.data.pts[i.imgDir];if(i.infPar.eventFlag===b.Flag[0]&&i.infPar.drawFlag===b.Flag[0]&&b.APIFlag==b.Flag[0]){i.infPar.eventFlag=b.Flag[1];var t=i.retrPar.retrArray.pop(),n=i.contPar.winScaling*i.zoomImg.imgScaling;b.data.MP[i.imgDir][0]=a.cloneObj(t.firMP),b.data.MP[i.imgDir][1]=a.cloneObj(t.secMP),i.outlinePar.circles=a.cloneObj(t.circles);for(var r=0;r<i.outlinePar.circles.length;r++)i.outlinePar.circles[r].x=i.outlinePar.circles[r].x*n+i.imgPar.imgx,i.outlinePar.circles[r].y=i.outlinePar.circles[r].y*n+i.imgPar.imgy;i.outlinePar.originalCircles=a.cloneObj(t.originalCircles);for(r=0;r<i.outlinePar.circles.length;r++)i.outlinePar.originalCircles[r].x=i.outlinePar.originalCircles[r].x*n+i.imgPar.imgx,i.outlinePar.originalCircles[r].y=i.outlinePar.originalCircles[r].y*n+i.imgPar.imgy;for(r=0;r<e.length;r++)e[r][0]=t.pts[r][0]*i.zoomImg.imgScaling+i.imgPar.imgx/i.contPar.winScaling,e[r][1]=t.pts[r][1]*i.zoomImg.imgScaling+i.imgPar.imgy/i.contPar.winScaling,e[r][2]=t.pts[r][2]*i.zoomImg.imgScaling+i.imgPar.imgx/i.contPar.winScaling,e[r][3]=t.pts[r][3]*i.zoomImg.imgScaling+i.imgPar.imgy/i.contPar.winScaling;i.outlinePar.PaintLines=a.cloneObj(t.PaintLines);for(r=0;r<i.outlinePar.PaintLines.length;r++)i.outlinePar.PaintLines[r].StartPt.x=i.outlinePar.PaintLines[r].StartPt.x*n+i.imgPar.imgx,i.outlinePar.PaintLines[r].StartPt.y=i.outlinePar.PaintLines[r].StartPt.y*n+i.imgPar.imgy,i.outlinePar.PaintLines[r].EndPt.x=i.outlinePar.PaintLines[r].EndPt.x*n+i.imgPar.imgx,i.outlinePar.PaintLines[r].EndPt.y=i.outlinePar.PaintLines[r].EndPt.y*n+i.imgPar.imgy;i.APIPar.firstColorArray=a.cloneObj(t.firstColorArray),i.APIPar.secondColorArray=a.cloneObj(t.secondColorArray),i.APIPar.PaintLines_target=a.cloneObj(t.PaintLines_target),0===i.retrPar.retrArray.length&&(i.retrPar.overMaxRetrNum===b.overMaxRetrNum[0]?b.adjustImgStatus[i.imgDir]=!1:b.adjustImgStatus[i.imgDir]=!0,$(i.retrPar.retrButton).attr("disabled","true")),i.infPar.eventFlag=b.Flag[0]}a.drawCirLine(i)}},createcircle:function(i,a,e){return{x:i,y:a,isSelected:!1,sign:e}},mSelectedPoint:function(i,a,e,t){var n,r,o,s,g=b.data.pts[t.imgDir],c=b.data.MP[t.imgDir][0],l=b.data.MP[t.imgDir][1];if(e<c.length)r=(n=0)<e?c[e-1].index:0,o=e<c.length-1?c[e+1].index:g.length,s=c[e].index;else{n=2;var m=e-c.length;r=0<m?l[m-1].index:0,o=m<l.length-1?l[m+1].index:g.length,s=l[m].index}for(var d=parseInt(r);d<parseInt(o);d++)if(d<s){var P=i/((s-r)/2)*((s-r)/2-(s-d)/2)/t.contPar.winScaling,u=a/((s-r)/2)*((s-r)/2-(s-d)/2)/t.contPar.winScaling;g[d][n]=parseFloat(g[d][n])+parseFloat(P),g[d][n+1]=parseFloat(g[d][n+1])+parseFloat(u)}else if(d===s)g[d][n]=parseFloat(g[d][n])+parseFloat(i)/t.contPar.winScaling,g[d][n+1]=parseFloat(g[d][n+1])+parseFloat(a)/t.contPar.winScaling;else{P=i/((o-s)/2)*((o-s)/2-(d-s)/2)/t.contPar.winScaling,u=a/((o-s)/2)*((o-s)/2-(d-s)/2)/t.contPar.winScaling;g[d][n]=parseFloat(g[d][n])+parseFloat(P),g[d][n+1]=parseFloat(g[d][n+1])+parseFloat(u)}},judgeOnPoint:function(i,a){for(var e="img"+a.imgDir,t=b.data.MP[a.imgDir][0].length,n=!1,r=!1,o=i.offsetX?i.offsetX:i.touches[0].pageX-a.drawCanvasJqueryId.offset().left,s=i.offsetY?i.offsetY:i.touches[0].pageY-a.drawCanvasJqueryId.offset().top,g=0;g<a.outlinePar.PaintLines.length;g++){var c=a.outlinePar.PaintLines[g];if(c.LineType!=b.LineType[0]){if(Math.sqrt(Math.pow(c.EndPt.x-o,2)+Math.pow(c.EndPt.y-s,2))<a.outlinePar.radius*b.enLargePLCirRadius&&(n=!0,a.APIPar.hoverOnPoint===b.hoverOnPoint[0]))return a.APIPar.hoverOnPoint=b.hoverOnPoint[1],a.addDelMPPar.hoverPointSign=b.sign[0],void $("body").trigger(e+"_Hover2Suspension_in",[{dir:2,index:c.LineName,x:c.EndPt.x,y:c.EndPt.y}])}else if(c.LineType===b.LineType[0]){if(Math.sqrt(Math.pow(c.StartPt.x-o,2)+Math.pow(c.StartPt.y-s,2))<a.outlinePar.radius&&(n=!0,a.APIPar.hoverOnPoint===b.hoverOnPoint[0]))return a.APIPar.hoverOnPoint=b.hoverOnPoint[1],a.addDelMPPar.hoverPointSign=b.sign[0],void $("body").trigger(e+"_Hover2Suspension_in",[{dir:2,index:c.LineName+"-S",x:c.StartPt.x,y:c.StartPt.y}]);if(Math.sqrt(Math.pow(c.EndPt.x-o,2)+Math.pow(c.EndPt.y-s,2))<a.outlinePar.radius&&(n=!0,a.APIPar.hoverOnPoint===b.hoverOnPoint[0]))return a.APIPar.hoverOnPoint=b.hoverOnPoint[1],a.addDelMPPar.hoverPointSign=b.sign[0],void $("body").trigger(e+"_Hover2Suspension_in",[{dir:2,index:c.LineName+"-E",x:c.EndPt.x,y:c.EndPt.y}])}}for(g=0;g<a.outlinePar.circles.length;g++){var l=a.outlinePar.circles[g];if(Math.sqrt(Math.pow(l.x-o,2)+Math.pow(l.y-s,2))<=a.outlinePar.radius&&(r=!0,a.APIPar.hoverOnPoint===b.hoverOnPoint[0])){if(a.APIPar.hoverOnPoint=b.hoverOnPoint[1],l.sign===b.sign[0]?a.addDelMPPar.hoverPointSign=b.sign[0]:a.addDelMPPar={hoverPointSign:b.sign[1],delCirIndex:g},l.sign===b.sign[0]){var m=0;if(g<t){for(var d=0;d<g;d++)a.outlinePar.circles[d].sign===b.sign[1]&&m++;$("body").trigger(e+"_Hover2Suspension_in",[{dir:0,index:g-m,x:l.x,y:l.y}])}else{for(d=t;d<g;d++)a.outlinePar.circles[d].sign===b.sign[1]&&m++;$("body").trigger(e+"_Hover2Suspension_in",[{dir:1,index:g-t-m,x:l.x,y:l.y}])}}return}}!1===n&&!1===r&&(a.APIPar.hoverOnPoint===b.hoverOnPoint[1]&&$("body").trigger(e+"_Hover2Suspension_out"),a.APIPar.hoverOnPoint=b.hoverOnPoint[0],a.addDelMPPar.hoverPointSign=b.sign[0])},findPointOnOutline:function(i,a,e){for(var t=b.MAXNUM,n=-1,r=0,o=b.data.pts[e.imgDir],s=a===b.drawDir[0]?0:2,g=b.minDownIndex;g<b.maxUpIndex;g++)(r=Math.abs(i-parseFloat(o[g][s+1]*e.contPar.winScaling)))<10&&r<t&&(t=r,n=parseFloat(o[g][s]*e.contPar.winScaling));return n},findClosestPoint:function(i,a,e){for(var t=b.data.pts[i.imgDir],n=[],r=[],o=0;o<t.length;o++)n.push(Math.abs(t[o][1]*i.contPar.winScaling-e)),r.push(Math.abs(t[o][3]*i.contPar.winScaling-e));var s=n.indexOf(Math.min.apply(null,n)),g=r.indexOf(Math.min.apply(null,r)),c=Math.abs(t[s][0]*i.contPar.winScaling-a),l=Math.abs(t[g][2]*i.contPar.winScaling-a);if(c<l)var m={drawDir:b.drawDir[0],index:s,dVx:c,dVy:n[s]};else m={drawDir:b.drawDir[1],index:g,dVx:l,dVy:r[g]};return m},cloneObj:function(i){var a,e=i.constructor===Array?[]:{};if("object"==typeof i){if(window.JSON)a=JSON.stringify(i),e=JSON.parse(a);else for(var t in i)e[t]="object"==typeof i[t]?this.cloneObj(i[t]):i[t];return e}},compare:function(i,a){return i.index<a.index?-1:i.index>a.index?1:0},setRgb:function(i,a,e){for(var t=this,n=t.cloneObj(b.data.pts[e.imgDir]),r=b.originalData.ptsTarget[e.imgDir],o=e.contPar.winScaling*e.zoomImg.imgScaling,s=0;s<n.length;s++)n[s][0]=(n[s][0]*e.contPar.winScaling-e.imgPar.imgx)/o,n[s][1]=(n[s][1]*e.contPar.winScaling-e.imgPar.imgy)/o,n[s][2]=(n[s][2]*e.contPar.winScaling-e.imgPar.imgx)/o,n[s][3]=(n[s][3]*e.contPar.winScaling-e.imgPar.imgy)/o;if(i.dir!=b.drawDir[2]){if(i.dir===b.drawDir[0]){e.APIPar.firstColorArray=new Array;for(s=0;s<n.length-1;s++){var g=Math.sqrt(Math.pow(n[s][0]-r[s][0],2)+Math.pow(n[s][1]-r[s][1],2)),c=Math.sqrt(Math.pow(n[s+1][0]-r[s+1][0],2)+Math.pow(n[s+1][1]-r[s+1][1],2));e.APIPar.firstColorArray.push({index:s,rgb:t.dist2Rgb(1-(g+c)/(2*e.outlinePar.distanceBound))})}}else if(i.dir===b.drawDir[1]){e.APIPar.secondColorArray=new Array;for(s=0;s<n.length-1;s++){g=Math.sqrt(Math.pow(n[s][2]-r[s][2],2)+Math.pow(n[s][3]-r[s][3],2)),c=Math.sqrt(Math.pow(n[s+1][2]-r[s+1][2],2)+Math.pow(n[s+1][3]-r[s+1][3],2));e.APIPar.secondColorArray.push({index:s,rgb:t.dist2Rgb(1-(g+c)/(2*e.outlinePar.distanceBound))})}}}else if(a.LineType!=b.LineType[0]){var l=Math.abs(a.EndPt.y-i.y);l=l*e.contPar.winScaling*e.zoomImg.imgScaling,a.rgb=t.dist2Rgb(1-l/e.outlinePar.distanceBound)}else{var m,d,P,u;for(o=e.contPar.winScaling*e.zoomImg.imgScaling,s=0;s<e.outlinePar.PaintLines.length;s++)e.outlinePar.PaintLines[s].LineName===a.LineName&&(m=(e.outlinePar.PaintLines[s].StartPt.x-e.imgPar.imgx)/o,d=(e.outlinePar.PaintLines[s].StartPt.y-e.imgPar.imgy)/o,P=(e.outlinePar.PaintLines[s].EndPt.x-e.imgPar.imgx)/o,u=(e.outlinePar.PaintLines[s].EndPt.y-e.imgPar.imgy)/o);var f=(Math.sqrt(Math.pow(a.StartPt.x-m,2)+Math.pow(a.StartPt.y-d,2))+Math.sqrt(Math.pow(a.EndPt.x-P,2)+Math.pow(a.EndPt.y-u,2)))*e.contPar.winScaling*e.zoomImg.imgScaling*.5;a.rgb=t.dist2Rgb(1-f/e.outlinePar.distanceBound)}},dist2Rgb:function(i){if(i<=0)var a=0;else if(i>b.closeRatio)a=255;else a=parseInt(255*this.colMathFun(i));return"rgb(255,"+a+",0)"},colMathFun:function(i){return Math.pow(b.bottomNum,i)-1},setMPIcon:function(c){var i=b.data.MP[c.imgDir][0],a=b.data.MP[c.imgDir][1],e=b.data.pts[c.imgDir],t=b.originalData.ptsTarget[c.imgDir],n=c.contPar.winScaling*c.zoomImg.imgScaling;c.APIPar.iconArray=new Array;for(var r=0;r<i.length;r++){var o=(e[g=i[r].index][0]*c.contPar.winScaling-c.imgPar.imgx)/n,s=(e[g][1]*c.contPar.winScaling-c.imgPar.imgy)/n;1-Math.sqrt(Math.pow(o-t[g][0],2)+Math.pow(s-t[g][1],2))/(c.contPar.height*b.mRatio)>b.closeRatio?c.APIPar.iconArray.push(b.MPIcon[1]):c.APIPar.iconArray.push(b.MPIcon[0])}for(r=0;r<a.length;r++){var g;o=(e[g=a[r].index][2]*c.contPar.winScaling-c.imgPar.imgx)/n,s=(e[g][3]*c.contPar.winScaling-c.imgPar.imgy)/n;1-Math.sqrt(Math.pow(o-t[g][2],2)+Math.pow(s-t[g][3],2))/(c.contPar.height*b.mRatio)>b.closeRatio?c.APIPar.iconArray.push(b.MPIcon[1]):c.APIPar.iconArray.push(b.MPIcon[0])}c.APIPar.PaintLines_iconArray=new Array,angular.forEach(c.outlinePar.PaintLines,function(t){if(t.LineType!=b.LineType[0])angular.forEach(c.APIPar.PaintLines_target,function(i){if(t.LineName===i.LineName){var a=c.contPar.winScaling*c.zoomImg.imgScaling,e=(t.EndPt.y-c.imgPar.imgy)/a;1-Math.abs(e-i.EndPt.y)/(c.contPar.height*b.mRatio)>b.closeRatio?c.APIPar.PaintLines_iconArray.push({LineName:t.LineName,icon:b.MPIcon[1]}):c.APIPar.PaintLines_iconArray.push({LineName:t.LineName,icon:b.MPIcon[0]})}});else{var n,r,o,s,g=c.contPar.winScaling*c.zoomImg.imgScaling;angular.forEach(c.APIPar.PaintLines_target,function(i){if(t.LineName===i.LineName){n=(t.StartPt.x-c.imgPar.imgx)/g,r=(t.StartPt.y-c.imgPar.imgy)/g,o=(t.EndPt.x-c.imgPar.imgx)/g,s=(t.EndPt.y-c.imgPar.imgy)/g;var a=Math.sqrt(Math.pow(i.StartPt.x-n,2)+Math.pow(i.StartPt.y-r,2)),e=Math.sqrt(Math.pow(i.EndPt.x-o,2)+Math.pow(i.EndPt.y-s,2));1-a/(c.contPar.height*b.mRatio)>b.closeRatio?c.APIPar.PaintLines_iconArray.push({LineName:t.LineName+"-S",icon:b.MPIcon[1]}):c.APIPar.PaintLines_iconArray.push({LineName:t.LineName+"-S",icon:b.MPIcon[0]}),1-e/(c.contPar.height*b.mRatio)>b.closeRatio?c.APIPar.PaintLines_iconArray.push({LineName:t.LineName+"-E",icon:b.MPIcon[1]}):c.APIPar.PaintLines_iconArray.push({LineName:t.LineName+"-E",icon:b.MPIcon[0]})}})}})},setGesture:function(t){b.mobileTouchRatio=2;var n,r=this,o=!1;t.drawCanvasJqueryId.unbind(),t.drawCanvasJqueryId.bind("touchstart",function(i){2<=i.touches.length?(o=!0,n=i.touches):1===i.touches.length&&r.canvasClick(i,t)}).bind("touchmove",function(i){if(2<=i.touches.length&&o){if(t.clickEvePar.isDraggingCir===b.isDraggingCir[0]){r.stopDragging(event,t),t.infPar.eventFlag=b.Flag[1];var a=i.touches,e=r.getDistance(a[0],a[1])/r.getDistance(n[0],n[1]);i.offsetX=(n[0].pageX+n[1].pageX)/2-t.drawCanvasJqueryId.offset().left,i.offsetY=(n[0].pageY+n[1].pageY)/2-t.drawCanvasJqueryId.offset().top,i.zoom=e/t.mobilePar.gestureScale,1<i.zoom?i.wheelDelta=120:i.zoom<1?i.wheelDelta=-120:i.wheelDelta=0,t.infPar.eventFlag=b.Flag[0],r.scaleImg(i,t),t.mobilePar.gestureScale=e}}else 1===i.touches.length&&r.mobileDragging(i,t)}).bind("touchend",function(i){o&&(o=!1),t.mobilePar.outsideCir=b.outsideCir[0],r.stopDragging(event,t)})},getDistance:function(i,a){var e=a.pageX-i.pageX,t=a.pageY-i.pageY;return Math.sqrt(e*e+t*t)},mobileDragging:function(i,a){if(a.clickEvePar.isDraggingCir===b.isDraggingCir[1]){if(null!=a.clickEvePar.previousSelectedCircle)if(b.testNum.test(a.mSelPointPar.mSelectedCircleIndex)){var e=i.offsetX?i.offsetX:i.touches[0].pageX-a.drawCanvasJqueryId.offset().left,t=i.offsetY?i.offsetY:i.touches[0].pageY-a.drawCanvasJqueryId.offset().top,n=a.contPar.height*b.mRatio*b.enLargeMRadius,r=e-a.outlinePar.originalCircles[a.mSelPointPar.mSelectedCircleIndex].x,o=t-a.outlinePar.originalCircles[a.mSelPointPar.mSelectedCircleIndex].y;n<Math.sqrt(Math.pow(r,2)+Math.pow(o,2))&&(a.mobilePar.outsideCir=b.outsideCir[1]),a.mobilePar.outsideCir===b.outsideCir[1]&&(i.offsetX=e-n,i.offsetY=t,this.dragging(i,a))}else this.dragging(i,a)}else this.dragging(i,a)},isPc:function(){var i={},a=navigator.platform;return i.win=0==a.indexOf("Win"),i.mac=0==a.indexOf("Mac"),i.x11="X11"==a||0==a.indexOf("Linux"),!!(i.win||i.mac||i.xll)}}}]),view.controller("SwitchViewCtrl",["$scope","dataSrv",function(e,s){function g(i,a,e){if(!i.pts[e]||""===i.pts[e])return"";for(var t=a.contPar.winScaling*a.zoomImg.imgScaling,n=new Array,r=i.pts[e],o=0;o<r.length;o++)n[o]=new Array(4),n[o][0]=(r[o][0]*a.contPar.winScaling-a.imgPar.imgx)/t,n[o][1]=(r[o][1]*a.contPar.winScaling-a.imgPar.imgy)/t,n[o][2]=(r[o][2]*a.contPar.winScaling-a.imgPar.imgx)/t,n[o][3]=(r[o][3]*a.contPar.winScaling-a.imgPar.imgy)/t;var s=[];for(o=0;o<r.length;o++)s.push(n[o][0]+":"+n[o][1]+":"+n[o][2]+":"+n[o][3]);return s.join(",")}function c(i,a){if(!a.outlinePar.PaintLines||""===a.outlinePar.PaintLines)return"";for(var e=a.contPar.winScaling*a.zoomImg.imgScaling,t=0;t<a.outlinePar.PaintLines.length;t++){var n=a.outlinePar.PaintLines[t],r=parseFloat((n.StartPt.x-a.imgPar.imgx)/e),o=parseFloat((n.StartPt.y-a.imgPar.imgy)/e),s=parseFloat((n.EndPt.x-a.imgPar.imgx)/e),g=parseFloat((n.EndPt.y-a.imgPar.imgy)/e);i.push({LineName:n.LineName,ImgDir:n.ImgDir,EndPt:{Y:g,X:s},LineType:n.LineType,StartPt:{Y:o,X:r}})}}e.getData=function(i){if(s.APIFlag=s.Flag[1],s.currentId=i.id,s.data=n(i),function(i){for(var a=0;a<i.dir.length;a++){for(var e=i.dir[a],t=0;t<i.MP[e][0].length;t++)i.MP[e][0][t]={index:i.MP[e][0][t],sign:s.sign[0]};for(var t=0;t<i.MP[e][1].length;t++)i.MP[e][1][t]={index:i.MP[e][1][t],sign:s.sign[0]}}}(s.data),s.originalData=n(s.data),i.isTutorial===s.isTutorial[1]&&(s.defImg=new Image,s.defImg.src=s.defImgSrc,s.targetImg=new Image,s.targetImg.src=s.targetImgSrc,s.promptButton=i.promptButton,$(s.promptButton).unbind()),s.retrButton&&""!=s.retrButton)for(var a in s.retrButton)$(s.retrButton[a]).unbind();$(window).unbind("resize"),setTimeout(function(){s.APIFlag=s.Flag[0],e.$broadcast("get_data","success")},s.setOutTime)},e.postAdjustRes=function(){s.APIFlag=s.Flag[1];var i=4;for(var a in s.adjustImgStatus)!0===s.adjustImgStatus[a]&&(i=3);var e=g(s.data,s.imgf_par,"f"),t=g(s.data,s.imgs_par,"s"),n=g(s.data,s.imgb_par,"b"),r=[];if(c(r,s.imgs_par),c(r,s.imgf_par),""!=n){c(r,s.imgb_par);var o={id:Number(s.currentId),pts_f:e,pts_s:t,pts_b:n,paintLines:JSON.stringify(r),ptsStatus:i}}else o={id:Number(s.currentId),pts_f:e,pts_s:t,paintLines:JSON.stringify(r),ptsStatus:i};return s.APIFlag=s.Flag[0],o},e.bindFun=function(i,a,e){if(""!==i&&null!=i){var t=i.split("_");"Hover2Suspension"===t[1]?($("body").bind(i+"_in",a),$("body").bind(i+"_out",e)):"Click2Suspension"===t[1]?($("body").bind(i+"_in",a),$("body").bind(i+"_out",e)):$("body").bind(i,a)}},e.unbindFun=function(i){if(""!==i&&null!=i){var a=i.split("_");"Hover2Suspension"===a[1]?($("body").unbind(i+"_in"),$("body").unbind(i+"_out")):"Click2Suspension"===a[1]?($("body").unbind(i+"_in"),$("body").unbind(i+"_out")):$("body").unbind(i)}};var n=function(i){var a,e=i.constructor===Array?[]:{};if("object"==typeof i){if(window.JSON)a=JSON.stringify(i),e=JSON.parse(a);else for(var t in i)e[t]="object"==typeof i[t]?n(i[t]):i[t];return e}}}]),view.directive("tozDrawImgf",["dataSrv","drawSrv",function(t,n){return{restrict:"A",replace:!0,scope:{},template:' <div><canvas id="imgfDrawCanvas" style="display:block; position:absolute; z-index: 1"></canvas> <canvas id="imgfImgCanvas" style="display:block; position: absolute;z-index: 0"></canvas></div>',controller:["$scope","$element","$attrs",function(i,a,e){i.imgf_par=n.newPar(t.imgDir[0],"imgfDrawCanvas","imgfImgCanvas"),t.imgCont[i.imgf_par.imgDir]="#"+a.attr("id"),t.retrButton[i.imgf_par.imgDir]=a.attr("retract"),t.imgf_par=i.imgf_par}],link:function(e){e.$on("get_data",function(i,a){n.pretreatment(e.imgf_par),n.init(e.imgf_par),n.draw(e.imgf_par)})}}}]),view.directive("tozDrawImgs",["dataSrv","drawSrv",function(t,n){return{restrict:"A",replace:!0,scope:{},template:' <div><canvas id="imgsDrawCanvas" style="display:block; position:absolute; z-index: 1"></canvas> <canvas id="imgsImgCanvas" style="display:block; position: absolute;z-index: 0"></canvas></div>',controller:["$scope","$element","$attrs",function(i,a,e){i.imgs_par=n.newPar(t.imgDir[1],"imgsDrawCanvas","imgsImgCanvas"),t.imgCont[i.imgs_par.imgDir]="#"+a.attr("id"),t.retrButton[i.imgs_par.imgDir]=a.attr("retract"),t.imgs_par=i.imgs_par}],link:function(e){e.$on("get_data",function(i,a){n.pretreatment(e.imgs_par),n.init(e.imgs_par),n.draw(e.imgs_par)})}}}]),view.directive("tozDrawImgb",["dataSrv","drawSrv",function(t,n){return{restrict:"A",replace:!0,scope:{},template:' <div><canvas id="imgbDrawCanvas" style="display:block; position:absolute; z-index: 1"></canvas> <canvas id="imgbImgCanvas" style="display:block; position: absolute;z-index: 0"></canvas></div>',controller:["$scope","$element","$attrs",function(i,a,e){i.imgb_par=n.newPar(t.imgDir[2],"imgbDrawCanvas","imgbImgCanvas"),t.imgCont[i.imgb_par.imgDir]="#"+a.attr("id"),t.retrButton[i.imgb_par.imgDir]=a.attr("retract"),t.imgb_par=i.imgb_par}],link:function(e){e.$on("get_data",function(i,a){""!=t.data.url[e.imgb_par.imgDir]&&(n.pretreatment(e.imgb_par),n.init(e.imgb_par),n.draw(e.imgb_par))})}}}]);var stressBoxId,theLanguage=$("html").attr("lang"),ctrl=document.querySelector("[ng-controller=SwitchViewCtrl]"),showTips=!1,imgCount=2,imgViewStatue=["f","s","b"],curImgViewStatue=imgViewStatue[0],fl_kpName_fir=["fl_toe","fl_knee","fl_crotch_cen","fl_crotch_out","fl_waist","fl_hip","fl_armsye","fl_biceps","fl_shoulder","fl_neck","fr_face","fl_headtop"],fl_kpName_sec=["fl_toe","fl_calf","fl_knee","fl_crotch_cen","fl_crotch_out","fl_waist","fl_hip","fl_armsye","fl_biceps","fl_shoulder","fl_neck","fr_face","fl_headtop"],fr_kpName=["fr_toe","fr_knee","fr_waist","fr_hip","fr_armsye","fr_biceps","fr_shoulder","fl_neck","fr_face","fr_headtop"],sf_kpName=["sf_knee","sf_knee","sf_knee","sf_knee","sf_belly","sf_belly","sf_belly","sf_bust","sf_jaw","sf_headtop"],sb_kpName=["sb_toe","sb_foot","sb_foot","sb_foot","sb_foot","sb_crotch","sb_hip","sb_bkwaist","sb_hump","sb_neck","sb_headtop"],exception_kpName={f:["fr_thigh"],s:["sf_jaw"]},showTips_BindName=["imgf_Hover2Suspension","imgs_Hover2Suspension"],hideGetMeasure=!1;function appendCorpName(){var i="<span>"+getCookie("tozSDK_corpName")+"</span>";$("#Account").append(i)}function showGuide(){var i=angular.element(ctrl).scope();i.unbindFun("imgf_Hover2Suspension"),i.unbindFun("imgs_Hover2Suspension"),showTips=!0,i.bindFun("imgf_Hover2Suspension",function(i,a){var e,t,n=$("#canvasContainer").offset(),r=$("#imgfContainer").offset(),o=a.x+r.left-n.left,s=.0556*$("#canvasContainer").height(),g=500+s,c=-g;0===a.dir?0<o+-300?(e=o+-300,0<a.y+c?t=a.y+c:a.y+g<=$("#canvasContainer").height()&&(t=a.y+s)):o+300<$("#canvasContainer").width()&&(e=o+50,0<a.y+c?t=a.y+c:a.y+g<=$("#canvasContainer").height()&&(t=a.y+s)):1===a.dir||2===a.dir?o+300<$("#canvasContainer").width()&&(e=o+50,0<a.y+c?t=a.y+c:a.y+g<=$("#canvasContainer").height()&&(t=a.y+s)):0<o+-300&&(e=o+-300,0<a.y+c?t=a.y+c:a.y+g<=$("#canvasContainer").height()&&(t=a.y+s));var l="";null===measureData.PaintKeyPts||""===measureData.PaintKeyPts?0===a.dir?l=13===measureData.FL_MP.length?fl_kpName_sec[a.index]:fl_kpName_fir[a.index]:1===a.dir?l=fr_kpName[a.index]:"FT_Waist_Line"===a.index&&(l+="f_side_waistline_point"):0===a.dir?l=measureData.PaintKeyPts[a.index].PtName:1===a.dir?l=measureData.PaintKeyPts[a.index+measureData.MP.f[0].length].PtName:"FT_Waist_Line"===a.index&&(l+="f_side_waistline_point");for(var m=0;m<exception_kpName.f.length;m++)if(l===exception_kpName.f[m])return;$("#canvasContainer").append("<div class='toz-poptip'><img class='tipimg' src='assets/imgs/Guide/"+l+".png'></div>"),$(".toz-poptip").css({top:t+"px",left:e+"px"}),$(".toz-poptip").show()},function(){$(".toz-poptip").remove()}),i.bindFun("imgs_Hover2Suspension",function(i,a){var e,t,n=$("#canvasContainer").offset(),r=$("#imgsContainer").offset(),o=a.x+r.left-n.left,s=.0556*$("#canvasContainer").height(),g=500+s,c=-g;1===a.dir?0<o+-300?(e=o+-300,0<a.y+c?t=a.y+c:a.y+g<=$("#canvasContainer").height()&&(t=a.y+s)):o+300<$("#canvasContainer").width()&&(e=o+50,0<a.y+c?t=a.y+c:a.y+g<=$("#canvasContainer").height()&&(t=a.y+s)):0!==a.dir&&2!==a.dir||(o+300<$("#canvasContainer").width()?(e=o+50,0<a.y+c?t=a.y+c:a.y+g<=$("#canvasContainer").height()&&(t=a.y+s)):0<o+-300&&(e=o+-300,0<a.y+c?t=a.y+c:a.y+g<=$("#canvasContainer").height()&&(t=a.y+s)));var l="";""===measureData.PaintKeyPts||null===measureData.PaintKeyPts?0===a.dir?l=sf_kpName[a.index]:1===a.dir?l=sb_kpName[a.index]:"Sd_FT_Waist_Line"===a.index?l+="s_front_waistline_point":"Sd_BK_Waist_Line"===a.index?l+="s_back_waistline_point":"Sd_Arm-S"===a.index?l+="s_arm_line_top_point":"Sd_Arm-E"===a.index&&(l+="s_sleeve_length_end_point"):0===a.dir?l=measureData.PaintKeyPts[a.index+measureData.MP.f[0].length+measureData.MP.f[1].length].PtName:1===a.dir?l=measureData.PaintKeyPts[a.index+measureData.MP.f[0].length+measureData.MP.f[1].length+measureData.MP.s[0].length].PtName:"Sd_FT_Waist_Line"===a.index?l+="s_front_waistline_point":"Sd_BK_Waist_Line"===a.index?l+="s_back_waistline_point":"Sd_Arm-S"===a.index?l+="s_arm_line_top_point":"Sd_Arm-E"===a.index&&(l+="s_sleeve_length_end_point");for(var m=0;m<exception_kpName.s.length;m++)if(l===exception_kpName.s[m])return;$("#canvasContainer").append("<div class='toz-poptip'><img class='tipimg' src='assets/imgs/Guide/"+l+".png'></div>"),$(".toz-poptip").css({top:t+"px",left:e+"px"}),$(".toz-poptip").show()},function(){$(".toz-poptip").remove()})}function select2highlightBox(i){var a=$(i).attr("id").split("_");$(".text-item").removeClass("select-box"),$("#"+a[0]+"_data").addClass("select-box"),stressBoxId="#"+a[0]+"_data"}function maintainHighlightedBox(){$(".text-item").removeClass("select-box"),$(stressBoxId).addClass("select-box")}function addScrollbar(i){-1<navigator.userAgent.indexOf("Firefox")&&($(".cover-layer").show(),$(i).css({"overflow-y":"hidden","-ms-overflow-y":"hidden"}),$(i).addClass("mCustomScrollbar"),$(i).addClass("fluid"),$(".cover-layer").hide())}function showOrHideButton(){$(window).width()<=768?($(".img-container").css("width","100%"),curImgViewStatue===imgViewStatue[0]?($(".adjust-button-group button").hide(),$(".front-img-button").show(),$("#imgfContainer").css("z-index",9),$("#imgsContainer").css("z-index",-9),$("#imgbContainer").css("z-index",-9)):curImgViewStatue===imgViewStatue[1]?($(".adjust-button-group button").hide(),$(".side-img-button").show(),$("#imgfContainer").css("z-index",-9),$("#imgbContainer").css("z-index",-9),$("#imgsContainer").css("z-index",9),2===imgCount?($("#showBackImg").hide(),$("#getMeasurements").show()):3===imgCount&&($("#showBackImg").show(),$("#getMeasurements").hide())):curImgViewStatue===imgViewStatue[2]&&($(".adjust-button-group button").hide(),$(".back-img-button").show(),$("#getMeasurements").show(),$("#imgfContainer").css("z-index",-9),$("#imgsContainer").css("z-index",-9),$("#imgbContainer").css("z-index",9))):($(".img-container").css("width",90/imgCount+"%"),$(".adjust-button-group button").hide(),$("#getMeasurements").show(),$("#retractFront").show(),$("#retractSide").show(),2===imgCount?$("#retractBack").hide():3===imgCount&&$("#retractBack").show(),$("#imgfContainer").css("z-index",9),$("#imgsContainer").css("z-index",9),$("#imgbContainer").css("z-index",9)),$("#showTarget").show(),$("#showTips").show()}appendCorpName(),addScrollbar(".cus-list"),showOrHideButton(),$(window).resize(function(){showOrHideButton()}),$(document).bind("click",function(i){for(var a=(i=i||window.event).target||i.srcElement;a;){if(a.id&&"accountContainer"==a.id)return;a=a.parentNode}$(".toz-header-drop-down-content").css("display","none")}),$("#Account").click(function(){window.location.href=accountURL[theLanguage]}),$("#Measure").click(function(){window.location.href=measureURL[theLanguage]}),$("#Tutorial").click(function(){window.location.href=tutorialURL[theLanguage]}),$("#Logout").click(function(){delCookie("tozSDK_corpName"),delCookie("tozSDK_token"),window.location.href=loginURL[theLanguage]}),$("#showTips").click(function(){var i=angular.element(ctrl).scope();!0===showTips?(showTips=!1,$(".toz-poptip").remove(),i.unbindFun(showTips_BindName[0]),i.unbindFun(showTips_BindName[1])):showGuide(i)}),$("#showSideImg").click(function(){curImgViewStatue=imgViewStatue[1],showOrHideButton()}),$("#showFrontImg").click(function(){curImgViewStatue=imgViewStatue[0],showOrHideButton()}),$("#showBackImg").click(function(){curImgViewStatue=imgViewStatue[2],showOrHideButton()}),$("#back2SideImg").click(function(){curImgViewStatue=imgViewStatue[1],showOrHideButton()}),$(".toz-header-drop-down").click(function(){"none"===$(this).find(".toz-header-drop-down-content").css("display")?$(this).find(".toz-header-drop-down-content").css({display:"block"}):$(this).find(".toz-header-drop-down-content").css({display:"none"})}),setTimeout(function(){$("#Logout").click()},36e5*Number(getCookie("tozSDK_keepTime")));var token=getCookie("tozSDK_token"),pageLimit=(theLanguage=$("html").attr("lang"),ctrl=document.querySelector("[ng-controller=SwitchViewCtrl]"),20),searchStatus=!1,listData={},measureData={},excelId=-1,activeIcon="",ptDef={},ptDefLength=0,unit=["cm","in"],currentUnit=unit[0],maxTableLength=13,toogleFlag=0,corpApi="",httpBasicAuth="";function getCorpAPI(){toz_ajax.post({url:SDKAPI.getlimit,data:{accessToken:token},success:function(i){0===i.data.code?(corpApi=i.data.data.corpApi?i.data.data.corpApi:"",httpBasicAuth=i.data.data.httpBasicAuth?i.data.data.httpBasicAuth:""):toz_Toast.init({title:"Wrong",content:i.data.data,duration:-1,mask:!1,icon:"failure"})}})}function uploadList(i){var e=void 0===i?1:i,a={};if(!1===searchStatus)a={accessToken:token,userId:"",limit:pageLimit,offset:(e-1)*pageLimit};else{var t=new Date($("#startTime").val()),n=new Date($("#endTime").val());a={accessToken:token,lastPtsStatus:Number($('input[name="selectedStatus"]:checked').val()),startTime:t.getTime()?t.getTime():"",endTime:n.getTime()?n.getTime():"",userId:$("#searchId").val()?$("#searchId").val().toString():"",limit:pageLimit,offset:(e-1)*pageLimit}}toz_ajax.post({url:SDKAPI.listMeasure,data:a,success:function(i){if($(".cus-list").empty(),void 0!==i.data.data.data){var a=(e-1)*pageLimit+1;appendAtList(listData=i.data.data.data,a),maintainHighlightedBox(),0===$("#pageToolbar:has(.ui-paging-container)").length&&$("#pageToolbar").Paging({pagesize:pageLimit,count:i.data.data.total,toolbar:!0,goFunction:uploadList})}else toz_Toast.init({title:"Wrong",content:"The data is null!",duration:-1,mask:!1,icon:"failure"})}})}function appendAtList(i,a){$(".cus-list").empty();for(var e=a||1,t=0;t<i.length;t++){var n=i[t],r=genderTable[theLanguage][Number(n.userGender)],o=new Date(n.createdTime),s=o.getFullYear()+"-";s+=(o.getMonth()+1<10?"0"+(o.getMonth()+1):o.getMonth()+1)+"-",s+=(o.getDate()<10?"0"+o.getDate():o.getDate())+" ",s+=(o.getHours()<10?"0"+o.getHours():o.getHours())+":",s+=(o.getMinutes()<10?"0"+o.getMinutes():o.getMinutes())+":",s+=o.getSeconds()<10?"0"+o.getSeconds():o.getSeconds();var g=!1;void 0!==n.measureInfo&&null!==n.measureInfo&&n.measureInfo!==[]&&0!==n.measureInfo.length&&null!=typeof n.measureInfo.measures&&null!=n.measureInfo.measures&&(g=!0);var c=e,l=s,m=n.id,d=r,P=n.userHeight,u=n.userId,f=n.userWeight,p=g,h='<li class="cus-item" ><div class="cus-content"><div class="cus-data"><div id="'+m+'_data" class="text-item"><span id="listNum" title="listNum" >'+c+'</span></br><div class="cus-data-content"><span title="id" >'+userIdTable[theLanguage]+": "+u+'</span></br><span title="sex">'+d+'</span><span title="height">'+P+'CM</span><span title="weight">'+f+'KG</span> </br><span title="createdTime" >'+l+'</span></div></div><div class="list-button"><div class="button-item"><button id="'+m+'" onclick="getData(this);select2highlightBox(this)">'+adjustTable[theLanguage]+"</button>";h+=!1===p?'<button id="'+m+'_show" onclick="viewSize(this);select2highlightBox(this)" disabled>'+viewTable[theLanguage]+"</button>":'<button id="'+m+'_show" onclick="viewSize(this);select2highlightBox(this)" >'+viewTable[theLanguage]+"</button>",h+="</div></div></div></div></li>",$(".cus-list").append(h),e++}maintainHighlightedBox()}function getNewPts(i,a){if(void 0===i[a]||!i[a])return"";for(var e,t=i[a].split(","),n=[],r=0;r<t.length;r++){n[r]=new Array,e=t[r].split(":");for(var o=0;o<e.length;o++)n[r].push(Number(e[o]))}return n}function getNewColor(i,a){if(void 0===i[a]||!i[a])return[];for(var e=i[a].split(","),t=[],n=0;n<e.length-1;n++){var r=e[n].split(":");t[n]=new Array;for(var o=0;o<r.length;o++)t[n].push(Number(r[o]))}return t}function getImgSize(i,a){if(!i[a])return["",""];var e=i[a].split(":");return[Number(e[0]),Number(e[1])]}function getMPFromPK(i,a){for(var e=new Array,t=0;t<i.length;t++)i[t].PtDir===a&&e.push(Number(i[t].PtIndex));return e}function getMPFromStr(i,a){if(!i[a])return"";for(var e=new Array,t=i[a].split(";")[0].split(","),n=0;n<t.length;n++)e.push(Number(t[n]));return e}function getData(I){$("#showView").hide(),$("#adjustShowView").show();var i={accessToken:token,id:Number($(I).attr("id"))};toz_ajax.post({url:SDKAPI.imgsMeasure,data:i,success:function(i){if("200"==i.data.code&&null!=i.data.data){excelId=Number($(I).attr("id"));var a=JSON.parse(i.data.data.ptsInfo);a=a[a.length-1];var e=JSON.parse(i.data.data.basicInfo),t=getNewPts(a,"pts_f"),n=getNewPts(a,"pts_s"),r=getNewPts(a,"pts_b"),o=getNewColor(e,"FLCOLOR"),s=getNewColor(e,"FRCOLOR"),g=getNewColor(e,"SFCOLOR"),c=getNewColor(e,"SBCOLOR"),l=getNewColor(e,"BLCOLOR"),m=getNewColor(e,"BRCOLOR"),d=getImgSize(e,e.img_f_size?"img_f_size":"Img_f_size"),P=getImgSize(e,e.img_s_size?"img_s_size":"Img_s_size"),u=getImgSize(e,e.img_b_size?"img_b_size":"Img_b_size"),f="";if(void 0!==e.PaintKeyPts)var p=getMPFromPK(f=e.PaintKeyPts,"fl"),h=getMPFromPK(f,"fr"),w=getMPFromPK(f,"sf"),v=getMPFromPK(f,"sb"),S=getMPFromPK(f,"bl"),x=getMPFromPK(f,"br");else p=getMPFromStr(e,"FL_MP"),h=getMPFromStr(e,"FR_MP"),w=getMPFromStr(e,"SF_MP"),v=getMPFromStr(e,"SB_MP"),S=getMPFromStr(e,"BL_MP"),x=getMPFromStr(e,"BR_MP");""!=(measureData={id:i.data.data.id,userId:i.data.data.userId,userGender:i.data.data.userGender,userHeight:i.data.data.userHeight,userWeight:i.data.data.userWeight,createdTime:i.data.data.createdTime,dir:["f","s","b"],pts:{f:t,s:n,b:r},url:{f:"data:image/jpg;base64,"+i.data.data.userImgBasedF,s:"data:image/jpg;base64,"+i.data.data.userImgBasedS,b:i.data.data.userImgBasedB?"data:image/jpg;base64,"+i.data.data.userImgBasedB:""},MP:{f:[p,h],s:[w,v],b:[S,x]},COLOR:{f:[o,s],s:[g,c],b:[l,m]},imgSize:{f:d,s:P,b:u},PaintLines:JSON.parse(a.paintLines),isTutorial:!1,PaintKeyPts:f}).url.b?(imgCount=3,$("#imgbContainer").show(),$(".img-container").css("width","30%")):(imgCount=2,$("#imgbContainer").hide(),$(".img-container").css("width","45%")),$("#adjustShowView").show(),$("#adjustView").show(),curImgViewStatue=imgViewStatue[0],showOrHideButton();var y=angular.element(ctrl).scope();y.getData(measureData),!0===showTips&&showGuide(y)}else toz_Toast.init({title:"Wrong",content:"Sorry, network connection failed. Please try again.(Code:"+i.data.code+")",duration:-1,mask:!1,icon:"failure"})}})}function viewSize(i){var a=$(i).attr("id");a=(a=a.split("_"))[0];var e={accessToken:token.toString(),id:a};toz_ajax.post({url:SDKAPI.imgsMeasure,data:e,success:function(i){if(200===i.data.code){$("#adjustShowView").show();var a="data:image/jpg;base64,"+i.data.data.userImgBasedF,e="data:image/jpg;base64,"+i.data.data.userImgBasedS;measureData={userGender:i.data.data.userGender,userHeight:i.data.data.userHeight,userWeight:i.data.data.userWeight,createdAt:i.data.data.createdTime,frontImg:a,sideImg:e};var t=JSON.parse(i.data.data.measureInfo);excelId=i.data.data.id,initSizeView(t=t[t.length-1].measures)}else toz_Toast.init({title:"Wrong",content:i.data.data,duration:-1,mask:!1,icon:"failure"})}})}function getMeasurements(){var i,a=angular.element(ctrl).scope(),e={id:(i=a.postAdjustRes()).id,pts_f:i.pts_f,pts_s:i.pts_s,pts_b:i.pts_b?i.pts_b:null,paintLines:i.paintLines,ptsStatus:i.ptsStatus,accessToken:token};toz_ajax.post({url:SDKAPI.modelling,data:e,success:function(i){"200"==i.data.code?initSizeView(i.data.data):toz_Toast.init({title:"Wrong",content:i.data.data,duration:-1,mask:!1,icon:"failure"})}})}function initSizeView(i){$("#adjustView").hide(),$("#showView").show(),initToogle(),null!=document.getElementById("showView")&&initSizeList(i,!1),$(window).bind("resize",function(){null!=document.getElementById("showView")&&initSizeList(i,!0)})}function initSizeList(i,a){$("#firBodySizeList").empty(),$("#secBodySizeList").empty();var e=0;if(!0===a)e=ptDefLength;else{ptDef={};for(var t=0;t<i.length;t++){var n=i[t].sizeid;ptDef[n]={descCn:i[t].descCn,descEn:i[t].descEn,descHk:i[t].descHk,iconUrl:i[t].iconUrl,nameCn:i[t].nameCn,nameEn:i[t].nameEn,nameHk:i[t].nameHk,sizeval:i[t].sizeval,adjustedval:i[t].adjustedval?i[t].adjustedval:i[t].sizeval,masureStatus:4},e++}ptDefLength=e}var r=document.documentElement.clientWidth,o=1;if(e<maxTableLength||r<1e3){$(".sce-table").hide();var s="";for(var t in ptDef){if(null!=ptDef[t].adjustedval&&""!=ptDef[t].adjustedval){"zh-cmn-Hans"===theLanguage?s=ptDef[t].nameCn:"en"===theLanguage?s=ptDef[t].nameEn:"ja"===theLanguage&&(s=ptDef[t].nameEn);var g="<tr  id='"+t+"'  class='measure-cell'><td  onclick='iconToggle(this)' class='measure-icon'  ><img src="+ptDef[t].iconUrl+"></td><td onclick='iconToggle(this)'>"+o+". "+s+"</td><td ondblclick='editClick(this)'class='detail-form' id='detail-form-"+t+"' value='"+ptDef[t].adjustedval.toFixed(2)+"' ><span class='size-inf no-edit-form'  >"+ptDef[t].adjustedval.toFixed(2)+"</span><div class='edit-input'></div></td></tr><tr  id='remark-"+t+"'></tr>";$("#firBodySizeList").append(g)}o++}}else{var c=0;for(var t in ptDef)c++;c=Math.ceil(c/2),$(".sce-table").show();var l=0;for(var t in ptDef){s="";if("zh-cmn-Hans"===theLanguage?s=ptDef[t].nameCn:"en"===theLanguage?s=ptDef[t].nameEn:"ja"===theLanguage&&(s=ptDef[t].nameEn),l<c){if(null!=ptDef[t].adjustedval&&""!=ptDef[t].adjustedval){g="<tr  id='"+t+"'  class='measure-cell'><td  onclick='iconToggle(this)' class='measure-icon'    ><img src="+ptDef[t].iconUrl+"></td><td onclick='iconToggle(this)'>"+o+". "+s+"</td><td ondblclick='editClick(this)'class='detail-form' id='detail-form-"+t+"' value='"+ptDef[t].adjustedval.toFixed(2)+"' ><span class='size-inf no-edit-form'  >"+ptDef[t].adjustedval.toFixed(2)+"</span><div class='edit-input'></div></td></tr><tr  id='remark-"+t+"'></tr>";$("#firBodySizeList").append(g)}}else if(null!=ptDef[t].adjustedval&&""!=ptDef[t].adjustedval){g="<tr  id='"+t+"'  class='measure-cell'><td  onclick='iconToggle(this)' class='measure-icon'  ><img src="+ptDef[t].iconUrl+"></td><td onclick='iconToggle(this)'>"+o+". "+s+"</td><td ondblclick='editClick(this)'class='detail-form' id='detail-form-"+t+"' value='"+ptDef[t].adjustedval.toFixed(2)+"' ><span class='size-inf no-edit-form'  >"+ptDef[t].adjustedval.toFixed(2)+"</span><div class='edit-input'></div></td></tr><tr  id='remark-"+t+"'></tr>";$("#secBodySizeList").append(g)}o++,l++}}$(".content").mCustomScrollbar()}function iconToggle(i){var a=i.parentElement.nextSibling.id,e=a.split("-"),t="#remark-"+activeIcon,n="#"+a;if(e[1]!=activeIcon){if(""!=activeIcon&&($(t).removeClass("micon-active"),$(t).find(".desc-container").remove()),$(n).addClass("micon-active"),activeIcon=e[1],"zh-cmn-Hans"===theLanguage)var r="<p>"+ptDef[activeIcon].descCn+"</p>";else if("en"===theLanguage)r="<p>"+ptDef[activeIcon].descEn+"</p>";else if("ja"===theLanguage)r="<p>"+ptDef[activeIcon].descEn+"</p>";$(n).prepend("<td colspan='3' class='desc-container' onclick='descToggle(this)'><div class='desc-arrow desc-arrow-right'></div> <div class='size-desc'>"+r+"</div></td>")}else $(n).find(".desc-container").remove(),$(n).removeClass("micon-active"),activeIcon=""}function descToggle(i){var a="#"+i.parentElement.id+" .desc-container .size-desc",e="#"+i.parentElement.id+" .desc-container .desc-arrow";$(a).toggle("fast",function(){"none"==$(a).css("display")?($(e).removeClass("desc-arrow-right"),$(e).addClass("desc-arrow-left")):($(e).addClass("desc-arrow-right"),$(e).removeClass("desc-arrow-left"))})}function editClick(a){if(!$(a).is(".input")){var e=Number($(a).text());$(a).addClass("input").html('<input type="number"  value="'+Number($(a).text())+'" />').find("input").focus().blur(function(){var i=a.id.split("-");i=i[2],ptDef[i].adjustedval=Number($(this).val()),ptDef[i].adjustedval!=e&&(ptDef[i].masureStatus=3),$(this).parent().removeClass("input").html($(this).val()||e||0)})}}function toogle(i){if(!(0<toogleFlag)){toogleFlag++;var a=$(".table-sytle").find(".move");if("on"==a.attr("data-state")){for(var e in a.animate({left:"0"},300,function(){a.attr("data-state","off"),3==++toogleFlag&&(toogleFlag=0)}),ptDef)ptDef[e].adjustedval*=.3937008,currentUnit=unit[1],$("#detail-form-"+e).text(ptDef[e].adjustedval.toFixed(2));$(".move").removeClass("on").addClass("off")}else if("off"==a.attr("data-state")){for(var e in a.animate({left:"30px"},300,function(){a.attr("data-state","on"),3==++toogleFlag&&(toogleFlag=0)}),ptDef)ptDef[e].adjustedval*=2.54,currentUnit=unit[0],$("#detail-form-"+e).text(ptDef[e].adjustedval.toFixed(2));$(".move").removeClass("off").addClass("on")}}}function initToogle(){var i=$(".table-sytle").find(".move");"off"==i.attr("data-state")&&(i.animate({left:"30px"},0,function(){i.attr("data-state","on")}),$(".move").removeClass("off").addClass("on"))}function timeAscending(i,a){return i.createdTime<a.createdTime?-1:i.createdTime>a.createdTime?1:0}function timeDescending(i,a){return i.createdTime<a.createdTime?1:i.createdTime>a.createdTime?-1:0}getCorpAPI(),uploadList(1),$("#cnMeasureUrl").click(function(){window.location.href=measureURL["zh-cmn-Hans"]}),$("#enMeasureUrl").click(function(){window.location.href=measureURL.en}),$("#jpMeasureUrl").click(function(){window.location.href=measureURL.ja}),$("#searchButton").click(function(){$("#pageToolbar").empty(),searchStatus=!0,uploadList(),$(".treeth li").removeClass("active"),$(".sidebar-tree > div").hide(),$(".sidebar-tree-content").show(),$("#pageToolbar").show()}),$("#timeAscending").click(function(){appendAtList(listData=listData.sort(timeAscending))}),$("#timeDescending").click(function(){appendAtList(listData=listData.sort(timeDescending))}),$("#submitSizesList").click(function(){var i=[],a=[],e=cloneObj(ptDef);if(currentUnit==unit[1])for(var t in e)e[t].adjustedval*=2.54;for(var t in e){var n={sizeid:t.toString(),sizeval:parseFloat(e[t].sizeval),adjustedval:parseFloat(e[t].adjustedval),nameEn:e[t].nameEn,nameHk:e[t].nameHk,nameCn:e[t].nameCn,descEn:e[t].descEn,descHK:e[t].descHK,descCn:e[t].descCn,iconUrl:e[t].iconUrl,masureStatus:e[t].masureStatus},r={sizeval:parseFloat(e[t].adjustedval),name:"zh-cmn-Hans"===theLanguage?e[t].nameCn:e[t].nameEn};i.push(n),a.push(r)}var o={accessToken:token,id:excelId.toString(),measureData:JSON.stringify(i)};if(toz_ajax.post({url:SDKAPI.add,data:o,success:function(i){"200"==i.data.code?$("#show_"+excelId).removeAttr("disabled"):toz_Toast.init({title:"Wrong",content:i.data.data,duration:-1,mask:!1,icon:"failure"})}}),null!=corpApi&&""!=corpApi&&"Null"!=corpApi&&"null"!=corpApi){var s=(new Date).getTime(),g={userId:o.id,userGender:measureData.userGender,userHeight:measureData.userHeight,userWeight:measureData.userWeight,createdAt:measureData.createdTime,updatedAt:s,frontImg:measureData.url.f,sideImg:measureData.url.s,measurements:JSON.stringify(a)};toz_ajax.post({url:corpApi,data:g,headers:{Authorization:httpBasicAuth},crossDomain:!0,contentType:"application/json; charset=utf-8",dataType:"JSON",success:function(i){i.code?0===i.code?toz_Toast.init({title:"Success",content:"Data storage successful",duration:2e3,mask:!1,icon:"success"}):toz_Toast.init({title:"Wrong",content:"Data storage failed(code:"+i.code+") "+i.msg?i.msg:"",duration:2e3,mask:!1,icon:"success"}):toz_Toast.init({title:"Success",content:"Data storage successful",duration:2e3,mask:!1,icon:"success"})}})}}),$("#toExcelButton").click(function(){var i=new Array,a="CM";"off"===$(".move").attr("data-state")&&(a="IN");var e=cloneObj(ptDef),t={};t.fileName="UserId"+excelId+"_"+(new Date).toISOString().replace(/[\-\:\.]/g,"");var n=$("html").attr("lang");if("zh-cmn-Hans"===n){for(var r in e)i.push({one:e[r].nameCn,two:e[r].adjustedval.toFixed(2)});t.datas=[{sheetData:i,sheetName:"sheet",sheetFilter:["one","two"],sheetHeader:["名称","尺寸/"+a]}]}else if("en"===n){for(var r in e)i.push({one:e[r].nameEn,two:e[r].adjustedval.toFixed(2)});t.datas=[{sheetData:i,sheetName:"sheet",sheetFilter:["one","two"],sheetHeader:["Name","Size/"+a]}]}else if("ja"===n){for(var r in e)i.push({one:e[r].nameEn,two:e[r].adjustedval.toFixed(2)});t.datas=[{sheetData:i,sheetName:"sheet",sheetFilter:["one","two"],sheetHeader:["Name","Size/"+a]}]}new ExportJsonExcel(t).saveExcel()}),$(".header-nav-bar-content li a").hover(function(){$("#headerMeasure").removeClass("nav-bar-select")},function(){$("#headerMeasure").addClass("nav-bar-select")});